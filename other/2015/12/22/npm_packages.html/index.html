<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="/favicon.ico" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="manifest" href="/manifest.json" />
		<meta name="theme-color" content="#cdffcd">
		<!-- HTML Meta Tags -->
		<title>GeoExamples - Roger Veciana</title>
		<meta
			name="description"
			content="I am a software developer and meteorologist who likes mapping. I put here the things I learn on my free time."
		/>
		<!-- Google / Search Engine Tags -->
		<meta itemprop="name" content=">GeoExamples - Roger Veciana" />
		<meta
			itemprop="description"
			content="I am a software developer and meteorologist who likes mapping. I put here the things I learn on my free time."
		/>
		<meta itemprop="image" content="https://geoexamples.com/siteImage.png" />
		<!-- Facebook Meta Tags -->
		<meta property="og:url" content="https://geoexamples.com" />
		<meta property="og:type" content="website" />
		<meta property="og:title" content="GeoExamples - Roger Veciana" />
		<meta
			property="og:description"
			content="I am a software developer and meteorologist who likes mapping. I put here the things I learn on my free time."
		/>
		<meta property="og:image" content="https://geoexamples.com/siteImage.png" />
		<!-- Twitter Meta Tags -->
		<meta name="twitter:card" content="summary" />
		<meta name="twitter:title" content="GeoExamples - Roger Veciana" />
		<meta name="twitter:description"
		  content="I am a software developer and meteorologist who likes mapping. I put here the things I learn on my free time." />
		<meta name="twitter:image" content="https://geoexamples.com/siteImage.png" />
		



<link rel="modulepreload" href="/./_app/start-44631b0b.js">
			<link rel="modulepreload" href="/./_app/chunks/vendor-ff3d1764.js">
			<link rel="modulepreload" href="/./_app/chunks/config-b3bde751.js">
			<link rel="modulepreload" href="/./_app/pages\[category]\[year]\[month]\[date]\[slug].svelte-a77716b3.js">
			<link rel="stylesheet" href="/./_app/assets/start-34a290f9.css">


		<script type="module">
			import { start } from "/./_app/start-44631b0b.js";
			start({
				target: document.querySelector("#svelte"),
				paths: {"base":"","assets":"/."},
				session: {},
				host: location.host,
				route: true,
				hydrate: {
					status: 200,
					error: null,
					nodes: [
						import("/./_app/pages\\[category]\\[year]\\[month]\\[date]\\[slug].svelte-a77716b3.js")
					],
					page: {
						host: location.host, // TODO this is redundant
						path: "/other/2015/12/22/npm_packages.html",
						query: new URLSearchParams(""),
						params: {"category":"other","year":"2015","month":"12","date":"22","slug":"npm_packages.html"}
					}
				}
			});
		</script>
	</head>
	<body>
		<div id="svelte">


<header class="site-header"><div class="wrapper"><a class="site-title" href="/">GeoExamples - Roger Veciana</a>

<nav class="site-nav"><div href="#" class="menu-icon"><svg viewBox="0 0 18 15"><path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"></path><path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"></path><path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"></path></svg></div>

	<div class="trigger"><a class="page-link" href="/about">About</a><a class="page-link" href="/blog">Blog</a><a class="page-link" href="/projects">Projects</a></div></nav></div></header>

<main class="page-content"><div class="wrapper"><div class="post"><header class="post-header"><h1 class="post-title">Creating a D3 NPM package</h1>
<p class="post-meta">Dec 22, 2015</p></header>

	<article class="post-content"><p>Some months ago I created a D3js projection, and published it to NMP and Bower. I wanted to use the opportunity to learn about Nodejs, NPM and so on. I write this post to remember all the steps I followed, and maybe is interesting for someone else.</p>
<h2 id="the-final-code">The final code</h2>
<p>The library I will talk about is explained in the <a href="/d3/2015/05/12/d3-composite-projections.html">original d3-composite-projections post</a>. You can download it or take a look to the code at the <a href="https://github.com/rveciana/d3-composite-projections">project&#39;s GitHub page</a>. If you already know how to use npm, just type <code>npm install d3-composite-projections</code>.</p>
<p>I won&#39;t talk about the code itself, but about the tools I used to create it.</p>
<h2 id="creating-the-nodejs-project">Creating the nodejs project</h2>
<p>To create a Nodejs project, the first thing is <a href="https://nodejs.org/en/download/">installing Nodejs</a>, of course. In the same step, <a href="https://www.npmjs.com/">npm</a> will be installed.</p>
<p>The first thing is initializing the project:</p>
<p>
npm init
</p>
<p>This will prompt some questions and save the information into a file called <em>package.json</em>. You can change the file whenever you want, so mistakes are not very important.</p>
<p>This <em>package.json</em> file is important to publish the project, since it holds some information, but also for personal use, because stores the information about the dependencies of the project. You only keep your code, and using the command

npm install

all the dependencies will be downloaded.</p>
<p>To add a dependency, one of the following:

npm install name_of_the package
npm install --save name_of_the package
npm install --save-dev name_of_the package
</p>
<ul>
<li>The first will install the dependency, but won&#39;t store it into <em>package.json</em>, so using npm install won&#39;t work in the future installations.</li>
<li>The second options saves the dependency into the <em>dependencies</em> section, so it will be always downloaded</li>
<li>The third option will save the dependency into the <em>devDependencies</em> section. This allows to avoid downloading them when you only want to use the library, without developing it. For instance, when other software depends on your library, those won&#39;t be installed.</li>
</ul>
<h2 id="managing-the-workflow-with-gulp">Managing the workflow with gulp</h2>
<p>A task manager is very useful when working with node. Since I&#39;m not using an IDE like Eclipse or NetBeans, all the tasks are run from the command line, and when the project grows a little, running all the commands can be long. Gulp helps you to do all this automatically creating what they call <em>tasks</em>. The tasks use <em>streams</em>, which are remember me a little the unix pipes.</p>
<p>To <a href="https://github.com/gulpjs/gulp/blob/master/docs/getting-started.md">install gulp</a>, you have to type:

npm install --global gulp
npm install --save-dev gulp

This will install the dependency at the <em>package.json</em> file.</p>
<p>Now, a <em>gulpfile.js</em> is needed to run gulp. A minimal one would be:

var gulp = require(&#39;gulp&#39;);

gulp.task(&#39;default&#39;, function() {
// place code for your default task here
});

Run it by typing <em>gulp</em>. The task is named <em>default</em>, and is the one run by gulp if no parameter is given. If a task named <em>foo</em> is set, you can run just this one by typing <em>gulp foo</em>. This is useful if there are many tasks and you don&#39;t want to run them all.</p>
<p>Gulp has many many plugins, that make almost everything you need to manage your files: testing, minifying, linting, moving, uploading, etc. Each plugin has to be installed using <em>npm install --save-dev plugin_name</em>.</p>
<p>Let&#39;s see some tasks from the <a href="https://github.com/rveciana/d3-composite-projections/blob/master/gulpfile.js">project gulpfile</a>:</p>
<p>
gulp.task(&#39;build&#39;, function(){
return gulp.src([&#39;./src/*.js&#39;])
.pipe(gp_newer(&#39;composite-projections.js&#39;), {extension: &#39;.js&#39;})
.pipe(gp_strip())
.pipe(gp_concat(&#39;composite-projections.js&#39;))
.pipe(gulp.dest(&#39;./&#39;))
.pipe(gp_rename(&#39;composite-projections.min.js&#39;))
.pipe(gp_uglify())
.pipe(gulp.dest(&#39;./&#39;));
});

This is one of the most common tasks. It takes several source files, removes the comments, merges them and, finally, minifies the resulting file.</p>
<ul>
<li>gulp.src sets the source files. In our case, all the files under the <em>src</em> folder</li>
<li>gulp<em>newer adds a condition: Only act if the source is newer than the _composite-projections.js</em> file</li>
<li>gulp_strip removes the comments so the output file is smaller</li>
<li>gulp<em>concat merges all the files in one, named _composite-projections.js</em>. This will be the main file in our project</li>
<li>gulp.dest sets the output folder to this stream. Now, the file is saved, but the stream is still open to do the following steps</li>
<li>gulp_rename changes the name of the output</li>
<li><a href="https://www.npmjs.com/package/gulp-uglify">gulp_uglify</a> runs <a href="https://github.com/mishoo/UglifyJS">UglifyJS</a>, which minifies the code, renaming all the variables, removing spaces and newlines, etc. so a compact and more efficient file is created</li>
<li>gulp.dest will save this new minified file too</li>
</ul>
<p>To build again the file, just type <em>gulp build</em>. Of course, usually we want to run several tasks at once, and the tasks have their own dependencies too. Those dependencies are set this way:

gulp.task(&#39;test&#39;, [&#39;build&#39;, &#39;build_separated&#39;, &#39;get_sample_data&#39;], function(){
return gulp.src(&#39;./test/test.js&#39;, {read: false})
.pipe(gp<em>mocha({reporter: &#39;nyan&#39;}));
});

This task, that will test the files as we&#39;ll see later, requires the tasks <em>&#39;build&#39;, &#39;build</em>separated&#39;</em> and <em>&#39;get_sample_data&#39;</em> to be run before it starts. It&#39;s logical, since no test can be done if the final file isn&#39;t built and the needed data is available. I like this method, since you only take care of the dependencies for each task, and the system decides what to run depending on the calculated final dependencies, which can be complicated.</p>
<p>Usually, the <em>default</em> task will have several dependencies, so they run all, and in parallel when possible. The default task itself can be void:

gulp.task(&#39;default&#39;, [&#39;lint&#39;,&#39;build&#39;, &#39;build_separated&#39;,&#39;test&#39;,&#39;license_year&#39;], function(){});
</p>
<p>There are several libraries similar to gulp, <a href="http://gruntjs.com/">grunt</a> is the most popular. I chose gulp after looking some comparisons, and because it was the last hype. I&#39;m happy with it, but the others seem nice too.</p>
<h2 id="linting-the-code">Linting the code</h2>
<p>Using a <a href="https://en.wikipedia.org/wiki/Lint_%28software%29">lint program</a> helps to code better by maintaining a nice code, using a good number of methods in the classes, etc. <a href="http://jshint.com/">JSHint</a> is a program that flags suspicious usage in programs written in JavaScript. It can be used with gulp, by installing the <em>gulp-jshint</em> plugin. The created task looks like this:

return gulp.src(&#39;./src/<em>.js&#39;)
.pipe(gp_jshint())
.pipe(gp_jshint.reporter(&#39;default&#39;));

Which will run for all the files under the *src\</em> folder (the original ones, with all the comments).
Let&#39;s see an example, if I change

return (y>=-0.10779&amp;&amp;y< 0.067673 &amp;&amp; x >= -0.1866 &amp;&amp; x < 0.0255 ? canaryIslands
: iberianPeninsule).invert(coordinates);

to

return (y>=-.10779&amp;&amp;y< .067673 &amp;&amp; x >= -0.1866 &amp;&amp; x < .0255 ? canaryIslands
: iberianPeninsule).invert(coordinates);

I&#39;ll get messages like:

src/conicConformalSpain-proj.js: line 54, col 23, A leading decimal point can be confused with a dot: &#39;.10779&#39;.

Sometimes, there are errors that you can&#39;t (or dont want to) avoid. In my case, I got the message:</p>
<p><code>Expected an assignment or function call and instead saw an expression</code></p>
<p>I google it and found a <a href="https://jslinterrors.com/expected-an-assignment-or-function-call">nice explanation and solution</a>, which is adding:

/_ jshint -W030 _/

in the function. I didn&#39;t change the code, since it was taken from the original Mike Bostock&#39;s one, and if he says it&#39;s better this way, I won&#39;t change it.</p>
<h2 id="testing-with-mocha">Testing with mocha</h2>
<p>Wether you want to use the <a href="https://en.wikipedia.org/wiki/Test-driven_development">test-driven developement</a> process or just test some results to your functions so the changes you make don&#39;t give wrong results, you need a test framework. <a href="https://mochajs.org/">Mocha</a> is one of the available ones. It&#39;s got a gulp plugin too, so it can be integrated to the project without problems.</p>
<p>First, I made a <em>test</em> directory to put all the test stuff. Then, installed mocha:

npm install -g mocha
npm install --save-dev gulp-mocha

Now, you can run mocha from any project, or integrate it in your project. The tests are in the <em>./tests/test.js</em> file, which looks like:

var assert = require(&#39;assert&#39;);
describe(&#39;Array&#39;, function() {
describe(&#39;#indexOf()&#39;, function () {
it(&#39;should return -1 when the value is not present&#39;, function () {
assert.equal(-1, [1,2,3].indexOf(5));
assert.equal(-1, [1,2,3].indexOf(0));
});
});
});

You can create as many tests as you want under <em>describe</em> and sub-tests under <em>it</em>.</p>
<p>In the case of d3-composite-projections, I found two things a bit more difficult to test. One is creating a sample <em>svg</em> file for each projection without using the browser. I explained how to do it in the post <a href="/d3/2015/05/29/d3-maps-nodejs.html">Creating maps using D3js and nodejs</a>.</p>
<p>The other is using the created javascript files without including the libraries in the code. Using d3js with node implies requiring it at the begining with <code>require(&#39;d3&#39;);</code>. But my generated file doesn&#39;t have that. <a href="http://stackoverflow.com/a/8808162/1086633">I found my solution at Stackoverflow</a>. Basically, you load the modules at <em>test.js</em> and pass it to the file as the context. In my example:

var execfile = require("./execfile.js");
var d3 = require(&#39;../node<em>modules/d3/d3.js&#39;);
var composite_projection = execfile(__dirname+"/../composite-projections.js",
{d3: d3, console: console});

This will allow the functions in composite-projections.js to use _d3</em> ant the console if necessary.</p>
<p>Mocha can do many other stuff, I have only used a very small part of it.</p>
<h2 id="publishing-the-code-at-github">Publishing the code at GitHub</h2>
<p>The code must be published somewhere if you want to share it. The most popular place right now is GitHub, and the other tools will go there to get the code.</p>
<p>You can either clone an existing repository before creating the code

git clone <a href="https://github.com/user/repo.git">https://github.com/user/repo.git</a>

or, if you already have the code, create a repository at GitHub and then:

git init
git add .
git commit -m "First commit"
git remote add origin <a href="https://github.com/user/repo.git">https://github.com/user/repo.git</a>
git remote -v

Changing the address to the created repository.</p>
<p>You can now change the <em>package.json</em> file adding the new repository, so NPM can work. In the case of -d3-composite-projections, the lines are:</p>
<p><pre><code>
<span class="token string">"repository"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
<span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"git"</span><span class="token punctuation">,</span>
<span class="token string">"url"</span><span class="token operator">:</span> <span class="token string">"&lt;a href="</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>rveciana<span class="token operator">/</span>d3<span class="token operator">-</span>composite<span class="token operator">-</span>projections<span class="token punctuation">.</span>git<span class="token string">""</span><span class="token operator">></span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>rveciana<span class="token operator">/</span>d3<span class="token operator">-</span>composite<span class="token operator">-</span>projections<span class="token punctuation">.</span>git"<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string">"bugs"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
<span class="token string">"url"</span><span class="token operator">:</span> <span class="token string">"&lt;a href="</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>rveciana<span class="token operator">/</span>d3<span class="token operator">-</span>composite<span class="token operator">-</span>projections<span class="token operator">/</span>issues<span class="token string">""</span><span class="token operator">></span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>rveciana<span class="token operator">/</span>d3<span class="token operator">-</span>composite<span class="token operator">-</span>projections<span class="token operator">/</span>issues"<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
Note that GitHub has a nice issues page for the projects, and that it can be linked here.</p>
<p>I added many directories at the .gitignore files to avoid filling the repository with temporary files.</p>
<h2 id="publishing-with-npm">Publishing with NPM</h2>
<p>Now that we have a good library, we can publish it to npm so other people can use it from nodejs. The first thing is to fill ahe empty fields you amy have at your <em>package.json</em> with the GitHub address, licence, etc. There are some <a href="https://docs.npmjs.com/getting-started/publishing-npm-packages">tutorials about how to so it step by step</a>.

npm adduser / npm login (use the second one if you already have a user)
npm config ls
npm publish
npm version <update_type>
git push --follow-tags
npm publish
</p>
<ol>
<li>You have to either create a user or set your existing user to the project.</li>
<li>config ls will test if the user is set properly</li>
<li>publish will publish if everything is well configured</li>
<li>If you want to publish a new version, you have first to create it using version. The <em>package.json</em> file will have a new version, and the git repo will be tagged with the new version too. The update types are:
..1. patch: v0.0.1 will become v0.0.2
..2. minor: v0.0.1 will become v0.1.0
..3. major: v0.0.1 will become v1.0.0</li>
<li>You have to push the new tag to GitHub</li>
<li>Now you can publish the package again</li>
</ol>
<p>I made many errors doing all this (plus changing the Bower version), so I put it into a gulp task:

function inc(importance) {
return gulp.src([&#39;./package.json&#39;, &#39;./bower.json&#39;])
.pipe(gp_bump({type: importance}))
.pipe(gulp.dest(&#39;./&#39;))
.pipe(gp_git.commit(&#39;Creating new package version&#39;))
.pipe(gp_filter(&#39;package.json&#39;))
.pipe(gp_tagversion());
};

gulp.task(&#39;patch&#39;, function() { return inc(&#39;patch&#39;); })
gulp.task(&#39;feature&#39;, function() { return inc(&#39;minor&#39;); })
gulp.task(&#39;release&#39;, function() { return inc(&#39;major&#39;); })
gulp.task(&#39;push&#39;, function(){
gp_git.push(&#39;origin&#39;, &#39;master&#39;, {args: " --follow-tags"}, function (err) {
if (err) throw err;
});
});
</p>
<ol>
<li>The <em>bump</em> plugin will increment all the <em>version</em> tags in the indicated files (bower.json and package.json) with the indicated type</li>
<li>Then, the <a href="https://www.npmjs.com/package/gulp-git">gulp-git</a> plugin will commit the changes</li>
<li>gulp_tagversion sets a new git tag with the same value set in package.json</li>
</ol>
<h2 id="publishing-with-bower">Publishing with Bower</h2>
<p><a href="http://bower.io/">Bower</a> is a tool to manage the dependencies at a web site. It keeps a track of the libraries and its versions your site depends on. Since d3-composite-projections is intended to be used in a web with d3, it&#39;s interesting to publish it at bower so people can use it in their projects. They have a <a href="http://bower.io/docs/creating-packages/">nice tutorial on creating a package</a>. Basically, for this project:

bower init
bower install d3 --save
bower register <my-package-name> <git-endpoint>
</p>
<ol>
<li>init will prompt some questions and create the <em>bower.json</em> file, as npm init did</li>
<li>The install system is identical to the npm one</li>
<li>Register uploads the project to bower. This works slightly different from npm, since bower will look at GitHub directly for new versions, so there is no need to interact with it any more, just remember to change the tag in the <em>bower.json</em> file</li>
</ol>
<h2 id="continuous-integration-with-travis">Continuous integration with Travis</h2>
<p><a href="https://travis-ci.org/">Travis CI</a> is a continuous integration tool that works very well with node.js and GitHub. It builds and tests all your files each time a commit is pushed to GitHub, and can even deploy the changes to NPM automatically only if everything goes well.</p>
<p>The first thing to set up Travis is to create your account. You can do it directly from GitHub, who will ask you a permission. Then, you can take the three steps shown in this image:</p>
<img src="/images/other/d3-library/travis.png"/>

<ul>
<li>Select the project you want to link</li>
<li>Create the .travis.yml file. In our case, use the <a href="https://docs.travis-ci.com/user/languages/javascript-with-nodejs">Travis javascript tutorial</a>, and specifically the <a href="https://docs.travis-ci.com/user/languages/javascript-with-nodejs#Using-Gulp">Travis gulp section</a></li>
<li>Publishing any commit will run your project at travis</li>
</ul>
<p>Since I was using a nodejs version higher than 4, <a href="https://docs.travis-ci.com/user/languages/javascript-with-nodejs#Node.js-v4-%28or-io.js-v3%29-compiler-requirements">this section</a> applies too. It may seem complicated, but the resulting file is quite simple:

language: node_js
node_js:
<ul>
<li>5.2.0
before_script:</li>
<li>npm install -g gulp
script: gulp
env:</li>
<li>CXX=g++-4.8
addons:
apt:
sources: - ubuntu-toolchain-r-test
packages: - g++-4.8

To automatize the NPM publication, you can use the travis command line. First, install it <a href="https://blog.travis-ci.com/2013-01-14-new-client/">using this instructions</a>. Then, just type

travis encrypt YOUR_API_KEY --add deploy.api_key
travis setup npm

The API key can be found at <code>~/.npmrc</code> and must be encrypted with the first command. The second command will add the configuration at your .travis.yml file. You just have to answer the questions. You can find more information in <a href="https://docs.travis-ci.com/user/deployment/npm#stq=&amp;stp=0">this tutorial</a>. My final deploy section looks like this:

deploy:
provider: npm
email: <a href="mailto:rveciana@gmail.com">rveciana@gmail.com</a>
api_key:
secure: EncryptedAPIKey
on:
tags: true
repo: rveciana/d3-composite-projections

The <code>tags: true</code> tag makes travis to deploy to NPM only if a tag has been changed, so other commits I may push will run the tests but won&#39;t change anything at the NPM repository.</li>
</ul>
<p>When you go to the <a href="https://travis-ci.org/rveciana/d3-composite-projections">travis project page</a>, you will find a small image like this:</p>
<p><a href="https://travis-ci.org/rveciana/d3-composite-projections"><img src="https://travis-ci.org/rveciana/d3-composite-projections.svg?branch=master" alt="travis image"></a></p>
<p>you can insert it into your README.md file or wherever you want so people can know if the last version is giving a good build result.</p>
</article></div></div></main>
<footer class="site-footer"><div class="wrapper"><div class="footer-col-wrapper"><div class="footer-col  footer-col-1"><ul class="contact-list"><li>GeoExamples - Roger Veciana</li></ul></div>

	<div class="footer-col  footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/rveciana"><span class="icon  icon--github"><svg viewBox="0 0 16 16"><path fill="#89b889" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"></path></svg></span>

						<span class="username">rveciana</span></a></li>

			<li><a href="https://twitter.com/rveciana"><span class="icon  icon--twitter"><svg viewBox="0 0 16 16"><path fill="#89b889" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                    c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"></path></svg></span>

						<span class="username">rveciana</span></a></li>
			<li><a href="https://www.linkedin.com/in/rogerveciana"><span class="icon  icon--twitter"><svg width="16" height="15.28958"><path d="M 0,1.77606 Q 0,1.00386 0.54054,0.50193 1.08108,0 1.94595,0 2.79537,0 3.32047,0.49421 3.86101,1.00386 3.86101,1.8224 q 0,0.74131 -0.5251,1.23552 -0.54054,0.50965 -1.42085,0.50965 l -0.0154,0 q -0.84942,0 -1.37452,-0.50965 Q 4e-5,2.54827 4e-5,1.77606 Z m 0.20078,13.51352 0,-10.3166 3.42857,0 0,10.3166 -3.42857,0 z m 5.32818,0 3.42857,0 0,-5.76062 q 0,-0.54054 0.12355,-0.83398 0.21622,-0.52509 0.65638,-0.88803 0.44015,-0.36293 1.10424,-0.36293 1.72973,0 1.72973,2.33205 l 0,5.51351 3.42857,0 0,-5.91506 Q 16,7.08881 14.91892,5.90734 13.83784,4.72587 12.06178,4.72587 q -1.99228,0 -3.10425,1.71429 l 0,0.0309 -0.0154,0 0.0154,-0.0309 0,-1.46718 -3.42857,0 q 0.0309,0.49421 0.0309,3.07336 0,2.57915 -0.0309,7.24324 z"></path></svg></span>

						<span class="username">rogerveciana</span></a></li></ul></div>

	<div class="footer-col  footer-col-3"><p class="text">I am a software developer and meteorologist who likes mapping. I put here the things I learn on my free time.</p>
		<p class="text">Roger Veciana i Rovira</p></div></div></div></footer>



	<script type="svelte-data" url="/summary_pages.json">{"status":200,"statusText":"","headers":{"content-type":"application/json"},"body":"[{\"title\":\"About\",\"permalink\":\"\u002Fabout\",\"excerpt\":\"\u003Cp\u003E{{ site.author.name }}\u003C\u002Fp\u003E\"},{\"title\":\"Projects\",\"permalink\":\"\u002Fprojects\",\"excerpt\":\"\u003Cp\u003ESome of my personal projects:\u003C\u002Fp\u003E\"},{\"title\":\"CV\",\"permalink\":\"\u002Fcv\",\"excerpt\":\"\u003Ch2 id=\\\"jobs\\\"\u003EJobs\u003C\u002Fh2\u003E\",\"avoidMainMenu\":true}]"}</script>

	<script type="svelte-data" url="npm_packages.html.json">{"status":200,"statusText":"","headers":{"content-type":"application/json"},"body":"{\"title\":\"Creating a D3 NPM package\",\"contents\":\"\u003Cp\u003ESome months ago I created a D3js projection, and published it to NMP and Bower. I wanted to use the opportunity to learn about Nodejs, NPM and so on. I write this post to remember all the steps I followed, and maybe is interesting for someone else.\u003C\u002Fp\u003E\\n\u003Ch2 id=\\\"the-final-code\\\"\u003EThe final code\u003C\u002Fh2\u003E\\n\u003Cp\u003EThe library I will talk about is explained in the \u003Ca href=\\\"\u002Fd3\u002F2015\u002F05\u002F12\u002Fd3-composite-projections.html\\\"\u003Eoriginal d3-composite-projections post\u003C\u002Fa\u003E. You can download it or take a look to the code at the \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Frveciana\u002Fd3-composite-projections\\\"\u003Eproject&#39;s GitHub page\u003C\u002Fa\u003E. If you already know how to use npm, just type \u003Ccode\u003Enpm install d3-composite-projections\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\\n\u003Cp\u003EI won&#39;t talk about the code itself, but about the tools I used to create it.\u003C\u002Fp\u003E\\n\u003Ch2 id=\\\"creating-the-nodejs-project\\\"\u003ECreating the nodejs project\u003C\u002Fh2\u003E\\n\u003Cp\u003ETo create a Nodejs project, the first thing is \u003Ca href=\\\"https:\u002F\u002Fnodejs.org\u002Fen\u002Fdownload\u002F\\\"\u003Einstalling Nodejs\u003C\u002Fa\u003E, of course. In the same step, \u003Ca href=\\\"https:\u002F\u002Fwww.npmjs.com\u002F\\\"\u003Enpm\u003C\u002Fa\u003E will be installed.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe first thing is initializing the project:\u003C\u002Fp\u003E\\n\u003Cp\u003E\\nnpm init\\n\u003C\u002Fp\u003E\\n\u003Cp\u003EThis will prompt some questions and save the information into a file called \u003Cem\u003Epackage.json\u003C\u002Fem\u003E. You can change the file whenever you want, so mistakes are not very important.\u003C\u002Fp\u003E\\n\u003Cp\u003EThis \u003Cem\u003Epackage.json\u003C\u002Fem\u003E file is important to publish the project, since it holds some information, but also for personal use, because stores the information about the dependencies of the project. You only keep your code, and using the command\\n\\nnpm install\\n\\nall the dependencies will be downloaded.\u003C\u002Fp\u003E\\n\u003Cp\u003ETo add a dependency, one of the following:\\n\\nnpm install name_of_the package\\nnpm install --save name_of_the package\\nnpm install --save-dev name_of_the package\\n\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003EThe first will install the dependency, but won&#39;t store it into \u003Cem\u003Epackage.json\u003C\u002Fem\u003E, so using npm install won&#39;t work in the future installations.\u003C\u002Fli\u003E\\n\u003Cli\u003EThe second options saves the dependency into the \u003Cem\u003Edependencies\u003C\u002Fem\u003E section, so it will be always downloaded\u003C\u002Fli\u003E\\n\u003Cli\u003EThe third option will save the dependency into the \u003Cem\u003EdevDependencies\u003C\u002Fem\u003E section. This allows to avoid downloading them when you only want to use the library, without developing it. For instance, when other software depends on your library, those won&#39;t be installed.\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Ch2 id=\\\"managing-the-workflow-with-gulp\\\"\u003EManaging the workflow with gulp\u003C\u002Fh2\u003E\\n\u003Cp\u003EA task manager is very useful when working with node. Since I&#39;m not using an IDE like Eclipse or NetBeans, all the tasks are run from the command line, and when the project grows a little, running all the commands can be long. Gulp helps you to do all this automatically creating what they call \u003Cem\u003Etasks\u003C\u002Fem\u003E. The tasks use \u003Cem\u003Estreams\u003C\u002Fem\u003E, which are remember me a little the unix pipes.\u003C\u002Fp\u003E\\n\u003Cp\u003ETo \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Fgulpjs\u002Fgulp\u002Fblob\u002Fmaster\u002Fdocs\u002Fgetting-started.md\\\"\u003Einstall gulp\u003C\u002Fa\u003E, you have to type:\\n\\nnpm install --global gulp\\nnpm install --save-dev gulp\\n\\nThis will install the dependency at the \u003Cem\u003Epackage.json\u003C\u002Fem\u003E file.\u003C\u002Fp\u003E\\n\u003Cp\u003ENow, a \u003Cem\u003Egulpfile.js\u003C\u002Fem\u003E is needed to run gulp. A minimal one would be:\\n\\nvar gulp = require(&#39;gulp&#39;);\\n\\ngulp.task(&#39;default&#39;, function() {\\n\u002F\u002F place code for your default task here\\n});\\n\\nRun it by typing \u003Cem\u003Egulp\u003C\u002Fem\u003E. The task is named \u003Cem\u003Edefault\u003C\u002Fem\u003E, and is the one run by gulp if no parameter is given. If a task named \u003Cem\u003Efoo\u003C\u002Fem\u003E is set, you can run just this one by typing \u003Cem\u003Egulp foo\u003C\u002Fem\u003E. This is useful if there are many tasks and you don&#39;t want to run them all.\u003C\u002Fp\u003E\\n\u003Cp\u003EGulp has many many plugins, that make almost everything you need to manage your files: testing, minifying, linting, moving, uploading, etc. Each plugin has to be installed using \u003Cem\u003Enpm install --save-dev plugin_name\u003C\u002Fem\u003E.\u003C\u002Fp\u003E\\n\u003Cp\u003ELet&#39;s see some tasks from the \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Frveciana\u002Fd3-composite-projections\u002Fblob\u002Fmaster\u002Fgulpfile.js\\\"\u003Eproject gulpfile\u003C\u002Fa\u003E:\u003C\u002Fp\u003E\\n\u003Cp\u003E\\ngulp.task(&#39;build&#39;, function(){\\nreturn gulp.src([&#39;.\u002Fsrc\u002F*.js&#39;])\\n.pipe(gp_newer(&#39;composite-projections.js&#39;), {extension: &#39;.js&#39;})\\n.pipe(gp_strip())\\n.pipe(gp_concat(&#39;composite-projections.js&#39;))\\n.pipe(gulp.dest(&#39;.\u002F&#39;))\\n.pipe(gp_rename(&#39;composite-projections.min.js&#39;))\\n.pipe(gp_uglify())\\n.pipe(gulp.dest(&#39;.\u002F&#39;));\\n});\\n\\nThis is one of the most common tasks. It takes several source files, removes the comments, merges them and, finally, minifies the resulting file.\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003Egulp.src sets the source files. In our case, all the files under the \u003Cem\u003Esrc\u003C\u002Fem\u003E folder\u003C\u002Fli\u003E\\n\u003Cli\u003Egulp\u003Cem\u003Enewer adds a condition: Only act if the source is newer than the _composite-projections.js\u003C\u002Fem\u003E file\u003C\u002Fli\u003E\\n\u003Cli\u003Egulp_strip removes the comments so the output file is smaller\u003C\u002Fli\u003E\\n\u003Cli\u003Egulp\u003Cem\u003Econcat merges all the files in one, named _composite-projections.js\u003C\u002Fem\u003E. This will be the main file in our project\u003C\u002Fli\u003E\\n\u003Cli\u003Egulp.dest sets the output folder to this stream. Now, the file is saved, but the stream is still open to do the following steps\u003C\u002Fli\u003E\\n\u003Cli\u003Egulp_rename changes the name of the output\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fwww.npmjs.com\u002Fpackage\u002Fgulp-uglify\\\"\u003Egulp_uglify\u003C\u002Fa\u003E runs \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Fmishoo\u002FUglifyJS\\\"\u003EUglifyJS\u003C\u002Fa\u003E, which minifies the code, renaming all the variables, removing spaces and newlines, etc. so a compact and more efficient file is created\u003C\u002Fli\u003E\\n\u003Cli\u003Egulp.dest will save this new minified file too\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Cp\u003ETo build again the file, just type \u003Cem\u003Egulp build\u003C\u002Fem\u003E. Of course, usually we want to run several tasks at once, and the tasks have their own dependencies too. Those dependencies are set this way:\\n\\ngulp.task(&#39;test&#39;, [&#39;build&#39;, &#39;build_separated&#39;, &#39;get_sample_data&#39;], function(){\\nreturn gulp.src(&#39;.\u002Ftest\u002Ftest.js&#39;, {read: false})\\n.pipe(gp\u003Cem\u003Emocha({reporter: &#39;nyan&#39;}));\\n});\\n\\nThis task, that will test the files as we&#39;ll see later, requires the tasks \u003Cem\u003E&#39;build&#39;, &#39;build\u003C\u002Fem\u003Eseparated&#39;\u003C\u002Fem\u003E and \u003Cem\u003E&#39;get_sample_data&#39;\u003C\u002Fem\u003E to be run before it starts. It&#39;s logical, since no test can be done if the final file isn&#39;t built and the needed data is available. I like this method, since you only take care of the dependencies for each task, and the system decides what to run depending on the calculated final dependencies, which can be complicated.\u003C\u002Fp\u003E\\n\u003Cp\u003EUsually, the \u003Cem\u003Edefault\u003C\u002Fem\u003E task will have several dependencies, so they run all, and in parallel when possible. The default task itself can be void:\\n\\ngulp.task(&#39;default&#39;, [&#39;lint&#39;,&#39;build&#39;, &#39;build_separated&#39;,&#39;test&#39;,&#39;license_year&#39;], function(){});\\n\u003C\u002Fp\u003E\\n\u003Cp\u003EThere are several libraries similar to gulp, \u003Ca href=\\\"http:\u002F\u002Fgruntjs.com\u002F\\\"\u003Egrunt\u003C\u002Fa\u003E is the most popular. I chose gulp after looking some comparisons, and because it was the last hype. I&#39;m happy with it, but the others seem nice too.\u003C\u002Fp\u003E\\n\u003Ch2 id=\\\"linting-the-code\\\"\u003ELinting the code\u003C\u002Fh2\u003E\\n\u003Cp\u003EUsing a \u003Ca href=\\\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FLint_%28software%29\\\"\u003Elint program\u003C\u002Fa\u003E helps to code better by maintaining a nice code, using a good number of methods in the classes, etc. \u003Ca href=\\\"http:\u002F\u002Fjshint.com\u002F\\\"\u003EJSHint\u003C\u002Fa\u003E is a program that flags suspicious usage in programs written in JavaScript. It can be used with gulp, by installing the \u003Cem\u003Egulp-jshint\u003C\u002Fem\u003E plugin. The created task looks like this:\\n\\nreturn gulp.src(&#39;.\u002Fsrc\u002F\u003Cem\u003E.js&#39;)\\n.pipe(gp_jshint())\\n.pipe(gp_jshint.reporter(&#39;default&#39;));\\n\\nWhich will run for all the files under the *src\\\\\u003C\u002Fem\u003E folder (the original ones, with all the comments).\\nLet&#39;s see an example, if I change\\n\\nreturn (y\u003E=-0.10779&amp;&amp;y\u003C 0.067673 &amp;&amp; x \u003E= -0.1866 &amp;&amp; x \u003C 0.0255 ? canaryIslands\\n: iberianPeninsule).invert(coordinates);\\n\\nto\\n\\nreturn (y\u003E=-.10779&amp;&amp;y\u003C .067673 &amp;&amp; x \u003E= -0.1866 &amp;&amp; x \u003C .0255 ? canaryIslands\\n: iberianPeninsule).invert(coordinates);\\n\\nI&#39;ll get messages like:\\n\\nsrc\u002FconicConformalSpain-proj.js: line 54, col 23, A leading decimal point can be confused with a dot: &#39;.10779&#39;.\\n\\nSometimes, there are errors that you can&#39;t (or dont want to) avoid. In my case, I got the message:\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Ccode\u003EExpected an assignment or function call and instead saw an expression\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EI google it and found a \u003Ca href=\\\"https:\u002F\u002Fjslinterrors.com\u002Fexpected-an-assignment-or-function-call\\\"\u003Enice explanation and solution\u003C\u002Fa\u003E, which is adding:\\n\\n\u002F_ jshint -W030 _\u002F\\n\\nin the function. I didn&#39;t change the code, since it was taken from the original Mike Bostock&#39;s one, and if he says it&#39;s better this way, I won&#39;t change it.\u003C\u002Fp\u003E\\n\u003Ch2 id=\\\"testing-with-mocha\\\"\u003ETesting with mocha\u003C\u002Fh2\u003E\\n\u003Cp\u003EWether you want to use the \u003Ca href=\\\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FTest-driven_development\\\"\u003Etest-driven developement\u003C\u002Fa\u003E process or just test some results to your functions so the changes you make don&#39;t give wrong results, you need a test framework. \u003Ca href=\\\"https:\u002F\u002Fmochajs.org\u002F\\\"\u003EMocha\u003C\u002Fa\u003E is one of the available ones. It&#39;s got a gulp plugin too, so it can be integrated to the project without problems.\u003C\u002Fp\u003E\\n\u003Cp\u003EFirst, I made a \u003Cem\u003Etest\u003C\u002Fem\u003E directory to put all the test stuff. Then, installed mocha:\\n\\nnpm install -g mocha\\nnpm install --save-dev gulp-mocha\\n\\nNow, you can run mocha from any project, or integrate it in your project. The tests are in the \u003Cem\u003E.\u002Ftests\u002Ftest.js\u003C\u002Fem\u003E file, which looks like:\\n\\nvar assert = require(&#39;assert&#39;);\\ndescribe(&#39;Array&#39;, function() {\\ndescribe(&#39;#indexOf()&#39;, function () {\\nit(&#39;should return -1 when the value is not present&#39;, function () {\\nassert.equal(-1, [1,2,3].indexOf(5));\\nassert.equal(-1, [1,2,3].indexOf(0));\\n});\\n});\\n});\\n\\nYou can create as many tests as you want under \u003Cem\u003Edescribe\u003C\u002Fem\u003E and sub-tests under \u003Cem\u003Eit\u003C\u002Fem\u003E.\u003C\u002Fp\u003E\\n\u003Cp\u003EIn the case of d3-composite-projections, I found two things a bit more difficult to test. One is creating a sample \u003Cem\u003Esvg\u003C\u002Fem\u003E file for each projection without using the browser. I explained how to do it in the post \u003Ca href=\\\"\u002Fd3\u002F2015\u002F05\u002F29\u002Fd3-maps-nodejs.html\\\"\u003ECreating maps using D3js and nodejs\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe other is using the created javascript files without including the libraries in the code. Using d3js with node implies requiring it at the begining with \u003Ccode\u003Erequire(&#39;d3&#39;);\u003C\u002Fcode\u003E. But my generated file doesn&#39;t have that. \u003Ca href=\\\"http:\u002F\u002Fstackoverflow.com\u002Fa\u002F8808162\u002F1086633\\\"\u003EI found my solution at Stackoverflow\u003C\u002Fa\u003E. Basically, you load the modules at \u003Cem\u003Etest.js\u003C\u002Fem\u003E and pass it to the file as the context. In my example:\\n\\nvar execfile = require(\\\".\u002Fexecfile.js\\\");\\nvar d3 = require(&#39;..\u002Fnode\u003Cem\u003Emodules\u002Fd3\u002Fd3.js&#39;);\\nvar composite_projection = execfile(__dirname+\\\"\u002F..\u002Fcomposite-projections.js\\\",\\n{d3: d3, console: console});\\n\\nThis will allow the functions in composite-projections.js to use _d3\u003C\u002Fem\u003E ant the console if necessary.\u003C\u002Fp\u003E\\n\u003Cp\u003EMocha can do many other stuff, I have only used a very small part of it.\u003C\u002Fp\u003E\\n\u003Ch2 id=\\\"publishing-the-code-at-github\\\"\u003EPublishing the code at GitHub\u003C\u002Fh2\u003E\\n\u003Cp\u003EThe code must be published somewhere if you want to share it. The most popular place right now is GitHub, and the other tools will go there to get the code.\u003C\u002Fp\u003E\\n\u003Cp\u003EYou can either clone an existing repository before creating the code\\n\\ngit clone \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Fuser\u002Frepo.git\\\"\u003Ehttps:\u002F\u002Fgithub.com\u002Fuser\u002Frepo.git\u003C\u002Fa\u003E\\n\\nor, if you already have the code, create a repository at GitHub and then:\\n\\ngit init\\ngit add .\\ngit commit -m \\\"First commit\\\"\\ngit remote add origin \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Fuser\u002Frepo.git\\\"\u003Ehttps:\u002F\u002Fgithub.com\u002Fuser\u002Frepo.git\u003C\u002Fa\u003E\\ngit remote -v\\n\\nChanging the address to the created repository.\u003C\u002Fp\u003E\\n\u003Cp\u003EYou can now change the \u003Cem\u003Epackage.json\u003C\u002Fem\u003E file adding the new repository, so NPM can work. In the case of -d3-composite-projections, the lines are:\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cpre\u003E\u003Ccode\u003E\\n\u003Cspan class=\\\"token string\\\"\u003E\\\"repository\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token string\\\"\u003E\\\"type\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E\\\"git\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token string\\\"\u003E\\\"url\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E\\\"&lt;a href=\\\"\u003C\u002Fspan\u003Ehttps\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Egithub\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ecom\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Erveciana\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Ed3\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003Ecomposite\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003Eprojections\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Egit\u003Cspan class=\\\"token string\\\"\u003E\\\"\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003Ehttps\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Egithub\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ecom\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Erveciana\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Ed3\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003Ecomposite\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003Eprojections\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Egit\\\"\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Ea\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token string\\\"\u003E\\\"bugs\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token string\\\"\u003E\\\"url\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E\\\"&lt;a href=\\\"\u003C\u002Fspan\u003Ehttps\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Egithub\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ecom\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Erveciana\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Ed3\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003Ecomposite\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003Eprojections\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Eissues\u003Cspan class=\\\"token string\\\"\u003E\\\"\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003Ehttps\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Egithub\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ecom\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Erveciana\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Ed3\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003Ecomposite\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003Eprojections\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Eissues\\\"\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Ea\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\nNote that GitHub has a nice issues page for the projects, and that it can be linked here.\u003C\u002Fp\u003E\\n\u003Cp\u003EI added many directories at the .gitignore files to avoid filling the repository with temporary files.\u003C\u002Fp\u003E\\n\u003Ch2 id=\\\"publishing-with-npm\\\"\u003EPublishing with NPM\u003C\u002Fh2\u003E\\n\u003Cp\u003ENow that we have a good library, we can publish it to npm so other people can use it from nodejs. The first thing is to fill ahe empty fields you amy have at your \u003Cem\u003Epackage.json\u003C\u002Fem\u003E with the GitHub address, licence, etc. There are some \u003Ca href=\\\"https:\u002F\u002Fdocs.npmjs.com\u002Fgetting-started\u002Fpublishing-npm-packages\\\"\u003Etutorials about how to so it step by step\u003C\u002Fa\u003E.\\n\\nnpm adduser \u002F npm login (use the second one if you already have a user)\\nnpm config ls\\nnpm publish\\nnpm version \u003Cupdate_type\u003E\\ngit push --follow-tags\\nnpm publish\\n\u003C\u002Fp\u003E\\n\u003Col\u003E\\n\u003Cli\u003EYou have to either create a user or set your existing user to the project.\u003C\u002Fli\u003E\\n\u003Cli\u003Econfig ls will test if the user is set properly\u003C\u002Fli\u003E\\n\u003Cli\u003Epublish will publish if everything is well configured\u003C\u002Fli\u003E\\n\u003Cli\u003EIf you want to publish a new version, you have first to create it using version. The \u003Cem\u003Epackage.json\u003C\u002Fem\u003E file will have a new version, and the git repo will be tagged with the new version too. The update types are:\\n..1. patch: v0.0.1 will become v0.0.2\\n..2. minor: v0.0.1 will become v0.1.0\\n..3. major: v0.0.1 will become v1.0.0\u003C\u002Fli\u003E\\n\u003Cli\u003EYou have to push the new tag to GitHub\u003C\u002Fli\u003E\\n\u003Cli\u003ENow you can publish the package again\u003C\u002Fli\u003E\\n\u003C\u002Fol\u003E\\n\u003Cp\u003EI made many errors doing all this (plus changing the Bower version), so I put it into a gulp task:\\n\\nfunction inc(importance) {\\nreturn gulp.src([&#39;.\u002Fpackage.json&#39;, &#39;.\u002Fbower.json&#39;])\\n.pipe(gp_bump({type: importance}))\\n.pipe(gulp.dest(&#39;.\u002F&#39;))\\n.pipe(gp_git.commit(&#39;Creating new package version&#39;))\\n.pipe(gp_filter(&#39;package.json&#39;))\\n.pipe(gp_tagversion());\\n};\\n\\ngulp.task(&#39;patch&#39;, function() { return inc(&#39;patch&#39;); })\\ngulp.task(&#39;feature&#39;, function() { return inc(&#39;minor&#39;); })\\ngulp.task(&#39;release&#39;, function() { return inc(&#39;major&#39;); })\\ngulp.task(&#39;push&#39;, function(){\\ngp_git.push(&#39;origin&#39;, &#39;master&#39;, {args: \\\" --follow-tags\\\"}, function (err) {\\nif (err) throw err;\\n});\\n});\\n\u003C\u002Fp\u003E\\n\u003Col\u003E\\n\u003Cli\u003EThe \u003Cem\u003Ebump\u003C\u002Fem\u003E plugin will increment all the \u003Cem\u003Eversion\u003C\u002Fem\u003E tags in the indicated files (bower.json and package.json) with the indicated type\u003C\u002Fli\u003E\\n\u003Cli\u003EThen, the \u003Ca href=\\\"https:\u002F\u002Fwww.npmjs.com\u002Fpackage\u002Fgulp-git\\\"\u003Egulp-git\u003C\u002Fa\u003E plugin will commit the changes\u003C\u002Fli\u003E\\n\u003Cli\u003Egulp_tagversion sets a new git tag with the same value set in package.json\u003C\u002Fli\u003E\\n\u003C\u002Fol\u003E\\n\u003Ch2 id=\\\"publishing-with-bower\\\"\u003EPublishing with Bower\u003C\u002Fh2\u003E\\n\u003Cp\u003E\u003Ca href=\\\"http:\u002F\u002Fbower.io\u002F\\\"\u003EBower\u003C\u002Fa\u003E is a tool to manage the dependencies at a web site. It keeps a track of the libraries and its versions your site depends on. Since d3-composite-projections is intended to be used in a web with d3, it&#39;s interesting to publish it at bower so people can use it in their projects. They have a \u003Ca href=\\\"http:\u002F\u002Fbower.io\u002Fdocs\u002Fcreating-packages\u002F\\\"\u003Enice tutorial on creating a package\u003C\u002Fa\u003E. Basically, for this project:\\n\\nbower init\\nbower install d3 --save\\nbower register \u003Cmy-package-name\u003E \u003Cgit-endpoint\u003E\\n\u003C\u002Fp\u003E\\n\u003Col\u003E\\n\u003Cli\u003Einit will prompt some questions and create the \u003Cem\u003Ebower.json\u003C\u002Fem\u003E file, as npm init did\u003C\u002Fli\u003E\\n\u003Cli\u003EThe install system is identical to the npm one\u003C\u002Fli\u003E\\n\u003Cli\u003ERegister uploads the project to bower. This works slightly different from npm, since bower will look at GitHub directly for new versions, so there is no need to interact with it any more, just remember to change the tag in the \u003Cem\u003Ebower.json\u003C\u002Fem\u003E file\u003C\u002Fli\u003E\\n\u003C\u002Fol\u003E\\n\u003Ch2 id=\\\"continuous-integration-with-travis\\\"\u003EContinuous integration with Travis\u003C\u002Fh2\u003E\\n\u003Cp\u003E\u003Ca href=\\\"https:\u002F\u002Ftravis-ci.org\u002F\\\"\u003ETravis CI\u003C\u002Fa\u003E is a continuous integration tool that works very well with node.js and GitHub. It builds and tests all your files each time a commit is pushed to GitHub, and can even deploy the changes to NPM automatically only if everything goes well.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe first thing to set up Travis is to create your account. You can do it directly from GitHub, who will ask you a permission. Then, you can take the three steps shown in this image:\u003C\u002Fp\u003E\\n\u003Cimg src=\\\"\u002Fimages\u002Fother\u002Fd3-library\u002Ftravis.png\\\"\u002F\u003E\\n\\n\u003Cul\u003E\\n\u003Cli\u003ESelect the project you want to link\u003C\u002Fli\u003E\\n\u003Cli\u003ECreate the .travis.yml file. In our case, use the \u003Ca href=\\\"https:\u002F\u002Fdocs.travis-ci.com\u002Fuser\u002Flanguages\u002Fjavascript-with-nodejs\\\"\u003ETravis javascript tutorial\u003C\u002Fa\u003E, and specifically the \u003Ca href=\\\"https:\u002F\u002Fdocs.travis-ci.com\u002Fuser\u002Flanguages\u002Fjavascript-with-nodejs#Using-Gulp\\\"\u003ETravis gulp section\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003EPublishing any commit will run your project at travis\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Cp\u003ESince I was using a nodejs version higher than 4, \u003Ca href=\\\"https:\u002F\u002Fdocs.travis-ci.com\u002Fuser\u002Flanguages\u002Fjavascript-with-nodejs#Node.js-v4-%28or-io.js-v3%29-compiler-requirements\\\"\u003Ethis section\u003C\u002Fa\u003E applies too. It may seem complicated, but the resulting file is quite simple:\\n\\nlanguage: node_js\\nnode_js:\\n\u003Cul\u003E\\n\u003Cli\u003E5.2.0\\nbefore_script:\u003C\u002Fli\u003E\\n\u003Cli\u003Enpm install -g gulp\\nscript: gulp\\nenv:\u003C\u002Fli\u003E\\n\u003Cli\u003ECXX=g++-4.8\\naddons:\\napt:\\nsources: - ubuntu-toolchain-r-test\\npackages: - g++-4.8\\n\\nTo automatize the NPM publication, you can use the travis command line. First, install it \u003Ca href=\\\"https:\u002F\u002Fblog.travis-ci.com\u002F2013-01-14-new-client\u002F\\\"\u003Eusing this instructions\u003C\u002Fa\u003E. Then, just type\\n\\ntravis encrypt YOUR_API_KEY --add deploy.api_key\\ntravis setup npm\\n\\nThe API key can be found at \u003Ccode\u003E~\u002F.npmrc\u003C\u002Fcode\u003E and must be encrypted with the first command. The second command will add the configuration at your .travis.yml file. You just have to answer the questions. You can find more information in \u003Ca href=\\\"https:\u002F\u002Fdocs.travis-ci.com\u002Fuser\u002Fdeployment\u002Fnpm#stq=&amp;stp=0\\\"\u003Ethis tutorial\u003C\u002Fa\u003E. My final deploy section looks like this:\\n\\ndeploy:\\nprovider: npm\\nemail: \u003Ca href=\\\"mailto:rveciana@gmail.com\\\"\u003Erveciana@gmail.com\u003C\u002Fa\u003E\\napi_key:\\nsecure: EncryptedAPIKey\\non:\\ntags: true\\nrepo: rveciana\u002Fd3-composite-projections\\n\\nThe \u003Ccode\u003Etags: true\u003C\u002Fcode\u003E tag makes travis to deploy to NPM only if a tag has been changed, so other commits I may push will run the tests but won&#39;t change anything at the NPM repository.\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Cp\u003EWhen you go to the \u003Ca href=\\\"https:\u002F\u002Ftravis-ci.org\u002Frveciana\u002Fd3-composite-projections\\\"\u003Etravis project page\u003C\u002Fa\u003E, you will find a small image like this:\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Ca href=\\\"https:\u002F\u002Ftravis-ci.org\u002Frveciana\u002Fd3-composite-projections\\\"\u003E\u003Cimg src=\\\"https:\u002F\u002Ftravis-ci.org\u002Frveciana\u002Fd3-composite-projections.svg?branch=master\\\" alt=\\\"travis image\\\"\u003E\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003Eyou can insert it into your README.md file or wherever you want so people can know if the last version is giving a good build result.\u003C\u002Fp\u003E\\n\",\"tags\":[\"npm\",\"nodejs\",\"bower\",\"travis\",\"mocha\",\"tutorial\",\"projections\"],\"date\":\"2015-12-22T00:00:00.000Z\"}"}</script>
</div>
	</body>
</html>
