<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="/favicon.ico" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="manifest" href="/manifest.json" />
		<meta name="theme-color" content="#cdffcd">
		<!-- HTML Meta Tags -->
		<title>GeoExamples - Roger Veciana</title>
		<meta
			name="description"
			content="I am a software developer and meteorologist who likes mapping. I put here the things I learn on my free time."
		/>
		<!-- Google / Search Engine Tags -->
		<meta itemprop="name" content=">GeoExamples - Roger Veciana" />
		<meta
			itemprop="description"
			content="I am a software developer and meteorologist who likes mapping. I put here the things I learn on my free time."
		/>
		<meta itemprop="image" content="https://geoexamples.com/siteImage.png" />
		<!-- Facebook Meta Tags -->
		<meta property="og:url" content="https://geoexamples.com" />
		<meta property="og:type" content="website" />
		<meta property="og:title" content="GeoExamples - Roger Veciana" />
		<meta
			property="og:description"
			content="I am a software developer and meteorologist who likes mapping. I put here the things I learn on my free time."
		/>
		<meta property="og:image" content="https://geoexamples.com/siteImage.png" />
		<!-- Twitter Meta Tags -->
		<meta name="twitter:card" content="summary" />
		<meta name="twitter:title" content="GeoExamples - Roger Veciana" />
		<meta name="twitter:description"
		  content="I am a software developer and meteorologist who likes mapping. I put here the things I learn on my free time." />
		<meta name="twitter:image" content="https://geoexamples.com/siteImage.png" />
		



<link rel="modulepreload" href="/./_app/start-44631b0b.js">
			<link rel="modulepreload" href="/./_app/chunks/vendor-ff3d1764.js">
			<link rel="modulepreload" href="/./_app/chunks/config-b3bde751.js">
			<link rel="modulepreload" href="/./_app/pages\[category]\[year]\[month]\[date]\[slug].svelte-a77716b3.js">
			<link rel="stylesheet" href="/./_app/assets/start-34a290f9.css">


		<script type="module">
			import { start } from "/./_app/start-44631b0b.js";
			start({
				target: document.querySelector("#svelte"),
				paths: {"base":"","assets":"/."},
				session: {},
				host: location.host,
				route: true,
				hydrate: {
					status: 200,
					error: null,
					nodes: [
						import("/./_app/pages\\[category]\\[year]\\[month]\\[date]\\[slug].svelte-a77716b3.js")
					],
					page: {
						host: location.host, // TODO this is redundant
						path: "/other/2019/12/08/mapping-svelte.html",
						query: new URLSearchParams(""),
						params: {"category":"other","year":"2019","month":"12","date":"08","slug":"mapping-svelte.html"}
					}
				}
			});
		</script>
	</head>
	<body>
		<div id="svelte">


<header class="site-header"><div class="wrapper"><a class="site-title" href="/">GeoExamples - Roger Veciana</a>

<nav class="site-nav"><div href="#" class="menu-icon"><svg viewBox="0 0 18 15"><path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"></path><path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"></path><path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"></path></svg></div>

	<div class="trigger"><a class="page-link" href="/about">About</a><a class="page-link" href="/blog">Blog</a><a class="page-link" href="/projects">Projects</a></div></nav></div></header>

<main class="page-content"><div class="wrapper"><div class="post"><header class="post-header"><h1 class="post-title">Mapping with Svelte and D3js</h1>
<p class="post-meta">Dec 8, 2019</p></header>

	<article class="post-content"><p><a href="https://svelte.dev/">Svelte</a> is a very nice framework for building user interfaces. I wanted to learn more about it, and loved that the <em>d3-like</em> transitions are included and well documented, and much easier than in React, that is my daily library.</p>
<p>So I thought that some cool mapping examples could be done easily and I was right, so here we go!</p>
<p>Don&#39;t want to read all this? Check the examples:</p>
<ul>
<li><a href="https://bl.ocks.org/rveciana/4071d3c6a0b58f98893fb311306b038c">Example 1: Basic map</a></li>
<li><a href="https://bl.ocks.org/rveciana/9026255839233498dbe979ea69ad3af2">Example 2: Multiple geometries and color scale</a></li>
<li><a href="https://bl.ocks.org/rveciana/a8f24ce0ea98e403e266dfb4f9b6b2e9">Example 3: Adding transitions</a></li>
<li><a href="https://bl.ocks.org/rveciana/653784cfab5d859610926733cfb14773">Example 4: Adding circles</a></li>
</ul>
<h2 id="dom-projections-and-scales">DOM, projections and scales</h2>
<p>Svelte controls the DOM (<a href="https://svelte.dev/blog/virtual-dom-is-pure-overhead">not with a virtual DOM as React or Vue</a>), and has no projection functions for mapping. I wanted to keep all the control into Svelte, so no D3js has been used for this, unlike many of the React with D3 examples out there. Svelte&#39;s <a href="https://svelte.dev/tutorial/tweened">Tweened</a> can do this perfectly.</p>
<p>On the other hand, D3 has been splitted long ago into several parts, in a really nice decision. This allows us to take only the parts we want and use them anywhere. The examples will use the projections and scales provided by D3 to calculate the paths.</p>
<h2 id="installing-the-examples">Installing the examples</h2>
<p>The easiest way to start any Svelte project is running:</p>
<pre><code>npx degit sveltejs/template svelte-app
cd svelte-app
npm run dev</code></pre><p>This will download the tempate project and run it at the port 5000. All the changes to be done are in the <em>App.svelte</em> file.</p>
<p>So, for all these examples, create a project and start manipulating the <em>App.svelte</em> file with the provided code.</p>
<p>To run all the examples, severall libraries have to be installed too:</p>
<pre><code>npm install topojson, d3-geo, d3-composite-projections, d3-scale, d3-color, d3-interpolate</code></pre><h2 id="basic-map">Basic map</h2>
<p><a href="https://bl.ocks.org/rveciana/4071d3c6a0b58f98893fb311306b038c">This first example</a> creates the easiest map:</p>
<img width="50%" src="/images/d3/mapping-svelte/example1.png"/>

<p>The <em>App.svelte</em> file would be:</p>
<p>
<script>
  import { geoAlbers, geoPath } from "d3-geo";
  import { onMount } from "svelte";
  import { feature } from "topojson";
  let data;
  const projection = geoAlbers();
  const path = geoPath().projection(projection);

onMount(async function() {
const response = await fetch(
"https://gist.githubusercontent.com/rveciana/a2a1c21ca1c71cd3ec116cc911e5fce9/raw/79564dfa2c56745ebd62f5655a6cc19d2cffa1ea/us.json"
);
const json = await response.json();
const land = feature(json, json.objects.land);
data = path(land);
});
</script>

<style>
  svg {
    width: 960px;
    height: 500px;
  }
  .border {
    stroke: #444444;
    fill: #cccccc;
  }
</style>

<svg width="960" height="500">
  <path d={data} class="border" />
</svg>


<ul>
<li>The file is structured in three parts:<ul>
<li>script, where all the JavaScript goes</li>
<li>style, where the css for the map is set</li>
<li>The template part, where the HTML elements are defined</li>
</ul>
</li>
<li>The <em>onMount</em> function is run only once, when the component is mounted. Is here where we will fetch the JSON data we need to draw the map.<ul>
<li><em>feature</em> is the function from the <a href="https://github.com/topojson/topojson-client/blob/master/README.md#feature">topojson library to decode the topojson file</a></li>
<li><em>data</em> will have the svg path definition fot the map. Why is declared outside the <em>onMount</em> function? Because it&#39;s used in the template, and since <em>onMount</em> is <em>async</em>, the variable wouldn&#39;t be available when the component is created, giving an error. By doing it this way, the path will be null at the beginning, and the component will re-render when the data is loaded.</li>
</ul>
</li>
<li>Note that path and projection are taken directly from D3js, but are only pure functions that return the SVG path string given a GeoJSON data. Nothing related to the DOM</li>
<li>The path is defined to hold the <em>data</em> value as the d attribute</li>
</ul>
<h2 id="adding-multiple-geometries-and-color-scale">Adding multiple geometries and color scale</h2>
<p>Let&#39;s add now more geometries and a color scale to fill them. This example and the next ones are all based on <a href="https://observablehq.com/@rveciana/use-composite-projections-scotland">this Observable</a>. <a href="https://bl.ocks.org/rveciana/9026255839233498dbe979ea69ad3af2">Check the result</a></p>
<img width="50%" src="/images/d3/mapping-svelte/example2.png"/>

<p>
<script>
  import { geoAlbers, geoPath } from "d3-geo";
  import { scaleLinear } from "d3-scale";
  import { extent } from "d3-array";
  import { onMount } from "svelte";
  import { feature } from "topojson";
  let data = [];
  let colorScale = () => {};
  const width = "960";
  const height = "500";
  const projectionAlbers = geoAlbers()
    .rotate([4.4, 0.8])
    .center([0, 55.4])
    .parallels([50, 60])
    .scale(3800)
    .translate([width / 2, (1.8 * height) / 2]);

  let currentProj = projectionAlbers;
  let path = geoPath().projection(currentProj);

  onMount(async function() {
    const response = await fetch(
      "https://gist.githubusercontent.com/rveciana/27272a581e975835aaa321ddf816d726/raw/c40062a328843322208b8e98c2104dc8f6ad5301/uk-counties.json"
    );
    const json = await response.json();
    const topoData = feature(json, json.objects.UK);
    const land = {
      ...topoData,
      features: topoData.features.filter(
        d => d.properties.NAME_1 === "Scotland"
      )
    };

    const namesExtent = extent(land.features, d => d.properties.NAME_2.length);
    colorScale = scaleLinear()
      .domain(namesExtent)
      .range(["#feedde", "#fd8d3c"]);
    data = land.features;
  });
</script>

<style>
  svg {
    width: 960px;
    height: 500px;
    background-color: "#eeeeee";
  }
  .provinceShape {
    stroke: #444444;
    stroke-width: 0.5;
  }
</style>

<svg width="960" height="500">
  {#each data as feature}
    <path
      d={path(feature)}
      class="provinceShape"
      fill={colorScale(feature.properties.NAME_2.length)} />
  {/each}
</svg>


<ul>
<li>We are using now another projection (<a href="https://github.com/d3/d3-geo#geoAlbers">geoAlbers</a>), so the next examples become more interesting</li>
<li>All the strange stuff with the topojson data is to get only the Scotland counties from the file that contains all the UK counties</li>
<li>Note the use of <em>scaleLinear</em> to get a color scale. The extent is only the minimum and maximum length of the names of the counties. Just to have some data to plot!</li>
<li>Now, in the template part, an <em>each</em> block is used to plot a different path for each county. The color is calculated with the color scale</li>
<li>Note that, again, the color scale and data have to be declared outside the <em>onMount</em> block</li>
</ul>
<h2 id="changing-the-color-when-mouse-is-over">Changing the color when mouse is over</h2>
<p>Well, this starts to be interesting. This is where Svelte makes things really easier. We want the same map we had on the previous example but when we hover on a county, we want this county color change a little so the user knows it. This means having behaviours for each path, so we will need nested components.
Also, we want to change the projection to a composed one when clicking a button. <a href="https://bl.ocks.org/rveciana/a8f24ce0ea98e403e266dfb4f9b6b2e9">Check the result</a></p>
<img width="50%" src="/images/d3/mapping-svelte/example3.png"/>

<p>Let&#39;s start with the nested component, called <em>Feature.svelte</em>. Copy this into your project too!</p>
<p>
<script>
  import { tweened } from "svelte/motion";
  import { interpolateLab } from "d3-interpolate";
  import { rgb } from "d3-color";
  export let featurePath;
  export let initialColor;

  const color = tweened(initialColor, {
    duration: 300,
    interpolate: interpolateLab
  });
</script>

<style>
  .provinceShape {
    stroke: #444444;
    stroke-width: 0.5;
  }
</style>


<path
d={featurePath}
class="provinceShape"
fill={$color}
on:mouseover={() => {
color.set(rgb(initialColor).brighter(0.3));
}}
on:mouseout={() => {
color.set(initialColor);
}} />
</p>
<ul>
<li>The idea, as you can see on the tempalte section, is rendering only the SVG path element. The path itself is given by a prop (note the export on the 4th line)</li>
<li>The <em>color</em> variable is now a <a href="https://svelte.dev/tutorial/tweened">tweened function</a>.<ul>
<li>The first parameter is the initial color, given by a prop calculated the same way as in the previous example, in the parent component</li>
<li>The interpolation function for a color is not given by Svelte, but a D3 function can be perfectly used. It&#39;s actually what the <a href="https://svelte.dev/tutorial/tweened">Svelte docs recommend to do</a></li>
<li>The events <em>onmouseover</em> and <em>onmouseout</em> are ones that change this value. Instead of being changed directly, they are changed many times, interpolating the values. These values are read as in a store, so a $ sign has to be used to access the <em>color</em> variable value.</li>
<li>The <em>rgb.brighter</em> function is used to calculate a new color for each region</li>
</ul>
</li>
</ul>
<p>Let&#39;s see now the <em>App.svelte</em> file. This will handle the projection transition and the <em>Feature</em> rendering:</p>
<p>
<script>
  import { geoAlbers, geoPath, geoProjection } from "d3-geo";
  import { geoAlbersUk } from "d3-composite-projections";
  import { scaleLinear } from "d3-scale";
  import { extent } from "d3-array";
  import { onMount } from "svelte";
  import { feature } from "topojson";
  import { tweened } from "svelte/motion";
  import { interpolate } from "d3-interpolate";
  import Feature from "./Feature.svelte";

  let data = [];
  let colorScale = () => {};
  const width = "960";
  const height = "500";
  const projectionAlbers = geoAlbers()
    .rotate([4.4, 0.8])
    .center([0, 55.4])
    .parallels([50, 60])
    .scale(3800)
    .translate([width / 2, (1.8 * height) / 2]);

  const projectionAlbersUk = geoAlbersUk()
    .translate([width / 2, (1.85 * height) / 2])
    .scale(5200);

  const projectionTween = (projection0, projection1) => {
    return function(t) {
      function project(λ, φ) {
        (λ *= 180 / Math.PI), (φ *= 180 / Math.PI);
        var p0 = projection0([λ, φ]),
          p1 = projection1([λ, φ]);
        if (!p0 || !p1) return [0, 0];
        return [(1 - t) * p0[0] + t * p1[0], (1 - t) * -p0[1] + t * -p1[1]];
      }

      return geoProjection(project)
        .scale(1)
        .translate([0, 0]);
    };
  };

  const currentProj = tweened(projectionAlbers, {
    duration: 1000,
    interpolate: projectionTween
  });

  $: path = geoPath().projection($currentProj);

  const opacity = tweened(0, {
    duration: 1000
  });

  onMount(async function() {
    const response = await fetch(
      "https://gist.githubusercontent.com/rveciana/27272a581e975835aaa321ddf816d726/raw/c40062a328843322208b8e98c2104dc8f6ad5301/uk-counties.json"
    );
    const json = await response.json();
    const topoData = feature(json, json.objects.UK);
    const land = {
      ...topoData,
      features: topoData.features.filter(
        d => d.properties.NAME_1 === "Scotland"
      )
    };

    const namesExtent = extent(land.features, d => d.properties.NAME_2.length);
    colorScale = scaleLinear()
      .domain(namesExtent)
      .range(["#feedde", "#fd8d3c"]);
    data = land.features;
  });
</script>

<style>
  svg {
    width: 960px;
    height: 500px;
    background-color: "#eeeeee";
  }
  .borders {
    fill: #ddd;
  }
</style>


<button
on:click={() => {
currentProj.set($currentProj === projectionAlbers ? projectionAlbersUk : projectionAlbers);
    opacity.set($currentProj === projectionAlbers ? 1 : 0);
}}>
Change
</button>
<svg width="960" height="500">
<path
    class="borders"
    d={projectionAlbersUk.getCompositionBorders()}
    style="opacity: {$opacity}" />
{#each data as feature}
<Feature
      featurePath={path(feature)}
      initialColor={colorScale(feature.properties.NAME_2.length)} />
{/each}
</svg>


</p>
<ul>
<li><a href="https://github.com/rveciana/d3-composite-projections">projectionAlbersUk</a> is a composite projection that makes the Shetland islands closer to the mainland. <a href="http://www.legislation.gov.uk/asp/2018/12/contents">Be careful, this can&#39;t be illegal! ;)</a></li>
<li><em>projectionTween</em> makes the magic. It takes two projections and creates the interpolated projection. The return value is a function of t. t can be a value from 0 to 1. This way, the interpolation can run from 0 to 1, and the path will be recalculated with these intermediate projections. See how is used in the <em>currentProj</em> variable. It&#39;s a cool demonstration that <em>tweened</em> can interpolate anything if you give the proper function to do it</li>
<li><em>opacity</em> is another tweened store used to add and remove the rectangle indicator. There is a fade option in Svelte that makes it even easier</li>
<li>Note that now, instead of adding an SVG path, many <em>Feature</em> components are added so they can handle their behaviour independently. Doing it altogether in the main component is terribly complicated and ugly</li>
</ul>
<h2 id="adding-circles">Adding circles</h2>
<p>The last example is just to show that the usual extra data can be added without any problem.</p>
<img width="50%" src="/images/d3/mapping-svelte/example4.png"/>

<p>I won&#39;t put all the code, since it&#39;s very similar to the previous one. <a href="https://bl.ocks.org/rveciana/653784cfab5d859610926733cfb14773">Check the example here</a></p>
<ul>
<li>cities.js has an array with the locations and the populations. The sizes of the circles are calculated using the d3 <em>scaleSqrt</em> scale, so the area is proportional to the population, not the radius.</li>
<li>An each block is used to draw each circle as in the second example. Since they have no individual behaviour, no extra components are needed</li>
</ul>
<p>cities.js:</p>
<p>
export const cities = [
{ name: "Perth", lat: 56.396999, lon: -3.437, population: 47180 },
{ name: "Glasgow", lat: 55.860916, lon: -4.251433, population: 598830 },
{ name: "Dundee", lat: 56.462002, lon: -2.9707, population: 148270 },
{ name: "Dundee", lat: 56.462002, lon: -2.9707, population: 148270 },
{ name: "Elgin", lat: 57.653484, lon: -3.335724, population: 23128 },
{ name: "Edinburgh", lat: 55.953251, lon: -3.188267, population: 482005 },
{ name: "Edinburgh", lat: 55.953251, lon: -3.188267, population: 482005 },
{ name: "Inverness", lat: 57.477772, lon: -4.224721, population: 46870 },
{ name: "Lerwick", lat: 60.154167, lon: -1.148611, population: 6958 }
];
</p>
<h2 id="final-thoughts">Final thoughts</h2>
<p>Although I have experience with React, I am really new to Svelte. Besides loving how is done, what impressed me the most is how easy is to make all the <em>traditional</em> D3js visualizations, but with the power of having an organized framework with components, stores, that is really fast and produces small bundles, etc.</p>
<p>I&#39;m sure I&#39;ve made many errors and that the code can be better, but I would spend a lot of hours replicating data visualizations into Svelte if I had time. Give it a try!</p>
<h2 id="links">Links</h2>
<ul>
<li><a href="https://bl.ocks.org/rveciana/4071d3c6a0b58f98893fb311306b038c">Example 1: Basic map</a></li>
<li><a href="https://bl.ocks.org/rveciana/9026255839233498dbe979ea69ad3af2">Example 2: Multiple geometries and color scale</a></li>
<li><a href="https://bl.ocks.org/rveciana/a8f24ce0ea98e403e266dfb4f9b6b2e9">Example 3: Adding transitions</a></li>
<li><a href="https://bl.ocks.org/rveciana/653784cfab5d859610926733cfb14773">Example 4: Adding circles</a></li>
<li><a href="https://svelte.dev/">Svelte web site</a></li>
<li><a href="https://svelte.dev/blog/virtual-dom-is-pure-overhead">Virtual DOM is pure overhead</a></li>
<li><a href="https://svelte.dev/tutorial/tweened">Svelte&#39;s Tweened function</a></li>
<li><a href="https://github.com/topojson/topojson-client/blob/master/README.md#feature">Topojson feature function</a></li>
<li><a href="https://observablehq.com/@rveciana/use-composite-projections-scotland">Scotland map Observable example</a></li>
<li><a href="https://github.com/d3/d3-geo#geoAlbers">The geoAlbers projection</a></li>
<li><a href="https://github.com/rveciana/d3-composite-projections">d3-composite-projections</a></li>
<li><a href="http://www.legislation.gov.uk/asp/2018/12/contents">Islands (Scotland) Act 2018</a></li>
</ul>
</article></div></div></main>
<footer class="site-footer"><div class="wrapper"><div class="footer-col-wrapper"><div class="footer-col  footer-col-1"><ul class="contact-list"><li>GeoExamples - Roger Veciana</li></ul></div>

	<div class="footer-col  footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/rveciana"><span class="icon  icon--github"><svg viewBox="0 0 16 16"><path fill="#89b889" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"></path></svg></span>

						<span class="username">rveciana</span></a></li>

			<li><a href="https://twitter.com/rveciana"><span class="icon  icon--twitter"><svg viewBox="0 0 16 16"><path fill="#89b889" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                    c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"></path></svg></span>

						<span class="username">rveciana</span></a></li>
			<li><a href="https://www.linkedin.com/in/rogerveciana"><span class="icon  icon--twitter"><svg width="16" height="15.28958"><path d="M 0,1.77606 Q 0,1.00386 0.54054,0.50193 1.08108,0 1.94595,0 2.79537,0 3.32047,0.49421 3.86101,1.00386 3.86101,1.8224 q 0,0.74131 -0.5251,1.23552 -0.54054,0.50965 -1.42085,0.50965 l -0.0154,0 q -0.84942,0 -1.37452,-0.50965 Q 4e-5,2.54827 4e-5,1.77606 Z m 0.20078,13.51352 0,-10.3166 3.42857,0 0,10.3166 -3.42857,0 z m 5.32818,0 3.42857,0 0,-5.76062 q 0,-0.54054 0.12355,-0.83398 0.21622,-0.52509 0.65638,-0.88803 0.44015,-0.36293 1.10424,-0.36293 1.72973,0 1.72973,2.33205 l 0,5.51351 3.42857,0 0,-5.91506 Q 16,7.08881 14.91892,5.90734 13.83784,4.72587 12.06178,4.72587 q -1.99228,0 -3.10425,1.71429 l 0,0.0309 -0.0154,0 0.0154,-0.0309 0,-1.46718 -3.42857,0 q 0.0309,0.49421 0.0309,3.07336 0,2.57915 -0.0309,7.24324 z"></path></svg></span>

						<span class="username">rogerveciana</span></a></li></ul></div>

	<div class="footer-col  footer-col-3"><p class="text">I am a software developer and meteorologist who likes mapping. I put here the things I learn on my free time.</p>
		<p class="text">Roger Veciana i Rovira</p></div></div></div></footer>



	<script type="svelte-data" url="/summary_pages.json">{"status":200,"statusText":"","headers":{"content-type":"application/json"},"body":"[{\"title\":\"About\",\"permalink\":\"\u002Fabout\",\"excerpt\":\"\u003Cp\u003E{{ site.author.name }}\u003C\u002Fp\u003E\"},{\"title\":\"CV\",\"permalink\":\"\u002Fcv\",\"excerpt\":\"\u003Ch2 id=\\\"jobs\\\"\u003EJobs\u003C\u002Fh2\u003E\",\"avoidMainMenu\":true},{\"title\":\"Projects\",\"permalink\":\"\u002Fprojects\",\"excerpt\":\"\u003Cp\u003ESome of my personal projects:\u003C\u002Fp\u003E\"}]"}</script>

	<script type="svelte-data" url="mapping-svelte.html.json">{"status":200,"statusText":"","headers":{"content-type":"application/json"},"body":"{\"title\":\"Mapping with Svelte and D3js\",\"contents\":\"\u003Cp\u003E\u003Ca href=\\\"https:\u002F\u002Fsvelte.dev\u002F\\\"\u003ESvelte\u003C\u002Fa\u003E is a very nice framework for building user interfaces. I wanted to learn more about it, and loved that the \u003Cem\u003Ed3-like\u003C\u002Fem\u003E transitions are included and well documented, and much easier than in React, that is my daily library.\u003C\u002Fp\u003E\\n\u003Cp\u003ESo I thought that some cool mapping examples could be done easily and I was right, so here we go!\u003C\u002Fp\u003E\\n\u003Cp\u003EDon&#39;t want to read all this? Check the examples:\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fbl.ocks.org\u002Frveciana\u002F4071d3c6a0b58f98893fb311306b038c\\\"\u003EExample 1: Basic map\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fbl.ocks.org\u002Frveciana\u002F9026255839233498dbe979ea69ad3af2\\\"\u003EExample 2: Multiple geometries and color scale\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fbl.ocks.org\u002Frveciana\u002Fa8f24ce0ea98e403e266dfb4f9b6b2e9\\\"\u003EExample 3: Adding transitions\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fbl.ocks.org\u002Frveciana\u002F653784cfab5d859610926733cfb14773\\\"\u003EExample 4: Adding circles\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Ch2 id=\\\"dom-projections-and-scales\\\"\u003EDOM, projections and scales\u003C\u002Fh2\u003E\\n\u003Cp\u003ESvelte controls the DOM (\u003Ca href=\\\"https:\u002F\u002Fsvelte.dev\u002Fblog\u002Fvirtual-dom-is-pure-overhead\\\"\u003Enot with a virtual DOM as React or Vue\u003C\u002Fa\u003E), and has no projection functions for mapping. I wanted to keep all the control into Svelte, so no D3js has been used for this, unlike many of the React with D3 examples out there. Svelte&#39;s \u003Ca href=\\\"https:\u002F\u002Fsvelte.dev\u002Ftutorial\u002Ftweened\\\"\u003ETweened\u003C\u002Fa\u003E can do this perfectly.\u003C\u002Fp\u003E\\n\u003Cp\u003EOn the other hand, D3 has been splitted long ago into several parts, in a really nice decision. This allows us to take only the parts we want and use them anywhere. The examples will use the projections and scales provided by D3 to calculate the paths.\u003C\u002Fp\u003E\\n\u003Ch2 id=\\\"installing-the-examples\\\"\u003EInstalling the examples\u003C\u002Fh2\u003E\\n\u003Cp\u003EThe easiest way to start any Svelte project is running:\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode\u003Enpx degit sveltejs\u002Ftemplate svelte-app\\ncd svelte-app\\nnpm run dev\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EThis will download the tempate project and run it at the port 5000. All the changes to be done are in the \u003Cem\u003EApp.svelte\u003C\u002Fem\u003E file.\u003C\u002Fp\u003E\\n\u003Cp\u003ESo, for all these examples, create a project and start manipulating the \u003Cem\u003EApp.svelte\u003C\u002Fem\u003E file with the provided code.\u003C\u002Fp\u003E\\n\u003Cp\u003ETo run all the examples, severall libraries have to be installed too:\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode\u003Enpm install topojson, d3-geo, d3-composite-projections, d3-scale, d3-color, d3-interpolate\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ch2 id=\\\"basic-map\\\"\u003EBasic map\u003C\u002Fh2\u003E\\n\u003Cp\u003E\u003Ca href=\\\"https:\u002F\u002Fbl.ocks.org\u002Frveciana\u002F4071d3c6a0b58f98893fb311306b038c\\\"\u003EThis first example\u003C\u002Fa\u003E creates the easiest map:\u003C\u002Fp\u003E\\n\u003Cimg width=\\\"50%\\\" src=\\\"\u002Fimages\u002Fd3\u002Fmapping-svelte\u002Fexample1.png\\\"\u002F\u003E\\n\\n\u003Cp\u003EThe \u003Cem\u003EApp.svelte\u003C\u002Fem\u003E file would be:\u003C\u002Fp\u003E\\n\u003Cp\u003E\\n\u003Cscript\u003E\\n  import { geoAlbers, geoPath } from \\\"d3-geo\\\";\\n  import { onMount } from \\\"svelte\\\";\\n  import { feature } from \\\"topojson\\\";\\n  let data;\\n  const projection = geoAlbers();\\n  const path = geoPath().projection(projection);\\n\\nonMount(async function() {\\nconst response = await fetch(\\n\\\"https:\u002F\u002Fgist.githubusercontent.com\u002Frveciana\u002Fa2a1c21ca1c71cd3ec116cc911e5fce9\u002Fraw\u002F79564dfa2c56745ebd62f5655a6cc19d2cffa1ea\u002Fus.json\\\"\\n);\\nconst json = await response.json();\\nconst land = feature(json, json.objects.land);\\ndata = path(land);\\n});\\n\u003C\u002Fscript\u003E\\n\\n\u003Cstyle\u003E\\n  svg {\\n    width: 960px;\\n    height: 500px;\\n  }\\n  .border {\\n    stroke: #444444;\\n    fill: #cccccc;\\n  }\\n\u003C\u002Fstyle\u003E\\n\\n\u003Csvg width=\\\"960\\\" height=\\\"500\\\"\u003E\\n  \u003Cpath d={data} class=\\\"border\\\" \u002F\u003E\\n\u003C\u002Fsvg\u003E\\n\\n\\n\u003Cul\u003E\\n\u003Cli\u003EThe file is structured in three parts:\u003Cul\u003E\\n\u003Cli\u003Escript, where all the JavaScript goes\u003C\u002Fli\u003E\\n\u003Cli\u003Estyle, where the css for the map is set\u003C\u002Fli\u003E\\n\u003Cli\u003EThe template part, where the HTML elements are defined\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003C\u002Fli\u003E\\n\u003Cli\u003EThe \u003Cem\u003EonMount\u003C\u002Fem\u003E function is run only once, when the component is mounted. Is here where we will fetch the JSON data we need to draw the map.\u003Cul\u003E\\n\u003Cli\u003E\u003Cem\u003Efeature\u003C\u002Fem\u003E is the function from the \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Ftopojson\u002Ftopojson-client\u002Fblob\u002Fmaster\u002FREADME.md#feature\\\"\u003Etopojson library to decode the topojson file\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Cem\u003Edata\u003C\u002Fem\u003E will have the svg path definition fot the map. Why is declared outside the \u003Cem\u003EonMount\u003C\u002Fem\u003E function? Because it&#39;s used in the template, and since \u003Cem\u003EonMount\u003C\u002Fem\u003E is \u003Cem\u003Easync\u003C\u002Fem\u003E, the variable wouldn&#39;t be available when the component is created, giving an error. By doing it this way, the path will be null at the beginning, and the component will re-render when the data is loaded.\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003C\u002Fli\u003E\\n\u003Cli\u003ENote that path and projection are taken directly from D3js, but are only pure functions that return the SVG path string given a GeoJSON data. Nothing related to the DOM\u003C\u002Fli\u003E\\n\u003Cli\u003EThe path is defined to hold the \u003Cem\u003Edata\u003C\u002Fem\u003E value as the d attribute\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Ch2 id=\\\"adding-multiple-geometries-and-color-scale\\\"\u003EAdding multiple geometries and color scale\u003C\u002Fh2\u003E\\n\u003Cp\u003ELet&#39;s add now more geometries and a color scale to fill them. This example and the next ones are all based on \u003Ca href=\\\"https:\u002F\u002Fobservablehq.com\u002F@rveciana\u002Fuse-composite-projections-scotland\\\"\u003Ethis Observable\u003C\u002Fa\u003E. \u003Ca href=\\\"https:\u002F\u002Fbl.ocks.org\u002Frveciana\u002F9026255839233498dbe979ea69ad3af2\\\"\u003ECheck the result\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cimg width=\\\"50%\\\" src=\\\"\u002Fimages\u002Fd3\u002Fmapping-svelte\u002Fexample2.png\\\"\u002F\u003E\\n\\n\u003Cp\u003E\\n\u003Cscript\u003E\\n  import { geoAlbers, geoPath } from \\\"d3-geo\\\";\\n  import { scaleLinear } from \\\"d3-scale\\\";\\n  import { extent } from \\\"d3-array\\\";\\n  import { onMount } from \\\"svelte\\\";\\n  import { feature } from \\\"topojson\\\";\\n  let data = [];\\n  let colorScale = () =\u003E {};\\n  const width = \\\"960\\\";\\n  const height = \\\"500\\\";\\n  const projectionAlbers = geoAlbers()\\n    .rotate([4.4, 0.8])\\n    .center([0, 55.4])\\n    .parallels([50, 60])\\n    .scale(3800)\\n    .translate([width \u002F 2, (1.8 * height) \u002F 2]);\\n\\n  let currentProj = projectionAlbers;\\n  let path = geoPath().projection(currentProj);\\n\\n  onMount(async function() {\\n    const response = await fetch(\\n      \\\"https:\u002F\u002Fgist.githubusercontent.com\u002Frveciana\u002F27272a581e975835aaa321ddf816d726\u002Fraw\u002Fc40062a328843322208b8e98c2104dc8f6ad5301\u002Fuk-counties.json\\\"\\n    );\\n    const json = await response.json();\\n    const topoData = feature(json, json.objects.UK);\\n    const land = {\\n      ...topoData,\\n      features: topoData.features.filter(\\n        d =\u003E d.properties.NAME_1 === \\\"Scotland\\\"\\n      )\\n    };\\n\\n    const namesExtent = extent(land.features, d =\u003E d.properties.NAME_2.length);\\n    colorScale = scaleLinear()\\n      .domain(namesExtent)\\n      .range([\\\"#feedde\\\", \\\"#fd8d3c\\\"]);\\n    data = land.features;\\n  });\\n\u003C\u002Fscript\u003E\\n\\n\u003Cstyle\u003E\\n  svg {\\n    width: 960px;\\n    height: 500px;\\n    background-color: \\\"#eeeeee\\\";\\n  }\\n  .provinceShape {\\n    stroke: #444444;\\n    stroke-width: 0.5;\\n  }\\n\u003C\u002Fstyle\u003E\\n\\n\u003Csvg width=\\\"960\\\" height=\\\"500\\\"\u003E\\n  {#each data as feature}\\n    \u003Cpath\\n      d={path(feature)}\\n      class=\\\"provinceShape\\\"\\n      fill={colorScale(feature.properties.NAME_2.length)} \u002F\u003E\\n  {\u002Feach}\\n\u003C\u002Fsvg\u003E\\n\\n\\n\u003Cul\u003E\\n\u003Cli\u003EWe are using now another projection (\u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Fd3\u002Fd3-geo#geoAlbers\\\"\u003EgeoAlbers\u003C\u002Fa\u003E), so the next examples become more interesting\u003C\u002Fli\u003E\\n\u003Cli\u003EAll the strange stuff with the topojson data is to get only the Scotland counties from the file that contains all the UK counties\u003C\u002Fli\u003E\\n\u003Cli\u003ENote the use of \u003Cem\u003EscaleLinear\u003C\u002Fem\u003E to get a color scale. The extent is only the minimum and maximum length of the names of the counties. Just to have some data to plot!\u003C\u002Fli\u003E\\n\u003Cli\u003ENow, in the template part, an \u003Cem\u003Eeach\u003C\u002Fem\u003E block is used to plot a different path for each county. The color is calculated with the color scale\u003C\u002Fli\u003E\\n\u003Cli\u003ENote that, again, the color scale and data have to be declared outside the \u003Cem\u003EonMount\u003C\u002Fem\u003E block\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Ch2 id=\\\"changing-the-color-when-mouse-is-over\\\"\u003EChanging the color when mouse is over\u003C\u002Fh2\u003E\\n\u003Cp\u003EWell, this starts to be interesting. This is where Svelte makes things really easier. We want the same map we had on the previous example but when we hover on a county, we want this county color change a little so the user knows it. This means having behaviours for each path, so we will need nested components.\\nAlso, we want to change the projection to a composed one when clicking a button. \u003Ca href=\\\"https:\u002F\u002Fbl.ocks.org\u002Frveciana\u002Fa8f24ce0ea98e403e266dfb4f9b6b2e9\\\"\u003ECheck the result\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cimg width=\\\"50%\\\" src=\\\"\u002Fimages\u002Fd3\u002Fmapping-svelte\u002Fexample3.png\\\"\u002F\u003E\\n\\n\u003Cp\u003ELet&#39;s start with the nested component, called \u003Cem\u003EFeature.svelte\u003C\u002Fem\u003E. Copy this into your project too!\u003C\u002Fp\u003E\\n\u003Cp\u003E\\n\u003Cscript\u003E\\n  import { tweened } from \\\"svelte\u002Fmotion\\\";\\n  import { interpolateLab } from \\\"d3-interpolate\\\";\\n  import { rgb } from \\\"d3-color\\\";\\n  export let featurePath;\\n  export let initialColor;\\n\\n  const color = tweened(initialColor, {\\n    duration: 300,\\n    interpolate: interpolateLab\\n  });\\n\u003C\u002Fscript\u003E\\n\\n\u003Cstyle\u003E\\n  .provinceShape {\\n    stroke: #444444;\\n    stroke-width: 0.5;\\n  }\\n\u003C\u002Fstyle\u003E\\n\\n\\n\u003Cpath\\nd={featurePath}\\nclass=\\\"provinceShape\\\"\\nfill={$color}\\non:mouseover={() =\u003E {\\ncolor.set(rgb(initialColor).brighter(0.3));\\n}}\\non:mouseout={() =\u003E {\\ncolor.set(initialColor);\\n}} \u002F\u003E\\n\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003EThe idea, as you can see on the tempalte section, is rendering only the SVG path element. The path itself is given by a prop (note the export on the 4th line)\u003C\u002Fli\u003E\\n\u003Cli\u003EThe \u003Cem\u003Ecolor\u003C\u002Fem\u003E variable is now a \u003Ca href=\\\"https:\u002F\u002Fsvelte.dev\u002Ftutorial\u002Ftweened\\\"\u003Etweened function\u003C\u002Fa\u003E.\u003Cul\u003E\\n\u003Cli\u003EThe first parameter is the initial color, given by a prop calculated the same way as in the previous example, in the parent component\u003C\u002Fli\u003E\\n\u003Cli\u003EThe interpolation function for a color is not given by Svelte, but a D3 function can be perfectly used. It&#39;s actually what the \u003Ca href=\\\"https:\u002F\u002Fsvelte.dev\u002Ftutorial\u002Ftweened\\\"\u003ESvelte docs recommend to do\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003EThe events \u003Cem\u003Eonmouseover\u003C\u002Fem\u003E and \u003Cem\u003Eonmouseout\u003C\u002Fem\u003E are ones that change this value. Instead of being changed directly, they are changed many times, interpolating the values. These values are read as in a store, so a $ sign has to be used to access the \u003Cem\u003Ecolor\u003C\u002Fem\u003E variable value.\u003C\u002Fli\u003E\\n\u003Cli\u003EThe \u003Cem\u003Ergb.brighter\u003C\u002Fem\u003E function is used to calculate a new color for each region\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Cp\u003ELet&#39;s see now the \u003Cem\u003EApp.svelte\u003C\u002Fem\u003E file. This will handle the projection transition and the \u003Cem\u003EFeature\u003C\u002Fem\u003E rendering:\u003C\u002Fp\u003E\\n\u003Cp\u003E\\n\u003Cscript\u003E\\n  import { geoAlbers, geoPath, geoProjection } from \\\"d3-geo\\\";\\n  import { geoAlbersUk } from \\\"d3-composite-projections\\\";\\n  import { scaleLinear } from \\\"d3-scale\\\";\\n  import { extent } from \\\"d3-array\\\";\\n  import { onMount } from \\\"svelte\\\";\\n  import { feature } from \\\"topojson\\\";\\n  import { tweened } from \\\"svelte\u002Fmotion\\\";\\n  import { interpolate } from \\\"d3-interpolate\\\";\\n  import Feature from \\\".\u002FFeature.svelte\\\";\\n\\n  let data = [];\\n  let colorScale = () =\u003E {};\\n  const width = \\\"960\\\";\\n  const height = \\\"500\\\";\\n  const projectionAlbers = geoAlbers()\\n    .rotate([4.4, 0.8])\\n    .center([0, 55.4])\\n    .parallels([50, 60])\\n    .scale(3800)\\n    .translate([width \u002F 2, (1.8 * height) \u002F 2]);\\n\\n  const projectionAlbersUk = geoAlbersUk()\\n    .translate([width \u002F 2, (1.85 * height) \u002F 2])\\n    .scale(5200);\\n\\n  const projectionTween = (projection0, projection1) =\u003E {\\n    return function(t) {\\n      function project(λ, φ) {\\n        (λ *= 180 \u002F Math.PI), (φ *= 180 \u002F Math.PI);\\n        var p0 = projection0([λ, φ]),\\n          p1 = projection1([λ, φ]);\\n        if (!p0 || !p1) return [0, 0];\\n        return [(1 - t) * p0[0] + t * p1[0], (1 - t) * -p0[1] + t * -p1[1]];\\n      }\\n\\n      return geoProjection(project)\\n        .scale(1)\\n        .translate([0, 0]);\\n    };\\n  };\\n\\n  const currentProj = tweened(projectionAlbers, {\\n    duration: 1000,\\n    interpolate: projectionTween\\n  });\\n\\n  $: path = geoPath().projection($currentProj);\\n\\n  const opacity = tweened(0, {\\n    duration: 1000\\n  });\\n\\n  onMount(async function() {\\n    const response = await fetch(\\n      \\\"https:\u002F\u002Fgist.githubusercontent.com\u002Frveciana\u002F27272a581e975835aaa321ddf816d726\u002Fraw\u002Fc40062a328843322208b8e98c2104dc8f6ad5301\u002Fuk-counties.json\\\"\\n    );\\n    const json = await response.json();\\n    const topoData = feature(json, json.objects.UK);\\n    const land = {\\n      ...topoData,\\n      features: topoData.features.filter(\\n        d =\u003E d.properties.NAME_1 === \\\"Scotland\\\"\\n      )\\n    };\\n\\n    const namesExtent = extent(land.features, d =\u003E d.properties.NAME_2.length);\\n    colorScale = scaleLinear()\\n      .domain(namesExtent)\\n      .range([\\\"#feedde\\\", \\\"#fd8d3c\\\"]);\\n    data = land.features;\\n  });\\n\u003C\u002Fscript\u003E\\n\\n\u003Cstyle\u003E\\n  svg {\\n    width: 960px;\\n    height: 500px;\\n    background-color: \\\"#eeeeee\\\";\\n  }\\n  .borders {\\n    fill: #ddd;\\n  }\\n\u003C\u002Fstyle\u003E\\n\\n\\n\u003Cbutton\\non:click={() =\u003E {\\ncurrentProj.set($currentProj === projectionAlbers ? projectionAlbersUk : projectionAlbers);\\n    opacity.set($currentProj === projectionAlbers ? 1 : 0);\\n}}\u003E\\nChange\\n\u003C\u002Fbutton\u003E\\n\u003Csvg width=\\\"960\\\" height=\\\"500\\\"\u003E\\n\u003Cpath\\n    class=\\\"borders\\\"\\n    d={projectionAlbersUk.getCompositionBorders()}\\n    style=\\\"opacity: {$opacity}\\\" \u002F\u003E\\n{#each data as feature}\\n\u003CFeature\\n      featurePath={path(feature)}\\n      initialColor={colorScale(feature.properties.NAME_2.length)} \u002F\u003E\\n{\u002Feach}\\n\u003C\u002Fsvg\u003E\\n\\n\\n\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Frveciana\u002Fd3-composite-projections\\\"\u003EprojectionAlbersUk\u003C\u002Fa\u003E is a composite projection that makes the Shetland islands closer to the mainland. \u003Ca href=\\\"http:\u002F\u002Fwww.legislation.gov.uk\u002Fasp\u002F2018\u002F12\u002Fcontents\\\"\u003EBe careful, this can&#39;t be illegal! ;)\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Cem\u003EprojectionTween\u003C\u002Fem\u003E makes the magic. It takes two projections and creates the interpolated projection. The return value is a function of t. t can be a value from 0 to 1. This way, the interpolation can run from 0 to 1, and the path will be recalculated with these intermediate projections. See how is used in the \u003Cem\u003EcurrentProj\u003C\u002Fem\u003E variable. It&#39;s a cool demonstration that \u003Cem\u003Etweened\u003C\u002Fem\u003E can interpolate anything if you give the proper function to do it\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Cem\u003Eopacity\u003C\u002Fem\u003E is another tweened store used to add and remove the rectangle indicator. There is a fade option in Svelte that makes it even easier\u003C\u002Fli\u003E\\n\u003Cli\u003ENote that now, instead of adding an SVG path, many \u003Cem\u003EFeature\u003C\u002Fem\u003E components are added so they can handle their behaviour independently. Doing it altogether in the main component is terribly complicated and ugly\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Ch2 id=\\\"adding-circles\\\"\u003EAdding circles\u003C\u002Fh2\u003E\\n\u003Cp\u003EThe last example is just to show that the usual extra data can be added without any problem.\u003C\u002Fp\u003E\\n\u003Cimg width=\\\"50%\\\" src=\\\"\u002Fimages\u002Fd3\u002Fmapping-svelte\u002Fexample4.png\\\"\u002F\u003E\\n\\n\u003Cp\u003EI won&#39;t put all the code, since it&#39;s very similar to the previous one. \u003Ca href=\\\"https:\u002F\u002Fbl.ocks.org\u002Frveciana\u002F653784cfab5d859610926733cfb14773\\\"\u003ECheck the example here\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003Ecities.js has an array with the locations and the populations. The sizes of the circles are calculated using the d3 \u003Cem\u003EscaleSqrt\u003C\u002Fem\u003E scale, so the area is proportional to the population, not the radius.\u003C\u002Fli\u003E\\n\u003Cli\u003EAn each block is used to draw each circle as in the second example. Since they have no individual behaviour, no extra components are needed\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Cp\u003Ecities.js:\u003C\u002Fp\u003E\\n\u003Cp\u003E\\nexport const cities = [\\n{ name: \\\"Perth\\\", lat: 56.396999, lon: -3.437, population: 47180 },\\n{ name: \\\"Glasgow\\\", lat: 55.860916, lon: -4.251433, population: 598830 },\\n{ name: \\\"Dundee\\\", lat: 56.462002, lon: -2.9707, population: 148270 },\\n{ name: \\\"Dundee\\\", lat: 56.462002, lon: -2.9707, population: 148270 },\\n{ name: \\\"Elgin\\\", lat: 57.653484, lon: -3.335724, population: 23128 },\\n{ name: \\\"Edinburgh\\\", lat: 55.953251, lon: -3.188267, population: 482005 },\\n{ name: \\\"Edinburgh\\\", lat: 55.953251, lon: -3.188267, population: 482005 },\\n{ name: \\\"Inverness\\\", lat: 57.477772, lon: -4.224721, population: 46870 },\\n{ name: \\\"Lerwick\\\", lat: 60.154167, lon: -1.148611, population: 6958 }\\n];\\n\u003C\u002Fp\u003E\\n\u003Ch2 id=\\\"final-thoughts\\\"\u003EFinal thoughts\u003C\u002Fh2\u003E\\n\u003Cp\u003EAlthough I have experience with React, I am really new to Svelte. Besides loving how is done, what impressed me the most is how easy is to make all the \u003Cem\u003Etraditional\u003C\u002Fem\u003E D3js visualizations, but with the power of having an organized framework with components, stores, that is really fast and produces small bundles, etc.\u003C\u002Fp\u003E\\n\u003Cp\u003EI&#39;m sure I&#39;ve made many errors and that the code can be better, but I would spend a lot of hours replicating data visualizations into Svelte if I had time. Give it a try!\u003C\u002Fp\u003E\\n\u003Ch2 id=\\\"links\\\"\u003ELinks\u003C\u002Fh2\u003E\\n\u003Cul\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fbl.ocks.org\u002Frveciana\u002F4071d3c6a0b58f98893fb311306b038c\\\"\u003EExample 1: Basic map\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fbl.ocks.org\u002Frveciana\u002F9026255839233498dbe979ea69ad3af2\\\"\u003EExample 2: Multiple geometries and color scale\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fbl.ocks.org\u002Frveciana\u002Fa8f24ce0ea98e403e266dfb4f9b6b2e9\\\"\u003EExample 3: Adding transitions\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fbl.ocks.org\u002Frveciana\u002F653784cfab5d859610926733cfb14773\\\"\u003EExample 4: Adding circles\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fsvelte.dev\u002F\\\"\u003ESvelte web site\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fsvelte.dev\u002Fblog\u002Fvirtual-dom-is-pure-overhead\\\"\u003EVirtual DOM is pure overhead\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fsvelte.dev\u002Ftutorial\u002Ftweened\\\"\u003ESvelte&#39;s Tweened function\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Ftopojson\u002Ftopojson-client\u002Fblob\u002Fmaster\u002FREADME.md#feature\\\"\u003ETopojson feature function\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fobservablehq.com\u002F@rveciana\u002Fuse-composite-projections-scotland\\\"\u003EScotland map Observable example\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Fd3\u002Fd3-geo#geoAlbers\\\"\u003EThe geoAlbers projection\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Frveciana\u002Fd3-composite-projections\\\"\u003Ed3-composite-projections\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"http:\u002F\u002Fwww.legislation.gov.uk\u002Fasp\u002F2018\u002F12\u002Fcontents\\\"\u003EIslands (Scotland) Act 2018\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\",\"tags\":[\"svelte\",\"projections\",\"svg\"],\"date\":\"2019-12-08T00:00:00.000Z\"}"}</script>
</div>
	</body>
</html>
