<!DOCTYPE html>
<html lang="en">
	<head>
		<!-- Global site tag (gtag.js) - Google Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=G-BD6G9PF6NH"></script>
		<script>
			window.dataLayer = window.dataLayer || [];
			function gtag() {
				dataLayer.push(arguments);
			}
			gtag('js', new Date());

			gtag('config', 'G-BD6G9PF6NH');
		</script>

		<meta charset="utf-8" />
		<link rel="icon" href="/favicon.ico" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="manifest" href="/manifest.json" />
		<meta name="theme-color" content="#cdffcd" />
		<!-- HTML Meta Tags -->
		<meta
			name="description"
			content="I am a software developer and meteorologist who likes mapping. I put here the things I learn on my free time."
		/>
		<!-- Google / Search Engine Tags -->
		<meta itemprop="name" content=">GeoExamples - Roger Veciana" />
		<meta
			itemprop="description"
			content="I am a software developer and meteorologist who likes mapping. I put here the things I learn on my free time."
		/>
		<meta itemprop="image" content="https://geoexamples.com/siteImage.png" />

		<title>GeoExamples - Complex GIS calculations with gpu.js: Temperature interpolation</title><meta name="twitter:card" content="summary" data-svelte="svelte-w2s84v"><meta name="twitter:title" content="GeoExamples - Complex GIS calculations with gpu.js: Temperature interpolation" data-svelte="svelte-w2s84v"><meta name="twitter:description" content="&lt;script type=&quot;text/j" data-svelte="svelte-w2s84v"><meta name="twitter:image" content="https://geoexamples.com/images/other/complex-gis-calculations-gpu/twitter.png" data-svelte="svelte-w2s84v"><meta property="og:url" content="https://geoexamples.com" data-svelte="svelte-w2s84v"><meta property="og:type" content="website" data-svelte="svelte-w2s84v"><meta property="og:title" content="GeoExamples - Complex GIS calculations with gpu.js: Temperature interpolation" data-svelte="svelte-w2s84v"><meta property="og:description" content="I am a software developer and meteorologist who likes mapping. I put here the things I learn on my free time." data-svelte="svelte-w2s84v"><meta property="og:image" content="https://geoexamples.com/images/other/complex-gis-calculations-gpu/twitter.png" data-svelte="svelte-w2s84v">

		

		<link rel="modulepreload" href="/_app/start-9934143f.js">
		<link rel="modulepreload" href="/_app/chunks/vendor-f4f84e30.js">
		<link rel="modulepreload" href="/_app/pages/__layout.svelte-b5745e7e.js">
		<link rel="modulepreload" href="/_app/chunks/config-b3bde751.js">
		<link rel="modulepreload" href="/_app/pages/[category]/[year]/[month]/[date]/[slug].svelte-dcec41b3.js">
		<link rel="stylesheet" href="/_app/assets/start-a8cd1609.css">
		<link rel="stylesheet" href="/_app/assets/pages/__layout.svelte-294fb61c.css">

		<script type="module">
			import { start } from "/_app/start-9934143f.js";
			start({
				target: document.querySelector("#svelte"),
				paths: {"base":"","assets":""},
				session: {},
				host: location.host,
				route: true,
				spa: false,
				trailing_slash: "never",
				hydrate: {
					status: 200,
					error: null,
					nodes: [
						import("/_app/pages/__layout.svelte-b5745e7e.js"),
						import("/_app/pages/[category]/[year]/[month]/[date]/[slug].svelte-dcec41b3.js")
					],
					page: {
						host: location.host, // TODO this is redundant
						path: "/other/2018/09/17/gpujs-example.html",
						query: new URLSearchParams(""),
						params: {"category":"other","year":"2018","month":"09","date":"17","slug":"gpujs-example.html"}
					}
				}
			});
		</script>
	</head>
	<body>
		<div id="svelte">


<header class="site-header"><div class="wrapper"><a class="site-title" href="/">GeoExamples - Roger Veciana</a>

<nav class="site-nav"><div href="#" class="menu-icon"><svg viewBox="0 0 18 15"><path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"></path><path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"></path><path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"></path></svg></div>

	<div class="trigger"><a class="page-link" href="/about">About</a><a class="page-link" href="/blog">Blog</a><a class="page-link" href="/projects">Projects</a></div></nav></div></header>

<main class="page-content"><div class="wrapper">
<div class="post"><header class="post-header"><h1 class="post-title">Complex GIS calculations with gpu.js: Temperature interpolation</h1>
<p class="post-meta">Sep 17, 2018</p></header>

	<article class="post-content"><!-- HTML_TAG_START --><script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<p>The <a href="/other/2018/04/30/mapping-with-gpujs.html">previous post I wrote</a> showed how to use the <a href="http://gpu.rocks">gpu.js library</a> for drawing maps with JavaScript after calculating the values with the user&#39;s GPU.</p>
<p>While writting it, I was preparing <a href="https://vimeo.com/album/5268941/video/278133346">this conference</a> (in Spanish) for the 2018 edition of the <a href="http://www.sigte.udg.edu/jornadassiglibre/">&quot;Jornadas SIG Libre&quot; at Girona</a>. The motivation of the talk was showing the possibilities of using the user&#39;s GPU instead of the server to make complex GIS calculations on the fly, so the speed could be much higher and the use of the server almost negligible.</p>
<h2 id="the-example">The example</h2>
<p>Some years ago, I made a python script that calculates the temperature and relative humidity on a raster, taking as the initial data the weather stations available at the <a href="http://meteo.cat">Catalan Meteorological Service</a>. The resulting product is still in use, specially to detect if the current precipitation is in form of rain or snow. There are <a href="https://www.researchgate.net/publication/283479429_Verification_of_a_weather_radar_derived_surface_precipitation_type_product">some papers about this</a> too.</p>
<p>The idea is, then, calculating a temperature field with a good resolution taking as input the weather station data. The example has several steps with intensive calculations, so it&#39;s a good study case for <a href="http://gpu.rocks">gpu.js</a>.</p>
<p>The temperature depends on many things, but fits quite well this formula:</p>
<p>$$ temperature = \beta<em>{0} + \beta</em>{1} _ altitude + \beta_{2} _ distanceToCoast $$</p>
<p>So, given the station temperatures in a given moment and knowing the altitude and distance to the coast for each station, a <a href="http://www.stat.yale.edu/Courses/1997-98/101/linmult.htm">multiple-linear regrssion</a> can be done to get a formula.</p>
<p>To calculate the multipl-linear regression, the <a href="http://reliawiki.org/index.php/Multiple_Linear_Regression_Analysis">matricial formula is this one</a>:</p>
<p>$$
\hat{\beta}=(X^{T}X)^{-1}X^{T}y\
\hat{y}=X\hat{\beta}
$$</p>
<p>So there are matrix transpositions, matrix multiplications and other operations that are basic gpu.js examples. Anyway, this step uses only few values (we will be using about 180 weather stations), so I will use <a href="http://www.numericjs.com/">numeric.js</a> that is still fast enough and simplifies the code.</p>
<p>Once the <em>beta values</em> are calculated, a temperature field can be created if the altitude and distance values for each pixel are known. This is quite fast to do in gpu.js.</p>
<p>The result will look like this:</p>
<img src="/images/other/complex-gis-calculations-gpu/first_temp.png"/>

<p>The problem with stopping here is that we are assuming that the formula is valid for all the territory, but we know that some regions have their own particularities (some regions may be a bit hotter or colder than what the formula expect). Let&#39;s try to correct that with the <em>residues method</em>:</p>
<p>For each station, the real value is:</p>
<p>$$temperature = fit + residual$$</p>
<p>Using the matricial notation ,the errors or residuals are:</p>
<p>$$e=y-\hat{y}$$</p>
<p>Once we have the error in each point, we can interpolate them to create a <em>residuals field</em> that can be added to the original temperature calculation. To do it, we will use the inverse of the distance, which will give a result similar to:</p>
<img src="/images/other/complex-gis-calculations-gpu/inverse.png"/>

<p>Finally, when adding the layer, some differences emerge:</p>
<img src="/images/other/complex-gis-calculations-gpu/final_result.png"/>

<p>So, to create the final map, the following things must be calculated. We will use a 1000x1000 pixels so the calculation is long using the CPU:</p>
<ul>
<li>Calculation of the multiple linear regression</li>
<li>Creation of the temperature raster from the regression formula (GPU 1000x1000 px)</li>
<li>Residuals calculation</li>
<li>Residuals interpolation (GPU 1000x1000 px)</li>
<li>Final temperature field adding the temperature and residuals (GPU 1000x1000 px)</li>
<li>Layer representation (GPU 1000x1000 px)</li>
</ul>
<h2 id="the-code">The code</h2>
<p>To make the example interactive and easier to split and understand, I made <a href="https://beta.observablehq.com/@rveciana/temperature-interpolation-using-gpu-js">this observable notebook</a>.</p>
<h3 id="multiple-linear-regression"><a href="https://beta.observablehq.com/@rveciana/temperature-interpolation-using-gpu-js#regression">Multiple linear regression</a></h3>
<p>I&#39;m using <a href="http://www.numericjs.com/">numeric.js</a> here to avoid many complex gpu.js coding, since with only two hundred weather station, the ellapsed time is a very small part of the total (2 ms).
<pre><code>
<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> conv <span class="token operator">=</span> <span class="token function">convertData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">X</span> <span class="token operator">=</span> conv<span class="token punctuation">.</span><span class="token constant">X</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">Y</span> <span class="token operator">=</span> conv<span class="token punctuation">.</span><span class="token constant">Y</span>
<span class="token keyword">const</span> <span class="token constant">X_T</span> <span class="token operator">=</span> numeric<span class="token punctuation">.</span><span class="token function">transpose</span><span class="token punctuation">(</span><span class="token constant">X</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> multipliedXMatrix <span class="token operator">=</span> numeric<span class="token punctuation">.</span><span class="token function">dot</span><span class="token punctuation">(</span><span class="token constant">X_T</span><span class="token punctuation">,</span><span class="token constant">X</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> LeftSide <span class="token operator">=</span> numeric<span class="token punctuation">.</span><span class="token function">inv</span><span class="token punctuation">(</span>multipliedXMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> RightSide <span class="token operator">=</span> numeric<span class="token punctuation">.</span><span class="token function">dot</span><span class="token punctuation">(</span><span class="token constant">X_T</span><span class="token punctuation">,</span><span class="token constant">Y</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
result<span class="token punctuation">.</span>beta <span class="token operator">=</span> numeric<span class="token punctuation">.</span><span class="token function">dot</span><span class="token punctuation">(</span>LeftSide<span class="token punctuation">,</span>RightSide<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> yhat <span class="token operator">=</span> numeric<span class="token punctuation">.</span><span class="token function">dot</span><span class="token punctuation">(</span><span class="token constant">X</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>beta<span class="token punctuation">)</span><span class="token punctuation">;</span>
result<span class="token punctuation">.</span>residual <span class="token operator">=</span> numeric<span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span><span class="token constant">Y</span><span class="token punctuation">,</span> yhat<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></p>
<p>Notice that the code is very easy to understand given the original formula:</p>
<p>$$
\hat{\beta}=(X^{T}X)^{-1}X^{T}y\
\hat{y}=X\hat{\beta}
$$</p>
<h3 id="calculating-the-regression-field"><a href="https://beta.observablehq.com/@rveciana/temperature-interpolation-using-gpu-js#interpolation_result">Calculating the regression field</a></h3>
<p>In this case, <a href="http://gpu.rocks">gpu.js</a> will be used, since I&#39;ve set a 1000x970 output field, which involves repeating the same operation about one million times, and this is where the gpu makes things much faster:</p>
<p><pre><code>
<span class="token keyword">let</span> gpu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GPU</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> calculateInterp <span class="token operator">=</span> gpu<span class="token punctuation">.</span><span class="token function">createKernel</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">altitude<span class="token punctuation">,</span> dist<span class="token punctuation">,</span> regrCoefs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">return</span> regrCoefs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> regrCoefs<span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"/other/2018/04/30/mapping-with-gpujs.html"</span><span class="token operator">></span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span> _ altitude<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>thread<span class="token punctuation">.</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>thread<span class="token punctuation">.</span>x<span class="token punctuation">]</span> <span class="token operator">+</span> regrCoefs<span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"http://gpu.rocks"</span><span class="token operator">></span><span class="token number">2</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span> _ dist<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>thread<span class="token punctuation">.</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>thread<span class="token punctuation">.</span>x<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">setOutput</span><span class="token punctuation">(</span><span class="token punctuation">[</span>fixData<span class="token punctuation">.</span>xSize<span class="token punctuation">,</span> fixData<span class="token punctuation">.</span>ySize<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> interpResult <span class="token operator">=</span> <span class="token function">calculateInterp</span><span class="token punctuation">(</span>
<span class="token constant">GPU</span><span class="token punctuation">.</span><span class="token function">input</span><span class="token punctuation">(</span>Float32Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>fixData<span class="token punctuation">.</span>data<span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"/other/2018/04/30/mapping-with-gpujs.html"</span><span class="token operator">></span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">968</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token constant">GPU</span><span class="token punctuation">.</span><span class="token function">input</span><span class="token punctuation">(</span>Float32Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>fixData<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">968</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
regression_result<span class="token punctuation">.</span>beta<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></p>
<p>As always when using gpu.js, the kernel mush be generated first. In this case, the parameters are altitude and distance to the sea, which are just matrices read from a goetiff, since are fixed values, and the regression result. Check the <a href="https://beta.observablehq.com/@rveciana/temperature-interpolation-using-gpu-js#fix_data">fix data cell</a> to see how to read the data as a Float32 array and calculate the geotransform using the <a href="https://geotiffjs.github.io/">GeoTIFF.js library</a>.</p>
<p>The formula itself to apply in the GPU is the independent term plus the variables multiplied by the coefficient:</p>
<p>$$ temperature = \beta<em>{0} + \beta</em>{1} _ altitude + \beta_{2} _ distanceToCoast $$</p>
<p>Also, I used the GPU.input method to pass the big matrices, since it&#39;s much faster. Check the <a href="https://github.com/gpujs/gpu.js#flattened-typed-array-support">Flattened array type support section</a> of the docs to see how it works.</p>
<h3 id="calculating-the-residuals-field"><a href="https://beta.observablehq.com/@rveciana/temperature-interpolation-using-gpu-js#residuals_result">Calculating the residuals field</a></h3>
<p>To calculate the residuald field, we take the error in each weather station and apply the inverse of the distance in each pixel of the field. It&#39;s the most intensive calculation of all the process.</p>
<p><pre><code>
<span class="token keyword">let</span> xPos <span class="token operator">=</span> station_data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">(</span>d<span class="token punctuation">.</span>lon <span class="token operator">-</span> fixData<span class="token punctuation">.</span>geoTransform<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">/</span>fixData<span class="token punctuation">.</span>geoTransform<span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"/other/2018/04/30/mapping-with-gpujs.html"</span><span class="token operator">></span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> yPos <span class="token operator">=</span> station_data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">(</span>d<span class="token punctuation">.</span>lat <span class="token operator">-</span> fixData<span class="token punctuation">.</span>geoTransform<span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"https://vimeo.com/album/5268941/video/278133346"</span><span class="token operator">></span><span class="token number">3</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">/</span>fixData<span class="token punctuation">.</span>geoTransform<span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"http://meteo.cat"</span><span class="token operator">></span><span class="token number">5</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> gpu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GPU</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> calculateResidues <span class="token operator">=</span> gpu<span class="token punctuation">.</span><span class="token function">createKernel</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">xpos<span class="token punctuation">,</span> ypos<span class="token punctuation">,</span> values</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">let</span> nominator<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> denominator<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> flagDist <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>constants<span class="token punctuation">.</span>numPoints<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">let</span> dist <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>thread<span class="token punctuation">.</span>x<span class="token operator">-</span>xpos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>thread<span class="token punctuation">.</span>x<span class="token operator">-</span>xpos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span>
                           <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>thread<span class="token punctuation">.</span>y<span class="token operator">-</span>ypos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>thread<span class="token punctuation">.</span>y<span class="token operator">-</span>ypos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  nominator<span class="token operator">=</span>nominator<span class="token operator">+</span><span class="token punctuation">(</span>values<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">/</span>dist<span class="token punctuation">)</span>
  denominator<span class="token operator">=</span>denominator<span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span>dist<span class="token punctuation">)</span>

<span class="token punctuation">}</span>
<span class="token keyword">return</span> nominator<span class="token operator">/</span>denominator<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">setConstants</span><span class="token punctuation">(</span><span class="token punctuation">{</span> numPoints<span class="token operator">:</span> xPos<span class="token punctuation">.</span>length<span class="token punctuation">,</span> tiffWidth<span class="token operator">:</span> fixData<span class="token punctuation">.</span>xSize<span class="token punctuation">,</span> tiffHeight<span class="token operator">:</span> fixData<span class="token punctuation">.</span>ySize <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">setOutput</span><span class="token punctuation">(</span><span class="token punctuation">[</span>fixData<span class="token punctuation">.</span>xSize<span class="token punctuation">,</span> fixData<span class="token punctuation">.</span>ySize<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> residualsResult <span class="token operator">=</span> <span class="token function">calculateResidues</span><span class="token punctuation">(</span>xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> regression_result<span class="token punctuation">.</span>residual<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></p>
<ul>
<li>First, the station positions must be converted to pixels using the geotransform to be able to interpolate them</li>
<li>The gpu kernel function gets these positions plus the values of the errors in each station</li>
<li>Note that, since a loop with all the stations must be done for each pixel, the time spent to calculate this is the biggest of all the process.<ul>
<li>Since the distance has to be calculated, avoiding the far stations would only add an <em>if</em> statement and increase the time</li>
</ul>
</li>
</ul>
<h3 id="the-final-field"><a href="https://beta.observablehq.com/@rveciana/temperature-interpolation-using-gpu-js#final_result">The final field</a></h3>
<p>That&#39;s the easiest part, only substract the error to the original interpolation field:</p>
<p><pre><code>
<span class="token keyword">let</span> gpu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GPU</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> addResidues <span class="token operator">=</span> gpu<span class="token punctuation">.</span><span class="token function">createKernel</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">interpResult<span class="token punctuation">,</span> residuesResult</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">return</span> interpResult<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>thread<span class="token punctuation">.</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>thread<span class="token punctuation">.</span>x<span class="token punctuation">]</span> <span class="token operator">-</span> residuesResult<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>thread<span class="token punctuation">.</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>thread<span class="token punctuation">.</span>x<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">setOutput</span><span class="token punctuation">(</span><span class="token punctuation">[</span>fixData<span class="token punctuation">.</span>xSize<span class="token punctuation">,</span> fixData<span class="token punctuation">.</span>ySize<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> temperatureField <span class="token operator">=</span> <span class="token function">addResidues</span><span class="token punctuation">(</span>interpolation_result<span class="token punctuation">,</span> residuals_result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></p>
<h3 id="drawing-the-data"><a href="https://beta.observablehq.com/@rveciana/temperature-interpolation-using-gpu-js#final_result_drawing">Drawing the data</a></h3>
<p>Since the example was not about projections or mapping, I didn&#39;t draw any border nor reprojected the data nor added it into a Leaflet layer. <a href="/other/2018/04/30/mapping-with-gpujs.html">Check the previous post</a> for that. Just drawing the matrices is easy:</p>
<p><pre><code>
<span class="token keyword">let</span> gpu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GPU</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> render <span class="token operator">=</span> gpu<span class="token punctuation">.</span><span class="token function">createKernel</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">interpolation<span class="token operator">&lt;</span>em<span class="token operator">></span>result<span class="token punctuation">,</span> colorScale</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">let</span> color <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token number">255</span> <span class="token operator">*</span> <span class="token punctuation">(</span>interpolation<span class="token operator">&lt;</span><span class="token operator">/</span>em<span class="token operator">></span>result<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>constants<span class="token punctuation">.</span>height <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>thread<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>constants<span class="token punctuation">.</span>width <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>thread<span class="token punctuation">.</span>x<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>constants<span class="token punctuation">.</span>minVal<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>constants<span class="token punctuation">.</span>maxVal <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>constants<span class="token punctuation">.</span>minVal<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">color</span><span class="token punctuation">(</span>colorScale<span class="token punctuation">[</span>color <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">255</span><span class="token punctuation">,</span> colorScale<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">+</span>color <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">255</span><span class="token punctuation">,</span> colorScale<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">+</span>color <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">setConstants</span><span class="token punctuation">(</span><span class="token punctuation">{</span>width<span class="token operator">:</span> fixData<span class="token punctuation">.</span>xSize<span class="token punctuation">,</span> height<span class="token operator">:</span> fixData<span class="token punctuation">.</span>ySize<span class="token punctuation">,</span> maxVal<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span> minVal<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">setOutput</span><span class="token punctuation">(</span><span class="token punctuation">[</span>fixData<span class="token punctuation">.</span>xSize<span class="token punctuation">,</span> fixData<span class="token punctuation">.</span>ySize<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">setGraphical</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">render</span><span class="token punctuation">(</span>final_result<span class="token punctuation">,</span> tempColorScale<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></p>
<ul>
<li>Of course, the <em>graphical</em> option is used here</li>
<li>A hidden canvas with the color scale is created in an other cell of the notebook containing the colorscale. Also explained in the <a href="/other/2018/04/30/mapping-with-gpujs.html">previous post</a></li>
<li>The color is set by knowing the position of the pixel value between the minimum and maximum values</li>
</ul>
<h2 id="performance">Performance</h2>
<p>As you may have noticed, I added a time mesurement on each important step, so the final performance can be quantified. On my simple computer, the times are:</p>
<table>
<thead>
<tr>
<th>Operation</th>
<th>Ellapsed time</th>
</tr>
</thead>
<tbody><tr>
<td>Multiple linear regression</td>
<td>2 ms</td>
</tr>
<tr>
<td>Calculate the regression field</td>
<td>209 ms</td>
</tr>
<tr>
<td>Calculate the residuals field</td>
<td>1084 ms</td>
</tr>
<tr>
<td>Calculate the final field</td>
<td>52 ms</td>
</tr>
<tr>
<td>Draw the regression field</td>
<td>65 ms</td>
</tr>
<tr>
<td>Draw residuals field</td>
<td>70 ms</td>
</tr>
<tr>
<td>Draw final result</td>
<td>67 ms</td>
</tr>
<tr>
<td><strong>Total time</strong></td>
<td><strong>1549 ms</strong></td>
</tr>
</tbody></table>
<p>On the mobile phone, it&#39;s still under two seconds, which is a very good result when compared to the same code using python and without the GPU: I&#39;ll let this for the next post.</p>
<h2 id="links">Links</h2>
<ul>
<li><a href="/other/2018/04/30/mapping-with-gpujs.html">Previous post</a></li>
<li><a href="https://vimeo.com/album/5268941/video/278133346">The conference at the <em>Jornadas SIG Libre</em></a> (in Spanish)</li>
<li><a href="http://www.sigte.udg.edu/jornadassiglibre/">Jornadas SIG Libre</a> at Girona</li>
<li><a href="http://meteo.cat">Catalan Meteorological Service</a></li>
<li><a href="https://www.researchgate.net/publication/283479429_Verification_of_a_weather_radar_derived_surface_precipitation_type_product">Conference paper about the product</a></li>
<li><a href="http://www.stat.yale.edu/Courses/1997-98/101/linmult.htm">Multiple Linear Regression</a></li>
<li><a href="http://gpu.rocks">The gpu.js web site</a></li>
<li><a href="https://github.com/gpujs/gpu.js#flattened-typed-array-support">GPU.js flattened type array support</a></li>
<li><a href="http://www.numericjs.com/">numeric.js</a></li>
<li><a href="http://reliawiki.org/index.php/Multiple_Linear_Regression_Analysis">Multiple linear regression formulas</a></li>
<li><a href="https://geotiffjs.github.io/">Geotiff.js</a></li>
</ul>
<p>ObservableHQ example:</p>
<ul>
<li><a href="https://beta.observablehq.com/@rveciana/temperature-interpolation-using-gpu-js">The observable example</a></li>
<li><a href="https://beta.observablehq.com/@rveciana/temperature-interpolation-using-gpu-js#regression">Multiple linear regression</a></li>
<li><a href="https://beta.observablehq.com/@rveciana/temperature-interpolation-using-gpu-js#interpolation_result">Interpolation field</a></li>
<li><a href="https://beta.observablehq.com/@rveciana/temperature-interpolation-using-gpu-js#fix_data">Reading the fix data</a></li>
<li><a href="https://beta.observablehq.com/@rveciana/temperature-interpolation-using-gpu-js#residuals_result">Calculating the residuals field</a></li>
<li><a href="https://beta.observablehq.com/@rveciana/temperature-interpolation-using-gpu-js#final_result">Calculating the final result field</a></li>
<li><a href="https://beta.observablehq.com/@rveciana/temperature-interpolation-using-gpu-js#final_result_drawing">Drawing the final result field</a></li>
</ul>
<!-- HTML_TAG_END --></article></div></div></main>
<footer class="site-footer"><div class="wrapper"><div class="footer-col-wrapper"><div class="footer-col  footer-col-1"><ul class="contact-list"><li>GeoExamples - Roger Veciana</li></ul></div>

	<div class="footer-col  footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/rveciana"><span class="icon  icon--github"><svg viewBox="0 0 16 16"><path fill="#89b889" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"></path></svg></span>

						<span class="username">rveciana</span></a></li>

			<li><a href="https://twitter.com/rveciana"><span class="icon  icon--twitter"><svg viewBox="0 0 16 16"><path fill="#89b889" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                    c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"></path></svg></span>

						<span class="username">rveciana</span></a></li>
			<li><a href="https://www.linkedin.com/in/rogerveciana"><span class="icon  icon--twitter"><svg width="16" height="15.28958"><path d="M 0,1.77606 Q 0,1.00386 0.54054,0.50193 1.08108,0 1.94595,0 2.79537,0 3.32047,0.49421 3.86101,1.00386 3.86101,1.8224 q 0,0.74131 -0.5251,1.23552 -0.54054,0.50965 -1.42085,0.50965 l -0.0154,0 q -0.84942,0 -1.37452,-0.50965 Q 4e-5,2.54827 4e-5,1.77606 Z m 0.20078,13.51352 0,-10.3166 3.42857,0 0,10.3166 -3.42857,0 z m 5.32818,0 3.42857,0 0,-5.76062 q 0,-0.54054 0.12355,-0.83398 0.21622,-0.52509 0.65638,-0.88803 0.44015,-0.36293 1.10424,-0.36293 1.72973,0 1.72973,2.33205 l 0,5.51351 3.42857,0 0,-5.91506 Q 16,7.08881 14.91892,5.90734 13.83784,4.72587 12.06178,4.72587 q -1.99228,0 -3.10425,1.71429 l 0,0.0309 -0.0154,0 0.0154,-0.0309 0,-1.46718 -3.42857,0 q 0.0309,0.49421 0.0309,3.07336 0,2.57915 -0.0309,7.24324 z"></path></svg></span>

						<span class="username">rogerveciana</span></a></li></ul></div>

	<div class="footer-col  footer-col-3"><p class="text">I am a software developer and meteorologist who likes mapping. I put here the things I learn on my free time.</p>
		<p class="text">Roger Veciana i Rovira</p></div></div></div></footer>



	<script type="application/json" data-type="svelte-data" data-url="/summary_pages.json">{"status":200,"statusText":"","headers":{"content-type":"application/json; charset=utf-8"},"body":"[{\"title\":\"CV\",\"permalink\":\"\u002Fcv\",\"excerpt\":\"\u003Ch2 id=\\\"jobs\\\"\u003EJobs\u003C\u002Fh2\u003E\",\"avoidMainMenu\":true},{\"title\":\"About\",\"permalink\":\"\u002Fabout\",\"excerpt\":\"\u003Cp\u003E{{ site.author.name }}\u003C\u002Fp\u003E\"},{\"title\":\"Projects\",\"permalink\":\"\u002Fprojects\",\"excerpt\":\"\u003Cp\u003ESome of my personal projects:\u003C\u002Fp\u003E\"}]"}</script>

	<script type="application/json" data-type="svelte-data" data-url="gpujs-example.html.json">{"status":200,"statusText":"","headers":{"content-type":"application/json; charset=utf-8"},"body":"{\"title\":\"Complex GIS calculations with gpu.js: Temperature interpolation\",\"contents\":\"\u003Cscript type=\\\"text\u002Fjavascript\\\" async\\n  src=\\\"https:\u002F\u002Fcdn.mathjax.org\u002Fmathjax\u002Flatest\u002FMathJax.js?config=TeX-MML-AM_CHTML\\\"\u003E\\n\u003C\u002Fscript\u003E\\n\\n\u003Cp\u003EThe \u003Ca href=\\\"\u002Fother\u002F2018\u002F04\u002F30\u002Fmapping-with-gpujs.html\\\"\u003Eprevious post I wrote\u003C\u002Fa\u003E showed how to use the \u003Ca href=\\\"http:\u002F\u002Fgpu.rocks\\\"\u003Egpu.js library\u003C\u002Fa\u003E for drawing maps with JavaScript after calculating the values with the user&#39;s GPU.\u003C\u002Fp\u003E\\n\u003Cp\u003EWhile writting it, I was preparing \u003Ca href=\\\"https:\u002F\u002Fvimeo.com\u002Falbum\u002F5268941\u002Fvideo\u002F278133346\\\"\u003Ethis conference\u003C\u002Fa\u003E (in Spanish) for the 2018 edition of the \u003Ca href=\\\"http:\u002F\u002Fwww.sigte.udg.edu\u002Fjornadassiglibre\u002F\\\"\u003E&quot;Jornadas SIG Libre&quot; at Girona\u003C\u002Fa\u003E. The motivation of the talk was showing the possibilities of using the user&#39;s GPU instead of the server to make complex GIS calculations on the fly, so the speed could be much higher and the use of the server almost negligible.\u003C\u002Fp\u003E\\n\u003Ch2 id=\\\"the-example\\\"\u003EThe example\u003C\u002Fh2\u003E\\n\u003Cp\u003ESome years ago, I made a python script that calculates the temperature and relative humidity on a raster, taking as the initial data the weather stations available at the \u003Ca href=\\\"http:\u002F\u002Fmeteo.cat\\\"\u003ECatalan Meteorological Service\u003C\u002Fa\u003E. The resulting product is still in use, specially to detect if the current precipitation is in form of rain or snow. There are \u003Ca href=\\\"https:\u002F\u002Fwww.researchgate.net\u002Fpublication\u002F283479429_Verification_of_a_weather_radar_derived_surface_precipitation_type_product\\\"\u003Esome papers about this\u003C\u002Fa\u003E too.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe idea is, then, calculating a temperature field with a good resolution taking as input the weather station data. The example has several steps with intensive calculations, so it&#39;s a good study case for \u003Ca href=\\\"http:\u002F\u002Fgpu.rocks\\\"\u003Egpu.js\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe temperature depends on many things, but fits quite well this formula:\u003C\u002Fp\u003E\\n\u003Cp\u003E$$ temperature = \\\\beta\u003Cem\u003E{0} + \\\\beta\u003C\u002Fem\u003E{1} _ altitude + \\\\beta_{2} _ distanceToCoast $$\u003C\u002Fp\u003E\\n\u003Cp\u003ESo, given the station temperatures in a given moment and knowing the altitude and distance to the coast for each station, a \u003Ca href=\\\"http:\u002F\u002Fwww.stat.yale.edu\u002FCourses\u002F1997-98\u002F101\u002Flinmult.htm\\\"\u003Emultiple-linear regrssion\u003C\u002Fa\u003E can be done to get a formula.\u003C\u002Fp\u003E\\n\u003Cp\u003ETo calculate the multipl-linear regression, the \u003Ca href=\\\"http:\u002F\u002Freliawiki.org\u002Findex.php\u002FMultiple_Linear_Regression_Analysis\\\"\u003Ematricial formula is this one\u003C\u002Fa\u003E:\u003C\u002Fp\u003E\\n\u003Cp\u003E$$\\n\\\\hat{\\\\beta}=(X^{T}X)^{-1}X^{T}y\\\\\\n\\\\hat{y}=X\\\\hat{\\\\beta}\\n$$\u003C\u002Fp\u003E\\n\u003Cp\u003ESo there are matrix transpositions, matrix multiplications and other operations that are basic gpu.js examples. Anyway, this step uses only few values (we will be using about 180 weather stations), so I will use \u003Ca href=\\\"http:\u002F\u002Fwww.numericjs.com\u002F\\\"\u003Enumeric.js\u003C\u002Fa\u003E that is still fast enough and simplifies the code.\u003C\u002Fp\u003E\\n\u003Cp\u003EOnce the \u003Cem\u003Ebeta values\u003C\u002Fem\u003E are calculated, a temperature field can be created if the altitude and distance values for each pixel are known. This is quite fast to do in gpu.js.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe result will look like this:\u003C\u002Fp\u003E\\n\u003Cimg src=\\\"\u002Fimages\u002Fother\u002Fcomplex-gis-calculations-gpu\u002Ffirst_temp.png\\\"\u002F\u003E\\n\\n\u003Cp\u003EThe problem with stopping here is that we are assuming that the formula is valid for all the territory, but we know that some regions have their own particularities (some regions may be a bit hotter or colder than what the formula expect). Let&#39;s try to correct that with the \u003Cem\u003Eresidues method\u003C\u002Fem\u003E:\u003C\u002Fp\u003E\\n\u003Cp\u003EFor each station, the real value is:\u003C\u002Fp\u003E\\n\u003Cp\u003E$$temperature = fit + residual$$\u003C\u002Fp\u003E\\n\u003Cp\u003EUsing the matricial notation ,the errors or residuals are:\u003C\u002Fp\u003E\\n\u003Cp\u003E$$e=y-\\\\hat{y}$$\u003C\u002Fp\u003E\\n\u003Cp\u003EOnce we have the error in each point, we can interpolate them to create a \u003Cem\u003Eresiduals field\u003C\u002Fem\u003E that can be added to the original temperature calculation. To do it, we will use the inverse of the distance, which will give a result similar to:\u003C\u002Fp\u003E\\n\u003Cimg src=\\\"\u002Fimages\u002Fother\u002Fcomplex-gis-calculations-gpu\u002Finverse.png\\\"\u002F\u003E\\n\\n\u003Cp\u003EFinally, when adding the layer, some differences emerge:\u003C\u002Fp\u003E\\n\u003Cimg src=\\\"\u002Fimages\u002Fother\u002Fcomplex-gis-calculations-gpu\u002Ffinal_result.png\\\"\u002F\u003E\\n\\n\u003Cp\u003ESo, to create the final map, the following things must be calculated. We will use a 1000x1000 pixels so the calculation is long using the CPU:\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003ECalculation of the multiple linear regression\u003C\u002Fli\u003E\\n\u003Cli\u003ECreation of the temperature raster from the regression formula (GPU 1000x1000 px)\u003C\u002Fli\u003E\\n\u003Cli\u003EResiduals calculation\u003C\u002Fli\u003E\\n\u003Cli\u003EResiduals interpolation (GPU 1000x1000 px)\u003C\u002Fli\u003E\\n\u003Cli\u003EFinal temperature field adding the temperature and residuals (GPU 1000x1000 px)\u003C\u002Fli\u003E\\n\u003Cli\u003ELayer representation (GPU 1000x1000 px)\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Ch2 id=\\\"the-code\\\"\u003EThe code\u003C\u002Fh2\u003E\\n\u003Cp\u003ETo make the example interactive and easier to split and understand, I made \u003Ca href=\\\"https:\u002F\u002Fbeta.observablehq.com\u002F@rveciana\u002Ftemperature-interpolation-using-gpu-js\\\"\u003Ethis observable notebook\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\\n\u003Ch3 id=\\\"multiple-linear-regression\\\"\u003E\u003Ca href=\\\"https:\u002F\u002Fbeta.observablehq.com\u002F@rveciana\u002Ftemperature-interpolation-using-gpu-js#regression\\\"\u003EMultiple linear regression\u003C\u002Fa\u003E\u003C\u002Fh3\u003E\\n\u003Cp\u003EI&#39;m using \u003Ca href=\\\"http:\u002F\u002Fwww.numericjs.com\u002F\\\"\u003Enumeric.js\u003C\u002Fa\u003E here to avoid many complex gpu.js coding, since with only two hundred weather station, the ellapsed time is a very small part of the total (2 ms).\\n\u003Cpre\u003E\u003Ccode\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E result \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E conv \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003EconvertData\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Edata\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EX\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E conv\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EX\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EY\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E conv\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EY\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EX_T\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E numeric\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Etranspose\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EX\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E multipliedXMatrix \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E numeric\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Edot\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EX_T\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EX\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E LeftSide \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E numeric\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Einv\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003EmultipliedXMatrix\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E RightSide \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E numeric\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Edot\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EX_T\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EY\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\nresult\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ebeta \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E numeric\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Edot\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003ELeftSide\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003ERightSide\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E yhat \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E numeric\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Edot\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EX\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E result\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ebeta\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\nresult\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eresidual \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E numeric\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Esub\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EY\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E yhat\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003ENotice that the code is very easy to understand given the original formula:\u003C\u002Fp\u003E\\n\u003Cp\u003E$$\\n\\\\hat{\\\\beta}=(X^{T}X)^{-1}X^{T}y\\\\\\n\\\\hat{y}=X\\\\hat{\\\\beta}\\n$$\u003C\u002Fp\u003E\\n\u003Ch3 id=\\\"calculating-the-regression-field\\\"\u003E\u003Ca href=\\\"https:\u002F\u002Fbeta.observablehq.com\u002F@rveciana\u002Ftemperature-interpolation-using-gpu-js#interpolation_result\\\"\u003ECalculating the regression field\u003C\u002Fa\u003E\u003C\u002Fh3\u003E\\n\u003Cp\u003EIn this case, \u003Ca href=\\\"http:\u002F\u002Fgpu.rocks\\\"\u003Egpu.js\u003C\u002Fa\u003E will be used, since I&#39;ve set a 1000x970 output field, which involves repeating the same operation about one million times, and this is where the gpu makes things much faster:\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cpre\u003E\u003Ccode\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E gpu \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EGPU\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E calculateInterp \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E gpu\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003EcreateKernel\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003Ealtitude\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E dist\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E regrCoefs\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E regrCoefs\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E regrCoefs\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003Ea href\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E\\\"\u002Fother\u002F2018\u002F04\u002F30\u002Fmapping-with-gpujs.html\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Ea\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E _ altitude\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ethread\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ey\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ethread\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ex\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E regrCoefs\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003Ea href\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E\\\"http:\u002F\u002Fgpu.rocks\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Ea\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E _ dist\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ethread\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ey\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ethread\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ex\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003EsetOutput\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003EfixData\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003ExSize\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E fixData\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003EySize\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E interpResult \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003EcalculateInterp\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token constant\\\"\u003EGPU\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Einput\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003EFloat32Array\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Efrom\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003EfixData\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Edata\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003Ea href\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E\\\"\u002Fother\u002F2018\u002F04\u002F30\u002Fmapping-with-gpujs.html\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Ea\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E1000\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E968\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token constant\\\"\u003EGPU\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Einput\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003EFloat32Array\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Efrom\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003EfixData\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Edata\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E1000\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E968\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\nregression_result\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ebeta\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EAs always when using gpu.js, the kernel mush be generated first. In this case, the parameters are altitude and distance to the sea, which are just matrices read from a goetiff, since are fixed values, and the regression result. Check the \u003Ca href=\\\"https:\u002F\u002Fbeta.observablehq.com\u002F@rveciana\u002Ftemperature-interpolation-using-gpu-js#fix_data\\\"\u003Efix data cell\u003C\u002Fa\u003E to see how to read the data as a Float32 array and calculate the geotransform using the \u003Ca href=\\\"https:\u002F\u002Fgeotiffjs.github.io\u002F\\\"\u003EGeoTIFF.js library\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe formula itself to apply in the GPU is the independent term plus the variables multiplied by the coefficient:\u003C\u002Fp\u003E\\n\u003Cp\u003E$$ temperature = \\\\beta\u003Cem\u003E{0} + \\\\beta\u003C\u002Fem\u003E{1} _ altitude + \\\\beta_{2} _ distanceToCoast $$\u003C\u002Fp\u003E\\n\u003Cp\u003EAlso, I used the GPU.input method to pass the big matrices, since it&#39;s much faster. Check the \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Fgpujs\u002Fgpu.js#flattened-typed-array-support\\\"\u003EFlattened array type support section\u003C\u002Fa\u003E of the docs to see how it works.\u003C\u002Fp\u003E\\n\u003Ch3 id=\\\"calculating-the-residuals-field\\\"\u003E\u003Ca href=\\\"https:\u002F\u002Fbeta.observablehq.com\u002F@rveciana\u002Ftemperature-interpolation-using-gpu-js#residuals_result\\\"\u003ECalculating the residuals field\u003C\u002Fa\u003E\u003C\u002Fh3\u003E\\n\u003Cp\u003ETo calculate the residuald field, we take the error in each weather station and apply the inverse of the distance in each pixel of the field. It&#39;s the most intensive calculation of all the process.\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cpre\u003E\u003Ccode\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E xPos \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E station_data\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Emap\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003Ed\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003E\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ed\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Elon \u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003E fixData\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003EgeoTransform\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003EfixData\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003EgeoTransform\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003Ea href\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E\\\"\u002Fother\u002F2018\u002F04\u002F30\u002Fmapping-with-gpujs.html\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Ea\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E yPos \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E station_data\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Emap\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003Ed\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003E\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ed\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Elat \u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003E fixData\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003EgeoTransform\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003Ea href\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E\\\"https:\u002F\u002Fvimeo.com\u002Falbum\u002F5268941\u002Fvideo\u002F278133346\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E3\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Ea\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003EfixData\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003EgeoTransform\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003Ea href\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E\\\"http:\u002F\u002Fmeteo.cat\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E5\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Ea\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E gpu \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EGPU\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E calculateResidues \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E gpu\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003EcreateKernel\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003Expos\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E ypos\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E values\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E nominator\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E denominator\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E flagDist \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E i \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E i \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Econstants\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003EnumPoints\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E i\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E\\n\\n  \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E dist \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E5\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E Math\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Esqrt\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ethread\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ex\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003Expos\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003Ei\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ethread\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ex\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003Expos\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003Ei\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E\\n                           \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ethread\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ey\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003Eypos\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003Ei\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ethread\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ey\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003Eypos\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003Ei\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  nominator\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003Enominator\u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Evalues\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003Ei\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Edist\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n  denominator\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003Edenominator\u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Edist\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E nominator\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Edenominator\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003EsetConstants\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E numPoints\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E xPos\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Elength\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E tiffWidth\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E fixData\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003ExSize\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E tiffHeight\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E fixData\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003EySize \u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003EsetOutput\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003EfixData\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003ExSize\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E fixData\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003EySize\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E residualsResult \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003EcalculateResidues\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003ExPos\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E yPos\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E regression_result\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eresidual\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003EFirst, the station positions must be converted to pixels using the geotransform to be able to interpolate them\u003C\u002Fli\u003E\\n\u003Cli\u003EThe gpu kernel function gets these positions plus the values of the errors in each station\u003C\u002Fli\u003E\\n\u003Cli\u003ENote that, since a loop with all the stations must be done for each pixel, the time spent to calculate this is the biggest of all the process.\u003Cul\u003E\\n\u003Cli\u003ESince the distance has to be calculated, avoiding the far stations would only add an \u003Cem\u003Eif\u003C\u002Fem\u003E statement and increase the time\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Ch3 id=\\\"the-final-field\\\"\u003E\u003Ca href=\\\"https:\u002F\u002Fbeta.observablehq.com\u002F@rveciana\u002Ftemperature-interpolation-using-gpu-js#final_result\\\"\u003EThe final field\u003C\u002Fa\u003E\u003C\u002Fh3\u003E\\n\u003Cp\u003EThat&#39;s the easiest part, only substract the error to the original interpolation field:\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cpre\u003E\u003Ccode\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E gpu \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EGPU\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E addResidues \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E gpu\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003EcreateKernel\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003EinterpResult\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E residuesResult\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E interpResult\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ethread\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ey\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ethread\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ex\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003E residuesResult\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ethread\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ey\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ethread\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ex\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003EsetOutput\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003EfixData\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003ExSize\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E fixData\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003EySize\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E temperatureField \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003EaddResidues\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Einterpolation_result\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E residuals_result\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fp\u003E\\n\u003Ch3 id=\\\"drawing-the-data\\\"\u003E\u003Ca href=\\\"https:\u002F\u002Fbeta.observablehq.com\u002F@rveciana\u002Ftemperature-interpolation-using-gpu-js#final_result_drawing\\\"\u003EDrawing the data\u003C\u002Fa\u003E\u003C\u002Fh3\u003E\\n\u003Cp\u003ESince the example was not about projections or mapping, I didn&#39;t draw any border nor reprojected the data nor added it into a Leaflet layer. \u003Ca href=\\\"\u002Fother\u002F2018\u002F04\u002F30\u002Fmapping-with-gpujs.html\\\"\u003ECheck the previous post\u003C\u002Fa\u003E for that. Just drawing the matrices is easy:\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cpre\u003E\u003Ccode\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E gpu \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EGPU\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E render \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E gpu\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003EcreateKernel\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003Einterpolation\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003Eem\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003Eresult\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E colorScale\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E color \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E Math\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eceil\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E255\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Einterpolation\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Eem\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003Eresult\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Econstants\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eheight \u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E1\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ethread\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ey\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Econstants\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ewidth \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ethread\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ex\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Econstants\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003EminVal\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Econstants\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003EmaxVal \u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Econstants\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003EminVal\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Ecolor\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003EcolorScale\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003Ecolor \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E255\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E colorScale\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003Ecolor \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E255\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E colorScale\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003Ecolor \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E255\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003EsetConstants\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003Ewidth\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E fixData\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003ExSize\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E height\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E fixData\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003EySize\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E maxVal\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E20\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E minVal\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E7\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003EsetOutput\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003EfixData\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003ExSize\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E fixData\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003EySize\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003EsetGraphical\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token boolean\\\"\u003Etrue\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token function\\\"\u003Erender\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Efinal_result\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E tempColorScale\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003EOf course, the \u003Cem\u003Egraphical\u003C\u002Fem\u003E option is used here\u003C\u002Fli\u003E\\n\u003Cli\u003EA hidden canvas with the color scale is created in an other cell of the notebook containing the colorscale. Also explained in the \u003Ca href=\\\"\u002Fother\u002F2018\u002F04\u002F30\u002Fmapping-with-gpujs.html\\\"\u003Eprevious post\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003EThe color is set by knowing the position of the pixel value between the minimum and maximum values\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Ch2 id=\\\"performance\\\"\u003EPerformance\u003C\u002Fh2\u003E\\n\u003Cp\u003EAs you may have noticed, I added a time mesurement on each important step, so the final performance can be quantified. On my simple computer, the times are:\u003C\u002Fp\u003E\\n\u003Ctable\u003E\\n\u003Cthead\u003E\\n\u003Ctr\u003E\\n\u003Cth\u003EOperation\u003C\u002Fth\u003E\\n\u003Cth\u003EEllapsed time\u003C\u002Fth\u003E\\n\u003C\u002Ftr\u003E\\n\u003C\u002Fthead\u003E\\n\u003Ctbody\u003E\u003Ctr\u003E\\n\u003Ctd\u003EMultiple linear regression\u003C\u002Ftd\u003E\\n\u003Ctd\u003E2 ms\u003C\u002Ftd\u003E\\n\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\\n\u003Ctd\u003ECalculate the regression field\u003C\u002Ftd\u003E\\n\u003Ctd\u003E209 ms\u003C\u002Ftd\u003E\\n\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\\n\u003Ctd\u003ECalculate the residuals field\u003C\u002Ftd\u003E\\n\u003Ctd\u003E1084 ms\u003C\u002Ftd\u003E\\n\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\\n\u003Ctd\u003ECalculate the final field\u003C\u002Ftd\u003E\\n\u003Ctd\u003E52 ms\u003C\u002Ftd\u003E\\n\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\\n\u003Ctd\u003EDraw the regression field\u003C\u002Ftd\u003E\\n\u003Ctd\u003E65 ms\u003C\u002Ftd\u003E\\n\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\\n\u003Ctd\u003EDraw residuals field\u003C\u002Ftd\u003E\\n\u003Ctd\u003E70 ms\u003C\u002Ftd\u003E\\n\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\\n\u003Ctd\u003EDraw final result\u003C\u002Ftd\u003E\\n\u003Ctd\u003E67 ms\u003C\u002Ftd\u003E\\n\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\\n\u003Ctd\u003E\u003Cstrong\u003ETotal time\u003C\u002Fstrong\u003E\u003C\u002Ftd\u003E\\n\u003Ctd\u003E\u003Cstrong\u003E1549 ms\u003C\u002Fstrong\u003E\u003C\u002Ftd\u003E\\n\u003C\u002Ftr\u003E\\n\u003C\u002Ftbody\u003E\u003C\u002Ftable\u003E\\n\u003Cp\u003EOn the mobile phone, it&#39;s still under two seconds, which is a very good result when compared to the same code using python and without the GPU: I&#39;ll let this for the next post.\u003C\u002Fp\u003E\\n\u003Ch2 id=\\\"links\\\"\u003ELinks\u003C\u002Fh2\u003E\\n\u003Cul\u003E\\n\u003Cli\u003E\u003Ca href=\\\"\u002Fother\u002F2018\u002F04\u002F30\u002Fmapping-with-gpujs.html\\\"\u003EPrevious post\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fvimeo.com\u002Falbum\u002F5268941\u002Fvideo\u002F278133346\\\"\u003EThe conference at the \u003Cem\u003EJornadas SIG Libre\u003C\u002Fem\u003E\u003C\u002Fa\u003E (in Spanish)\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"http:\u002F\u002Fwww.sigte.udg.edu\u002Fjornadassiglibre\u002F\\\"\u003EJornadas SIG Libre\u003C\u002Fa\u003E at Girona\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"http:\u002F\u002Fmeteo.cat\\\"\u003ECatalan Meteorological Service\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fwww.researchgate.net\u002Fpublication\u002F283479429_Verification_of_a_weather_radar_derived_surface_precipitation_type_product\\\"\u003EConference paper about the product\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"http:\u002F\u002Fwww.stat.yale.edu\u002FCourses\u002F1997-98\u002F101\u002Flinmult.htm\\\"\u003EMultiple Linear Regression\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"http:\u002F\u002Fgpu.rocks\\\"\u003EThe gpu.js web site\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Fgpujs\u002Fgpu.js#flattened-typed-array-support\\\"\u003EGPU.js flattened type array support\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"http:\u002F\u002Fwww.numericjs.com\u002F\\\"\u003Enumeric.js\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"http:\u002F\u002Freliawiki.org\u002Findex.php\u002FMultiple_Linear_Regression_Analysis\\\"\u003EMultiple linear regression formulas\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fgeotiffjs.github.io\u002F\\\"\u003EGeotiff.js\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Cp\u003EObservableHQ example:\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fbeta.observablehq.com\u002F@rveciana\u002Ftemperature-interpolation-using-gpu-js\\\"\u003EThe observable example\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fbeta.observablehq.com\u002F@rveciana\u002Ftemperature-interpolation-using-gpu-js#regression\\\"\u003EMultiple linear regression\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fbeta.observablehq.com\u002F@rveciana\u002Ftemperature-interpolation-using-gpu-js#interpolation_result\\\"\u003EInterpolation field\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fbeta.observablehq.com\u002F@rveciana\u002Ftemperature-interpolation-using-gpu-js#fix_data\\\"\u003EReading the fix data\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fbeta.observablehq.com\u002F@rveciana\u002Ftemperature-interpolation-using-gpu-js#residuals_result\\\"\u003ECalculating the residuals field\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fbeta.observablehq.com\u002F@rveciana\u002Ftemperature-interpolation-using-gpu-js#final_result\\\"\u003ECalculating the final result field\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fbeta.observablehq.com\u002F@rveciana\u002Ftemperature-interpolation-using-gpu-js#final_result_drawing\\\"\u003EDrawing the final result field\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\",\"tags\":[\"GPU\",\"gpujs\",\"canvas\",\"leaflet\"],\"date\":\"2018-09-17T00:00:00.000Z\",\"thumbnail\":\"\u002Fimages\u002Fother\u002Fcomplex-gis-calculations-gpu\u002Ftwitter.png\"}"}</script>
</div>
	</body>
</html>
