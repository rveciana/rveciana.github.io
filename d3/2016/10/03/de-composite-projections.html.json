{"title":"d3-composite-projections update","contents":"<p>Last year I created the first version of the <a href=\"/d3/2015/05/12/d3-composite-projections.html\">d3-composite-projections library</a>, but some things have changed since then, so a major update has been released. This update includes:</p>\n<ol>\n<li>New projections have been added</li>\n<li>D3js v4 is used instead of v3. All the code has been re-written using ES2015</li>\n</ol>\n<img src=\"/images/d3/d3-composite-projections2/conicConformalFrance.png\" width=\"70%\"/>\n\n<h2 id=\"projections\">Projections</h2>\n<p>The available projections for this 1.0.1 version are:</p>\n<ul>\n<li>USA: <a href=\"http://bl.ocks.org/rveciana/ee2119324e835e1bad42d0e4c1b9ab0d\">geoAlbersUSA</a></li>\n<li>USA Territories: <a href=\"http://bl.ocks.org/rveciana/5040be82aea528b6f785464f8816690f\">geoAlbersUsaTerritories</a> as albersUsa, but adding the American Samoa, Puerto Rico, U.S. Virgin Islands, Guam and Northern Marianas Islands, so all the <a href=\"https://en.wikipedia.org/wiki/List_of_districts_of_the_House_of_Representatives_of_Japan\">Congressional Districts</a> are represented</li>\n<li>France: <a href=\"http://bl.ocks.org/rveciana/0ff189b15449330828605fe4e118a716\">geoConicConformalFrance</a></li>\n<li>Portugal: <a href=\"http://bl.ocks.org/rveciana/ee09a2c3732f3e0d6872d1a7f796a29b\">geoConicConformalPortugal</a></li>\n<li>Spain: <a href=\"http://bl.ocks.org/rveciana/d635afded8c4eae36ecf61a15bdf0a98\">geoConicConformalSpain</a></li>\n<li>Europe: <a href=\"http://bl.ocks.org/rveciana/ced3109b372039afbcf7278ba3d14250\">geoConicConformalEurope</a> (thought for Eurostat data)</li>\n<li>Japan: <a href=\"http://bl.ocks.org/rveciana/1f5399d8887428ad67665d106ec089d1\">geoConicEquidistantJapan</a></li>\n<li>Ecuador: <a href=\"http://bl.ocks.org/rveciana/306a5202e1facf7a22e08fbb1044f568\">geoMercatorEcuador</a></li>\n<li>Chile: <a href=\"http://bl.ocks.org/rveciana/3a31865e82f4fab8ac2522545bbc7741\">geoTransverseMercatorChile</a>, including the <a href=\"https://en.wikipedia.org/wiki/Chilean_Antarctic_Territory\">Chilean Antarctic Territory</a></li>\n</ul>\n<p>If you want other countries, I&#39;ll be glad to add them. Sometimes it&#39;s hard to imagine the real uses for this when it&#39;s not a country you know well.</p>\n<h2 id=\"new-code-style\">New code style</h2>\n<p>When <a href=\"https://bost.ocks.org/mike/\">Mike Bostock</a> released the <a href=\"https://github.com/d3/d3-geo\">d3-geo package</a> I used it as the template, so all the tests and code are written using the same style.</p>\n<p>Now, d3-composite-projections can be used with Canvas and SVG, from nodejs, nodejs+browserify, directly from a JavaScript file, etc. Let&#39;s see an example for each case:</p>\n<ul>\n<li><a href=\"#svg--javascript-file\">SVG + JavaScript file</a></li>\n<li><a href=\"#svg--rollup--javascript-file\">SVG + rollup + JavaScript file</a></li>\n<li><a href=\"#svg--browserify\">SVG + browserify</a></li>\n<li><a href=\"#canvas-with-nodejs\">Canvas with Nodejs</a></li>\n</ul>\n<h2 id=\"svg--javascript-file\">SVG + JavaScript file</h2>\n<p>The most common case to see. <a href=\"http://bl.ocks.org/rveciana/fe6b452c853146e674dd6dd09c1cc6e3\">This example showing the Congressional Representatives</a> uses it and is similar to <a href=\"http://bl.ocks.org/rveciana/f0a8ec08d0b63d0cdc6985cc37468b9a\">this Chilean map using the old version</a>. The code:</p>\n<p><pre><code>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">DOCTYPE</span> html<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>meta charset<span class=\"token operator\">=</span><span class=\"token string\">\"utf-8\"</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>style<span class=\"token operator\">></span>\n#tooltip <span class=\"token punctuation\">{</span>\n  position<span class=\"token operator\">:</span> absolute<span class=\"token punctuation\">;</span>\n  top<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  left<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  z<span class=\"token operator\">-</span>index<span class=\"token operator\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\n  margin<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  padding<span class=\"token operator\">:</span> <span class=\"token number\">10</span>px<span class=\"token punctuation\">;</span>\n  width<span class=\"token operator\">:</span> <span class=\"token number\">200</span>px<span class=\"token punctuation\">;</span>\n  height<span class=\"token operator\">:</span> <span class=\"token number\">70</span>px<span class=\"token punctuation\">;</span>\n  color<span class=\"token operator\">:</span> white<span class=\"token punctuation\">;</span>\n  font<span class=\"token operator\">-</span>family<span class=\"token operator\">:</span> sans<span class=\"token operator\">-</span>serif<span class=\"token punctuation\">;</span>\n  font<span class=\"token operator\">-</span>size<span class=\"token operator\">:</span> <span class=\"token number\">0.9</span>em<span class=\"token punctuation\">;</span>\n  font<span class=\"token operator\">-</span>weight<span class=\"token operator\">:</span> bold<span class=\"token punctuation\">;</span>\n  text<span class=\"token operator\">-</span>align<span class=\"token operator\">:</span> center<span class=\"token punctuation\">;</span>\n  background<span class=\"token operator\">-</span>color<span class=\"token operator\">:</span> <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.55</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  opacity<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  pointer<span class=\"token operator\">-</span>events<span class=\"token operator\">:</span> none<span class=\"token punctuation\">;</span>\n  border<span class=\"token operator\">-</span>radius<span class=\"token operator\">:</span><span class=\"token number\">5</span>px<span class=\"token punctuation\">;</span>\n  transition<span class=\"token operator\">:</span> <span class=\"token number\">.2</span>s<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>style<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>body<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>div id<span class=\"token operator\">=</span><span class=\"token string\">\"container\"</span><span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>div id<span class=\"token operator\">=</span><span class=\"token string\">\"tooltip\"</span><span class=\"token operator\">/</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>script src<span class=\"token operator\">=</span><span class=\"token string\">\"https://d3js.org/d3.v4.min.js\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>script src<span class=\"token operator\">=</span><span class=\"token string\">\"http://d3js.org/topojson.v1.min.js\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>script src<span class=\"token operator\">=</span><span class=\"token string\">\"https://cdnjs.cloudflare.com/ajax/libs/d3-composite-projections/1.0.1/d3-composite-projections.min.js\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>script<span class=\"token operator\">></span>\n<span class=\"token keyword\">var</span> width <span class=\"token operator\">=</span> <span class=\"token number\">960</span><span class=\"token punctuation\">,</span>\n    height <span class=\"token operator\">=</span> <span class=\"token number\">500</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token keyword\">var</span> projection <span class=\"token operator\">=</span> d3<span class=\"token punctuation\">.</span><span class=\"token function\">geoAlbersUsaTerritories</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> path <span class=\"token operator\">=</span> d3<span class=\"token punctuation\">.</span><span class=\"token function\">geoPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">projection</span><span class=\"token punctuation\">(</span>projection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> svg <span class=\"token operator\">=</span> d3<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#container\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"svg\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"width\"</span><span class=\"token punctuation\">,</span> width<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"height\"</span><span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">&lt;</span>pre<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>code<span class=\"token operator\">></span><span class=\"token keyword\">var</span> t <span class=\"token operator\">=</span> d3<span class=\"token punctuation\">.</span><span class=\"token function\">transition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>code<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>pre<span class=\"token operator\">></span>\nd3<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"us_congressional_districts.json\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error<span class=\"token punctuation\">,</span> us</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">var</span> us <span class=\"token operator\">=</span> topojson<span class=\"token punctuation\">.</span><span class=\"token function\">feature</span><span class=\"token punctuation\">(</span>us<span class=\"token punctuation\">,</span> us<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span>us_congressional_districts<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nsvg<span class=\"token punctuation\">.</span><span class=\"token function\">selectAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".region\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span>us<span class=\"token punctuation\">.</span>features<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">enter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"path\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"class\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"region\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"d\"</span><span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fill\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">d</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>d<span class=\"token punctuation\">.</span>properties<span class=\"token punctuation\">.</span><span class=\"token constant\">PARTY_AFF</span><span class=\"token operator\">==</span><span class=\"token string\">\"Democrat\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">return</span> <span class=\"token string\">\"#4a86e8\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">else</span>\n<span class=\"token keyword\">return</span> <span class=\"token string\">\"#e84a4a\"</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"stroke\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#000\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"stroke-width\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"0.5px\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mouseover\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">d</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n<span class=\"token comment\">//Show the tooltip</span>\n<span class=\"token keyword\">var</span> x <span class=\"token operator\">=</span> d3<span class=\"token punctuation\">.</span>event<span class=\"token punctuation\">.</span>pageX<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> y <span class=\"token operator\">=</span> d3<span class=\"token punctuation\">.</span>event<span class=\"token punctuation\">.</span>pageY <span class=\"token operator\">-</span> <span class=\"token number\">40</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">&lt;</span>pre<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>code<span class=\"token operator\">></span>    d3<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#tooltip\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"left\"</span><span class=\"token punctuation\">,</span> x <span class=\"token operator\">+</span> <span class=\"token string\">\"px\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"top\"</span><span class=\"token punctuation\">,</span> y <span class=\"token operator\">+</span> <span class=\"token string\">\"px\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"opacity\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">html</span><span class=\"token punctuation\">(</span> d<span class=\"token punctuation\">.</span>properties<span class=\"token punctuation\">.</span><span class=\"token constant\">STATE</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" dist: \"</span> <span class=\"token operator\">+</span> d<span class=\"token punctuation\">.</span>properties<span class=\"token punctuation\">.</span><span class=\"token constant\">CONG_DIST</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"&lt;br/>\"</span> <span class=\"token operator\">+</span>d<span class=\"token punctuation\">.</span>properties<span class=\"token punctuation\">.</span><span class=\"token constant\">CONG_REP</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"&lt;br/>\"</span> <span class=\"token operator\">+</span> d<span class=\"token punctuation\">.</span>properties<span class=\"token punctuation\">.</span><span class=\"token constant\">PARTY_AFF</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mouseout\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">//Hide the tooltip</span>\n      d3<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#tooltip\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"opacity\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>code<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>pre<span class=\"token operator\">></span>\nsvg\n<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"path\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fill\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"none\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"stroke\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"#000\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"stroke-dasharray\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"5,5\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"d\"</span><span class=\"token punctuation\">,</span> projection<span class=\"token punctuation\">.</span><span class=\"token function\">getCompositionBorders</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n</code></pre></p>\n<ul>\n<li>The new D3js v4 can be included from this address: <a href=\"https://d3js.org/d3.v4.min.js\">https://d3js.org/d3.v4.min.js</a></li>\n<li>The d3-composite-projections is uploaded at the <a href=\"https://cdnjs.cloudflare.com/\">cdnjs project</a></li>\n<li>An other option is including the D3js v4 modules needed, one by one, as in <a href=\"http://bl.ocks.org/rveciana/a2a1c21ca1c71cd3ec116cc911e5fce9\">this example</a>. It&#39;s really difficult to manage, it may be better using nodejs and rollup, as in the next point</li>\n<li>Note some changes from a usual version 3 script:<ul>\n<li>Adding the <em>geo</em> as a prefix to many functions: <em>path</em> becomes <em>geoPath</em></li>\n<li>The transitions have changed a little. a transition is declared before appending it to the events</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"svg--rollup--javascript-file\">SVG + rollup + JavaScript file</h2>\n<p>D3js v4 and d3-composite-projections are build using ES2015. Using <a href=\"http://rollupjs.org\">rollup.js</a> instead of including all the d3js coded, including the non used functions, lets you use ES2015 and uses only the needed modules, so the resulting JavaScript file is much smaller (80% less in this case!). I took the information from <a href=\"https://medium.com/@richavyas/d3-js-the-custom-modular-bundle-now-bebd6f25bc8b#.kvi0p3n1c\">this post by Richa Vyas</a>.</p>\n<p>The code can be <a href=\"http://bl.ocks.org/rveciana/0e73c92391def44331d2069755edc199\">found in this gist</a>.</p>\n<p>Basically, the involved files are:</p>\n<ul>\n<li>package.json, which makes possible to install all the dependencies with <em>npm install</em> and sets the <em>build</em> script</li>\n<li>d3.js, which is the entry point for <em>rollup</em>. It takes the needed dependencies and sets the names that the final script must use<ul>\n<li>Note that the used functions must be selected from each module i.e. <em>json</em> from the <em>request</em> module</li>\n</ul>\n</li>\n<li>index.html is a regular file with its <em>html</em> and <em>JavaScript</em> code, but with some things changed because of the names used in the <em>d3.js</em> file<ul>\n<li>rollup has set the d3 prefix so all the functions are available wsing <em>d3.</em> as with the old v3 version</li>\n<li>topojson is included so, this time, it must be accessed with the d3 prefix too. Another option would be not to include into the <em>d3.js</em> file</li>\n</ul>\n</li>\n</ul>\n<p>The first time may be a bit tricky, but the final small size it&#39;s worth the effort.</p>\n<h2 id=\"svg--browserify\">SVG + browserify</h2>\n<p>All the examples linked to the projections are done this way. Create an <em>html</em> file:\n<pre><code>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">DOCTYPE</span> html<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>meta charset<span class=\"token operator\">=</span><span class=\"token string\">\"utf-8\"</span><span class=\"token operator\">></span>\n\n<span class=\"token operator\">&lt;</span>body<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>div id<span class=\"token operator\">=</span><span class=\"token string\">\"map\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n\n  <span class=\"token operator\">&lt;</span>script src<span class=\"token operator\">=</span><span class=\"token string\">\"bundle.js\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n\n\n</code></pre></p>\n<p>And then, the node file (I called it draw.js):</p>\n<p><pre><code>\n<span class=\"token keyword\">var</span> d3_composite <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"d3-composite-projections\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> d3_geo <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"d3-geo\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> d3_request <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"d3-request\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> d3_selection <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"d3-selection\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> d3_transition <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"d3-transition\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> topojson <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"topojson\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> width <span class=\"token operator\">=</span> <span class=\"token number\">960</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> height <span class=\"token operator\">=</span> <span class=\"token number\">500</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> projection <span class=\"token operator\">=</span> d3_composite<span class=\"token punctuation\">.</span><span class=\"token function\">geoConicConformalEurope</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> path <span class=\"token operator\">=</span> d3_geo<span class=\"token punctuation\">.</span><span class=\"token function\">geoPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">projection</span><span class=\"token punctuation\">(</span>projection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> svg <span class=\"token operator\">=</span> d3_selection<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"map\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"svg\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"width\"</span><span class=\"token punctuation\">,</span> width<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"height\"</span><span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> t <span class=\"token operator\">=</span> d3_transition<span class=\"token punctuation\">.</span><span class=\"token function\">transition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"interrupt\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">d<span class=\"token punctuation\">,</span>i</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nd3_request<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"nuts0.json\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error<span class=\"token punctuation\">,</span> topojsonData</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">var</span> us <span class=\"token operator\">=</span> topojson<span class=\"token punctuation\">.</span><span class=\"token function\">feature</span><span class=\"token punctuation\">(</span>topojsonData<span class=\"token punctuation\">,</span> topojsonData<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span>nuts0<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">&lt;</span>pre<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>code<span class=\"token operator\">></span>svg<span class=\"token punctuation\">.</span><span class=\"token function\">selectAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".region\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span>us<span class=\"token punctuation\">.</span>features<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">enter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"path\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"d\"</span><span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"class\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"region\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fill\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#aca\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"stroke\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#000\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"stroke-width\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"0.5px\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mouseover\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">d<span class=\"token punctuation\">,</span>i</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    d3_selection<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">transition</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fill\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"red\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mouseout\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">d<span class=\"token punctuation\">,</span>i</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    d3_selection<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">interrupt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    d3_selection<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">transition</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fill\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#aca\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  svg\n    <span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"path\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fill\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"none\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"stroke\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"#f00\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"d\"</span><span class=\"token punctuation\">,</span> projection<span class=\"token punctuation\">.</span><span class=\"token function\">getCompositionBorders</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>code<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>pre<span class=\"token operator\">></span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></p>\n<p>To create the <em>bundle.js</em> file with browserify, run:</p>\n<pre><code>browserify draw.js &gt; bundle.js</code></pre><p>Or, if you want a smaller file:</p>\n<pre><code>browserify draw.js| uglifyjs &gt; bundle.js</code></pre><p>Of course, you will have to install all the dependencies, browserify and uglify first:</p>\n<pre><code>npm install d3-composite-projections d3-geo d3-request d3-selection d3-transition topojson</code></pre><h2 id=\"canvas-with-nodejs\">Canvas with Nodejs</h2>\n<p>If you want to draw png maps from the command line, you can adapt the test scripts included in the library:</p>\n<p><pre><code>\n<span class=\"token keyword\">var</span> width <span class=\"token operator\">=</span> <span class=\"token number\">960</span><span class=\"token punctuation\">,</span>\nheight <span class=\"token operator\">=</span> <span class=\"token number\">500</span><span class=\"token punctuation\">,</span>\nprojectionName <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\ntopojsonName <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\nlayerName <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\nprojectionSymbol <span class=\"token operator\">=</span> <span class=\"token string\">\"geo\"</span> <span class=\"token operator\">+</span> projectionName<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">toUpperCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> projectionName<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^[a-z0-9]+$</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">i</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>projectionName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">var</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fs\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\ntopojson <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"topojson\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\nCanvas <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"canvas\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\nd3_geo <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"d3-geo\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\nd3_composite <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"d3-composite-projections\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> canvas <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Canvas</span><span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\ncontext <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2d\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> data <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span>topojsonName<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>#<span class=\"token number\">39</span><span class=\"token punctuation\">;</span>utf8<span class=\"token operator\">&amp;</span>#<span class=\"token number\">39</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\ngraticule <span class=\"token operator\">=</span> d3_geo<span class=\"token punctuation\">.</span><span class=\"token function\">geoGraticule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\noutline <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>type<span class=\"token operator\">:</span> <span class=\"token string\">\"Sphere\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> path <span class=\"token operator\">=</span> d3_geo<span class=\"token punctuation\">.</span><span class=\"token function\">geoPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">projection</span><span class=\"token punctuation\">(</span>d3_composite<span class=\"token operator\">&lt;</span>a href<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token operator\">></span>projectionSymbol<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>a<span class=\"token operator\">></span><span class=\"token punctuation\">.</span><span class=\"token function\">precision</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">context</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\ncontext<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">\"#fff\"</span><span class=\"token punctuation\">;</span>\ncontext<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> width<span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncontext<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\ncontext<span class=\"token punctuation\">.</span><span class=\"token function\">beginPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">path</span><span class=\"token punctuation\">(</span>topojson<span class=\"token punctuation\">.</span><span class=\"token function\">feature</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">[</span>layerName<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncontext<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">\"#aca\"</span><span class=\"token punctuation\">;</span>\ncontext<span class=\"token punctuation\">.</span>strokeStyle <span class=\"token operator\">=</span> <span class=\"token string\">\"#000\"</span><span class=\"token punctuation\">;</span>\ncontext<span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncontext<span class=\"token punctuation\">.</span><span class=\"token function\">stroke</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\ncontext<span class=\"token punctuation\">.</span><span class=\"token function\">beginPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">path</span><span class=\"token punctuation\">(</span><span class=\"token function\">graticule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncontext<span class=\"token punctuation\">.</span>strokeStyle <span class=\"token operator\">=</span> <span class=\"token string\">\"rgba(119,119,119,0.5)\"</span><span class=\"token punctuation\">;</span>\ncontext<span class=\"token punctuation\">.</span><span class=\"token function\">stroke</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\ncontext<span class=\"token punctuation\">.</span><span class=\"token function\">restore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\ncontext<span class=\"token punctuation\">.</span><span class=\"token function\">beginPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">path</span><span class=\"token punctuation\">(</span>outline<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncontext<span class=\"token punctuation\">.</span>strokeStyle <span class=\"token operator\">=</span> <span class=\"token string\">\"#00F\"</span><span class=\"token punctuation\">;</span>\ncontext<span class=\"token punctuation\">.</span><span class=\"token function\">stroke</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\ncontext<span class=\"token punctuation\">.</span><span class=\"token function\">beginPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncontext<span class=\"token punctuation\">.</span>strokeStyle <span class=\"token operator\">=</span> <span class=\"token string\">\"#F00\"</span><span class=\"token punctuation\">;</span>\nd3_composite<span class=\"token operator\">&lt;</span>a href<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token operator\">></span>projectionSymbol<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>a<span class=\"token operator\">></span><span class=\"token punctuation\">.</span><span class=\"token function\">drawCompositionBorders</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncontext<span class=\"token punctuation\">.</span><span class=\"token function\">stroke</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\ncanvas<span class=\"token punctuation\">.</span><span class=\"token function\">pngStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">.</span><span class=\"token function\">createWriteStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"./\"</span> <span class=\"token operator\">+</span> projectionName <span class=\"token operator\">+</span> <span class=\"token string\">\".png\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></p>\n<ul>\n<li>The script takes three arguments:<ol>\n<li>The projection name i.e. conicConformalPortugal</li>\n<li>The topojson name i.e. world-50m.json</li>\n<li>The layer name i.e. world</li>\n</ol>\n</li>\n<li>Note that the method <em>drawCompositionBorders</em> has to be used instead of <em>getCompositionBorders</em>, since <em>getCompositionBorders</em> returns a string as needed in SVG, which it&#39;s impossible to draw using Canvas with node, since the object <em>Canvas2D</em> is not always available.</li>\n</ul>\n<p>Install the dependencies with:</p>\n<pre><code>npm install topojson canvas d3-geo d3-composite-projections</code></pre><p>and run it like:</p>\n<pre><code>node test.js conicConformalSpain provincias.json provincias d3-geo</code></pre>","tags":["projections","npm","nodejs"],"date":"2016-10-03T00:00:00.000Z"}