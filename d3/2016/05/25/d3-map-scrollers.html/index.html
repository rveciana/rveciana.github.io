<!DOCTYPE html>
<html lang="en">
	<head>
		<!-- Global site tag (gtag.js) - Google Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-36383259-2"></script>
		<script>
		  window.dataLayer = window.dataLayer || [];
		  function gtag(){dataLayer.push(arguments);}
		  gtag('js', new Date());
		
		  gtag('config', 'UA-36383259-2');
		</script>
		
		<meta charset="utf-8" />
		<link rel="icon" href="/favicon.ico" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="manifest" href="/manifest.json" />
		<meta name="theme-color" content="#cdffcd">
		<!-- HTML Meta Tags -->
		<title>GeoExamples - Roger Veciana</title>
		<meta
			name="description"
			content="I am a software developer and meteorologist who likes mapping. I put here the things I learn on my free time."
		/>
		<!-- Google / Search Engine Tags -->
		<meta itemprop="name" content=">GeoExamples - Roger Veciana" />
		<meta
			itemprop="description"
			content="I am a software developer and meteorologist who likes mapping. I put here the things I learn on my free time."
		/>
		<meta itemprop="image" content="https://geoexamples.com/siteImage.png" />
		<!-- Facebook Meta Tags -->
		<meta property="og:url" content="https://geoexamples.com" />
		<meta property="og:type" content="website" />
		<meta property="og:title" content="GeoExamples - Roger Veciana" />
		<meta
			property="og:description"
			content="I am a software developer and meteorologist who likes mapping. I put here the things I learn on my free time."
		/>
		<meta property="og:image" content="https://geoexamples.com/siteImage.png" />
		<!-- Twitter Meta Tags -->
		<meta name="twitter:card" content="summary" />
		<meta name="twitter:title" content="GeoExamples - Roger Veciana" />
		<meta name="twitter:description"
		  content="I am a software developer and meteorologist who likes mapping. I put here the things I learn on my free time." />
		<meta name="twitter:image" content="https://geoexamples.com/siteImage.png" />
		



<link rel="modulepreload" href="/./staticApp/start-44631b0b.js">
			<link rel="modulepreload" href="/./staticApp/chunks/vendor-ff3d1764.js">
			<link rel="modulepreload" href="/./staticApp/chunks/config-b3bde751.js">
			<link rel="modulepreload" href="/./staticApp/pages\[category]\[year]\[month]\[date]\[slug].svelte-a77716b3.js">
			<link rel="stylesheet" href="/./staticApp/assets/start-34a290f9.css">


		<script type="module">
			import { start } from "/./staticApp/start-44631b0b.js";
			start({
				target: document.querySelector("#svelte"),
				paths: {"base":"","assets":"/."},
				session: {},
				host: location.host,
				route: true,
				hydrate: {
					status: 200,
					error: null,
					nodes: [
						import("/./staticApp/pages\\[category]\\[year]\\[month]\\[date]\\[slug].svelte-a77716b3.js")
					],
					page: {
						host: location.host, // TODO this is redundant
						path: "/d3/2016/05/25/d3-map-scrollers.html",
						query: new URLSearchParams(""),
						params: {"category":"d3","year":"2016","month":"05","date":"25","slug":"d3-map-scrollers.html"}
					}
				}
			});
		</script>
	</head>
	<body>
		<div id="svelte">


<header class="site-header"><div class="wrapper"><a class="site-title" href="/">GeoExamples - Roger Veciana</a>

<nav class="site-nav"><div href="#" class="menu-icon"><svg viewBox="0 0 18 15"><path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"></path><path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"></path><path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"></path></svg></div>

	<div class="trigger"><a class="page-link" href="/about">About</a><a class="page-link" href="/blog">Blog</a><a class="page-link" href="/projects">Projects</a></div></nav></div></header>

<main class="page-content"><div class="wrapper"><div class="post"><header class="post-header"><h1 class="post-title">D3 map scrollers</h1>
<p class="post-meta">May 25, 2016</p></header>

	<article class="post-content"><p>Scrollers are a cool way to show data visualizations in general, and maps where things happen in particular. I&#39;ve been wanting to do one since I watched <a href="http://www.nytimes.com/newsgraphics/2013/10/13/russia/">this Mike Bostock example</a>, and now I&#39;ve finally learned how to do it.</p>
<h2 id="the-simplest-example">The simplest example</h2>
<p>The example is taken from <a href="http://bl.ocks.org/tonyhschu/af64df46f7b5b760fc1db1260dd6ec6a">this Tony Chu&#39;s block</a>. Scroll down to see how the Hayan typhoon track:</p>
<iframe src="https://cdn.rawgit.com/rveciana/eeaa71659adbc88dc4165eaf99dcb9be/raw/4812ed4d7330335bed355a082742367b484b3048/index.html" width="700" height="400" scrolling="yes"></iframe>

<p>The code is quite simple. Le&#39;ts see first the css part:</p>
<p>
#container {
position: relative;
z-index: 100;
height: 100vh;
overflow: scroll;
}
#sticky {
position: absolute;
top: 5vh;
right: 0;
width: 48%;
z-index: 50;
}
.panel {
width: 100%;
padding-left: 20px;
padding-top: 25vh;
padding-bottom: 25vh;
}
.panel p {padding-right: 50%;}
.panel:first-child {padding-top: 5vh;}
.panel:last-child {padding-bottom: 45vh;}
</p>
<ul>
<li><em>container</em> is will be the place where both the text will be placed. Note that we are using <a href="http://www.w3schools.com/cssref/css_units.asp">vh units</a>, which are in % of the viewport</li>
<li><em>sticky</em> is the place where the map will be placed. As its name indicates, it won&#39;t move. Note that is placed at the right part of the screen with the <em>right</em> tag.</li>
<li>The <em>divs</em> with the class <em>panel</em> will have the content that scrolls. Note the <em>padding-top</em> and <em>padding-bottom</em> that are with vh units. This will be useful to maintain a separation when texts are short. Two secions with a single word would still make a nice visualization. The <em>padding-right</em> asserts that the content will be in two columns.</li>
</ul>
<p>The html would be like this, but including the text:
<pre><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sticky<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>panel<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      
Your text here...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
</code></pre>

<ul>
<li>Note the <em>content</em> node. It will be used to calculate the vertical length of all the sections (panel classed divs)</li>
</ul>
<p>Let&#39;s see now the relevant JavaScript parts:

var WIDTH = 0.9 _ window.innerWidth / 2;
var HEIGHT = 0.9 _ window.innerHeight;

var svg = d3.select("#sticky").append("svg")
.attr(&#39;width&#39;, WIDTH)
.attr(&#39;height&#39;, HEIGHT);

var body = d3.select(&#39;body&#39;).node();
var container = d3.select(&#39;#container&#39;);
var content = d3.select(&#39;#content&#39;);

var SCROLL_LENGTH = content.node().getBoundingClientRect().height - HEIGHT;
</p>
<ul>
<li>The initial svg map width and height of the visible window are taken from the <em>window</em> object properties. The map will be half of the window width and all the height</li>
<li><em>SCROLL_LENGTH</em> is the amount of pixels you can scroll down. Since some content is already shown, it has to be calculated as the whole content height minus the viewport height which is already visible</li>
</ul>
<p>
var hayanPathScale = d3.scale.linear()
.domain([0, SCROLL_LENGTH])
.range([0, haiyanPath.node().getTotalLength()])
.clamp(true);
</p>
<ul>
<li>The map is created as in <a href="http://bl.ocks.org/rveciana/8464690">this example</a>. The main change is that the animation won&#39;t be an interval but will be controlled by the scroller</li>
<li>The scale relates which portion of the path must be drawn for each scrolled pixel. So the domain will be the scroll length (we can move from 0 to SCROLL_LENGTH pixels down the page), and the range is the path length (we can draw from 0 to all the path pixels)</li>
</ul>
<p>
container
.on("scroll.scroller", function() {
newScrollTop = container.node().scrollTop
});

var setDimensions = function() {
...
}

var render = function() {
if (scrollTop !== newScrollTop) {
scrollTop = newScrollTop
...<br>}

window.requestAnimationFrame(render)
}
window.requestAnimationFrame(render)

window.onresize = setDimensions
</p>
<p>Those are the functinos that controll the window resizing and scroll:</p>
<ul>
<li>When the <em>scroll.scroll</em> event happens in the <em>container</em> div, a new <em>newScrollTop</em> variable value is calculated</li>
<li><em>setDimensions</em> holds all what has to be done when the window is resized. The map has to look the same, so the scale must be changed, the size of the svg too, etc.</li>
<li><em>render</em> is the function that acts when the scroll is moved. The render is only done when <em>newScrollTop</em> changes, so we are not rendering the same all the time if the scroll doesn&#39;t change. Note that at the end of the function, the function is called again using <a href="https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame">window.requestAnimationFrame(render)</a>. The function is called too when the script is first loaded.</li>
<li><em>setDimensions</em> is fired with the <em>window.onresize</em> event</li>
</ul>
<p>With these functions we can control a simple scroller.</p>
<p>How does the <em>render</em> function look like:

if (scrollTop !== newScrollTop) {
scrollTop = newScrollTop

haiyanPath
.style(&#39;stroke-dashoffset&#39;, function(d) {
return haiyanPath.node().getTotalLength() - hayanPathScale(scrollTop) + &#39;px&#39;;
});

}

window.requestAnimationFrame(render)
</p>
<ul>
<li>After checking if the newScrollTop has changed, the only thing to change is the <em>stroke-dashoffset</em> attribute. Take a look at <a href="http://www.alolo.co/blog/2013/11/14/progressively-draw-svg-paths-with-d3js">this web page</a> to see how does it work</li>
</ul>
<p>Now, let&#39;s see how the <em>setDimensions</em> function work:</p>
<p>
WIDTH = window.innerWidth / 2;
HEIGHT = window.innerHeight;
SCROLL_LENGTH = content.node().getBoundingClientRect().height - HEIGHT;

projection.scale(6*(WIDTH + 1) / 2 / Math.PI)
.translate([WIDTH / 2, HEIGHT / 2]);

path.projection(projection);

landPath.attr("d", path);
countriesPath.attr("d", path);
graticulePath.attr("d", path);

haiyanPath
.attr("d",pathLine(track));

hayanPathScale
.domain([0, SCROLL_LENGTH])
.range([0, haiyanPath.node().getTotalLength()]);

haiyanPath
.style(&#39;stroke-dasharray&#39;, function(d) {
var l = d3.select(this).node().getTotalLength();
return l + &#39;px, &#39; + l + &#39;px&#39;;
})
.style(&#39;stroke-dashoffset&#39;, function(d) {
return d3.select(this).node().getTotalLength() - hayanPathScale(scrollTop) + &#39;px&#39;;
});
</p>
<ul>
<li>The new WIDTH, HEIGHT and SCROLL_LENGTH valeus are calculated</li>
<li>The projection must be changed to adapt its scale to the new dimensions. Then the <em>path</em> function must have the new projection</li>
<li>The map layers must be redrawn using the new path function, by changing the <em>d</em> attribute</li>
<li>The Hayan path is a bit more tricky, since not all the changes can be done at once<ul>
<li>First, the new path is set. This will make it with a changed length.</li>
<li>The scale has to be changed, so it takes the new path length. Bothe the domain and range are affected, since the scroll size changed too</li>
<li>Finally, the <em>stroke-dasharray</em> and <em>stroke-dashoffset</em> have to change too, with the new scroll and length values</li>
</ul>
</li>
</ul>
<h2 id="links">Links</h2>
<ul>
<li><p><a href="http://www.nytimes.com/newsgraphics/2013/10/13/russia/">Mike Bostock&#39;s visualization I liked in first place</a></p>
</li>
<li><p><a href="http://bl.ocks.org/tonyhschu/af64df46f7b5b760fc1db1260dd6ec6a">Tony Chu&#39;s block where I took the basic code from</a></p>
</li>
<li><p><a href="http://www.r2d3.us/visual-intro-to-machine-learning-part-1/">A nice multi-section scroller</a></p>
</li>
<li><p><a href="http://vallandingham.me/scroller.html">So You Want to Build A Scroller</a>, another good tutorial by Jim Vallandingham</p>
</li>
<li><p><a href="http://bl.ocks.org/rveciana/8463775">How to create the Hayan Typhoon map</a></p>
</li>
<li><p><a href="http://bl.ocks.org/rveciana/8464690">Hayan animated path original example</a></p>
</li>
<li><p><a href="http://bl.ocks.org/rveciana/eeaa71659adbc88dc4165eaf99dcb9be">The block for the first example</a></p>
</li>
<li><p><a href="http://www.alolo.co/blog/2013/11/14/progressively-draw-svg-paths-with-d3js">Progressively drawing SVG paths with D3.js</a></p>
</li>
<li><p>Another animated paths example: <a href="http://bl.ocks.org/rveciana/7664109">Animated arabic kufic calligraphy with D3</a></p>
</li>
</ul>
</article></div></div></main>
<footer class="site-footer"><div class="wrapper"><div class="footer-col-wrapper"><div class="footer-col  footer-col-1"><ul class="contact-list"><li>GeoExamples - Roger Veciana</li></ul></div>

	<div class="footer-col  footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/rveciana"><span class="icon  icon--github"><svg viewBox="0 0 16 16"><path fill="#89b889" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"></path></svg></span>

						<span class="username">rveciana</span></a></li>

			<li><a href="https://twitter.com/rveciana"><span class="icon  icon--twitter"><svg viewBox="0 0 16 16"><path fill="#89b889" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                    c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"></path></svg></span>

						<span class="username">rveciana</span></a></li>
			<li><a href="https://www.linkedin.com/in/rogerveciana"><span class="icon  icon--twitter"><svg width="16" height="15.28958"><path d="M 0,1.77606 Q 0,1.00386 0.54054,0.50193 1.08108,0 1.94595,0 2.79537,0 3.32047,0.49421 3.86101,1.00386 3.86101,1.8224 q 0,0.74131 -0.5251,1.23552 -0.54054,0.50965 -1.42085,0.50965 l -0.0154,0 q -0.84942,0 -1.37452,-0.50965 Q 4e-5,2.54827 4e-5,1.77606 Z m 0.20078,13.51352 0,-10.3166 3.42857,0 0,10.3166 -3.42857,0 z m 5.32818,0 3.42857,0 0,-5.76062 q 0,-0.54054 0.12355,-0.83398 0.21622,-0.52509 0.65638,-0.88803 0.44015,-0.36293 1.10424,-0.36293 1.72973,0 1.72973,2.33205 l 0,5.51351 3.42857,0 0,-5.91506 Q 16,7.08881 14.91892,5.90734 13.83784,4.72587 12.06178,4.72587 q -1.99228,0 -3.10425,1.71429 l 0,0.0309 -0.0154,0 0.0154,-0.0309 0,-1.46718 -3.42857,0 q 0.0309,0.49421 0.0309,3.07336 0,2.57915 -0.0309,7.24324 z"></path></svg></span>

						<span class="username">rogerveciana</span></a></li></ul></div>

	<div class="footer-col  footer-col-3"><p class="text">I am a software developer and meteorologist who likes mapping. I put here the things I learn on my free time.</p>
		<p class="text">Roger Veciana i Rovira</p></div></div></div></footer>



	<script type="svelte-data" url="/summary_pages.json">{"status":200,"statusText":"","headers":{"content-type":"application/json"},"body":"[{\"title\":\"About\",\"permalink\":\"\u002Fabout\",\"excerpt\":\"\u003Cp\u003E{{ site.author.name }}\u003C\u002Fp\u003E\"},{\"title\":\"Projects\",\"permalink\":\"\u002Fprojects\",\"excerpt\":\"\u003Cp\u003ESome of my personal projects:\u003C\u002Fp\u003E\"},{\"title\":\"CV\",\"permalink\":\"\u002Fcv\",\"excerpt\":\"\u003Ch2 id=\\\"jobs\\\"\u003EJobs\u003C\u002Fh2\u003E\",\"avoidMainMenu\":true}]"}</script>

	<script type="svelte-data" url="d3-map-scrollers.html.json">{"status":200,"statusText":"","headers":{"content-type":"application/json"},"body":"{\"title\":\"D3 map scrollers\",\"contents\":\"\u003Cp\u003EScrollers are a cool way to show data visualizations in general, and maps where things happen in particular. I&#39;ve been wanting to do one since I watched \u003Ca href=\\\"http:\u002F\u002Fwww.nytimes.com\u002Fnewsgraphics\u002F2013\u002F10\u002F13\u002Frussia\u002F\\\"\u003Ethis Mike Bostock example\u003C\u002Fa\u003E, and now I&#39;ve finally learned how to do it.\u003C\u002Fp\u003E\\n\u003Ch2 id=\\\"the-simplest-example\\\"\u003EThe simplest example\u003C\u002Fh2\u003E\\n\u003Cp\u003EThe example is taken from \u003Ca href=\\\"http:\u002F\u002Fbl.ocks.org\u002Ftonyhschu\u002Faf64df46f7b5b760fc1db1260dd6ec6a\\\"\u003Ethis Tony Chu&#39;s block\u003C\u002Fa\u003E. Scroll down to see how the Hayan typhoon track:\u003C\u002Fp\u003E\\n\u003Ciframe src=\\\"https:\u002F\u002Fcdn.rawgit.com\u002Frveciana\u002Feeaa71659adbc88dc4165eaf99dcb9be\u002Fraw\u002F4812ed4d7330335bed355a082742367b484b3048\u002Findex.html\\\" width=\\\"700\\\" height=\\\"400\\\" scrolling=\\\"yes\\\"\u003E\u003C\u002Fiframe\u003E\\n\\n\u003Cp\u003EThe code is quite simple. Le&#39;ts see first the css part:\u003C\u002Fp\u003E\\n\u003Cp\u003E\\n#container {\\nposition: relative;\\nz-index: 100;\\nheight: 100vh;\\noverflow: scroll;\\n}\\n#sticky {\\nposition: absolute;\\ntop: 5vh;\\nright: 0;\\nwidth: 48%;\\nz-index: 50;\\n}\\n.panel {\\nwidth: 100%;\\npadding-left: 20px;\\npadding-top: 25vh;\\npadding-bottom: 25vh;\\n}\\n.panel p {padding-right: 50%;}\\n.panel:first-child {padding-top: 5vh;}\\n.panel:last-child {padding-bottom: 45vh;}\\n\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003E\u003Cem\u003Econtainer\u003C\u002Fem\u003E is will be the place where both the text will be placed. Note that we are using \u003Ca href=\\\"http:\u002F\u002Fwww.w3schools.com\u002Fcssref\u002Fcss_units.asp\\\"\u003Evh units\u003C\u002Fa\u003E, which are in % of the viewport\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Cem\u003Esticky\u003C\u002Fem\u003E is the place where the map will be placed. As its name indicates, it won&#39;t move. Note that is placed at the right part of the screen with the \u003Cem\u003Eright\u003C\u002Fem\u003E tag.\u003C\u002Fli\u003E\\n\u003Cli\u003EThe \u003Cem\u003Edivs\u003C\u002Fem\u003E with the class \u003Cem\u003Epanel\u003C\u002Fem\u003E will have the content that scrolls. Note the \u003Cem\u003Epadding-top\u003C\u002Fem\u003E and \u003Cem\u003Epadding-bottom\u003C\u002Fem\u003E that are with vh units. This will be useful to maintain a separation when texts are short. Two secions with a single word would still make a nice visualization. The \u003Cem\u003Epadding-right\u003C\u002Fem\u003E asserts that the content will be in two columns.\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Cp\u003EThe html would be like this, but including the text:\\n\u003Cpre\u003E\u003Ccode\u003E\\n\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ediv\u003C\u002Fspan\u003E \u003Cspan class=\\\"token attr-name\\\"\u003Eid\u003C\u002Fspan\u003E\u003Cspan class=\\\"token attr-value\\\"\u003E\u003Cspan class=\\\"token punctuation attr-equals\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\\\"\u003C\u002Fspan\u003Esticky\u003Cspan class=\\\"token punctuation\\\"\u003E\\\"\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u002F\u003C\u002Fspan\u003Ediv\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ediv\u003C\u002Fspan\u003E \u003Cspan class=\\\"token attr-name\\\"\u003Eid\u003C\u002Fspan\u003E\u003Cspan class=\\\"token attr-value\\\"\u003E\u003Cspan class=\\\"token punctuation attr-equals\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\\\"\u003C\u002Fspan\u003Econtainer\u003Cspan class=\\\"token punctuation\\\"\u003E\\\"\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ediv\u003C\u002Fspan\u003E \u003Cspan class=\\\"token attr-name\\\"\u003Eid\u003C\u002Fspan\u003E\u003Cspan class=\\\"token attr-value\\\"\u003E\u003Cspan class=\\\"token punctuation attr-equals\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\\\"\u003C\u002Fspan\u003Econtent\u003Cspan class=\\\"token punctuation\\\"\u003E\\\"\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ediv\u003C\u002Fspan\u003E \u003Cspan class=\\\"token attr-name\\\"\u003Eclass\u003C\u002Fspan\u003E\u003Cspan class=\\\"token attr-value\\\"\u003E\u003Cspan class=\\\"token punctuation attr-equals\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\\\"\u003C\u002Fspan\u003Epanel\u003Cspan class=\\\"token punctuation\\\"\u003E\\\"\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\\n      \\nYour text here...\\n    \u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u002F\u003C\u002Fspan\u003Ediv\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u002F\u003C\u002Fspan\u003Ediv\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\\n\u003Cul\u003E\\n\u003Cli\u003ENote the \u003Cem\u003Econtent\u003C\u002Fem\u003E node. It will be used to calculate the vertical length of all the sections (panel classed divs)\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Cp\u003ELet&#39;s see now the relevant JavaScript parts:\\n\\nvar WIDTH = 0.9 _ window.innerWidth \u002F 2;\\nvar HEIGHT = 0.9 _ window.innerHeight;\\n\\nvar svg = d3.select(\\\"#sticky\\\").append(\\\"svg\\\")\\n.attr(&#39;width&#39;, WIDTH)\\n.attr(&#39;height&#39;, HEIGHT);\\n\\nvar body = d3.select(&#39;body&#39;).node();\\nvar container = d3.select(&#39;#container&#39;);\\nvar content = d3.select(&#39;#content&#39;);\\n\\nvar SCROLL_LENGTH = content.node().getBoundingClientRect().height - HEIGHT;\\n\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003EThe initial svg map width and height of the visible window are taken from the \u003Cem\u003Ewindow\u003C\u002Fem\u003E object properties. The map will be half of the window width and all the height\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Cem\u003ESCROLL_LENGTH\u003C\u002Fem\u003E is the amount of pixels you can scroll down. Since some content is already shown, it has to be calculated as the whole content height minus the viewport height which is already visible\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Cp\u003E\\nvar hayanPathScale = d3.scale.linear()\\n.domain([0, SCROLL_LENGTH])\\n.range([0, haiyanPath.node().getTotalLength()])\\n.clamp(true);\\n\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003EThe map is created as in \u003Ca href=\\\"http:\u002F\u002Fbl.ocks.org\u002Frveciana\u002F8464690\\\"\u003Ethis example\u003C\u002Fa\u003E. The main change is that the animation won&#39;t be an interval but will be controlled by the scroller\u003C\u002Fli\u003E\\n\u003Cli\u003EThe scale relates which portion of the path must be drawn for each scrolled pixel. So the domain will be the scroll length (we can move from 0 to SCROLL_LENGTH pixels down the page), and the range is the path length (we can draw from 0 to all the path pixels)\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Cp\u003E\\ncontainer\\n.on(\\\"scroll.scroller\\\", function() {\\nnewScrollTop = container.node().scrollTop\\n});\\n\\nvar setDimensions = function() {\\n...\\n}\\n\\nvar render = function() {\\nif (scrollTop !== newScrollTop) {\\nscrollTop = newScrollTop\\n...\u003Cbr\u003E}\\n\\nwindow.requestAnimationFrame(render)\\n}\\nwindow.requestAnimationFrame(render)\\n\\nwindow.onresize = setDimensions\\n\u003C\u002Fp\u003E\\n\u003Cp\u003EThose are the functinos that controll the window resizing and scroll:\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003EWhen the \u003Cem\u003Escroll.scroll\u003C\u002Fem\u003E event happens in the \u003Cem\u003Econtainer\u003C\u002Fem\u003E div, a new \u003Cem\u003EnewScrollTop\u003C\u002Fem\u003E variable value is calculated\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Cem\u003EsetDimensions\u003C\u002Fem\u003E holds all what has to be done when the window is resized. The map has to look the same, so the scale must be changed, the size of the svg too, etc.\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Cem\u003Erender\u003C\u002Fem\u003E is the function that acts when the scroll is moved. The render is only done when \u003Cem\u003EnewScrollTop\u003C\u002Fem\u003E changes, so we are not rendering the same all the time if the scroll doesn&#39;t change. Note that at the end of the function, the function is called again using \u003Ca href=\\\"https:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FWeb\u002FAPI\u002Fwindow\u002FrequestAnimationFrame\\\"\u003Ewindow.requestAnimationFrame(render)\u003C\u002Fa\u003E. The function is called too when the script is first loaded.\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Cem\u003EsetDimensions\u003C\u002Fem\u003E is fired with the \u003Cem\u003Ewindow.onresize\u003C\u002Fem\u003E event\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Cp\u003EWith these functions we can control a simple scroller.\u003C\u002Fp\u003E\\n\u003Cp\u003EHow does the \u003Cem\u003Erender\u003C\u002Fem\u003E function look like:\\n\\nif (scrollTop !== newScrollTop) {\\nscrollTop = newScrollTop\\n\\nhaiyanPath\\n.style(&#39;stroke-dashoffset&#39;, function(d) {\\nreturn haiyanPath.node().getTotalLength() - hayanPathScale(scrollTop) + &#39;px&#39;;\\n});\\n\\n}\\n\\nwindow.requestAnimationFrame(render)\\n\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003EAfter checking if the newScrollTop has changed, the only thing to change is the \u003Cem\u003Estroke-dashoffset\u003C\u002Fem\u003E attribute. Take a look at \u003Ca href=\\\"http:\u002F\u002Fwww.alolo.co\u002Fblog\u002F2013\u002F11\u002F14\u002Fprogressively-draw-svg-paths-with-d3js\\\"\u003Ethis web page\u003C\u002Fa\u003E to see how does it work\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Cp\u003ENow, let&#39;s see how the \u003Cem\u003EsetDimensions\u003C\u002Fem\u003E function work:\u003C\u002Fp\u003E\\n\u003Cp\u003E\\nWIDTH = window.innerWidth \u002F 2;\\nHEIGHT = window.innerHeight;\\nSCROLL_LENGTH = content.node().getBoundingClientRect().height - HEIGHT;\\n\\nprojection.scale(6*(WIDTH + 1) \u002F 2 \u002F Math.PI)\\n.translate([WIDTH \u002F 2, HEIGHT \u002F 2]);\\n\\npath.projection(projection);\\n\\nlandPath.attr(\\\"d\\\", path);\\ncountriesPath.attr(\\\"d\\\", path);\\ngraticulePath.attr(\\\"d\\\", path);\\n\\nhaiyanPath\\n.attr(\\\"d\\\",pathLine(track));\\n\\nhayanPathScale\\n.domain([0, SCROLL_LENGTH])\\n.range([0, haiyanPath.node().getTotalLength()]);\\n\\nhaiyanPath\\n.style(&#39;stroke-dasharray&#39;, function(d) {\\nvar l = d3.select(this).node().getTotalLength();\\nreturn l + &#39;px, &#39; + l + &#39;px&#39;;\\n})\\n.style(&#39;stroke-dashoffset&#39;, function(d) {\\nreturn d3.select(this).node().getTotalLength() - hayanPathScale(scrollTop) + &#39;px&#39;;\\n});\\n\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003EThe new WIDTH, HEIGHT and SCROLL_LENGTH valeus are calculated\u003C\u002Fli\u003E\\n\u003Cli\u003EThe projection must be changed to adapt its scale to the new dimensions. Then the \u003Cem\u003Epath\u003C\u002Fem\u003E function must have the new projection\u003C\u002Fli\u003E\\n\u003Cli\u003EThe map layers must be redrawn using the new path function, by changing the \u003Cem\u003Ed\u003C\u002Fem\u003E attribute\u003C\u002Fli\u003E\\n\u003Cli\u003EThe Hayan path is a bit more tricky, since not all the changes can be done at once\u003Cul\u003E\\n\u003Cli\u003EFirst, the new path is set. This will make it with a changed length.\u003C\u002Fli\u003E\\n\u003Cli\u003EThe scale has to be changed, so it takes the new path length. Bothe the domain and range are affected, since the scroll size changed too\u003C\u002Fli\u003E\\n\u003Cli\u003EFinally, the \u003Cem\u003Estroke-dasharray\u003C\u002Fem\u003E and \u003Cem\u003Estroke-dashoffset\u003C\u002Fem\u003E have to change too, with the new scroll and length values\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Ch2 id=\\\"links\\\"\u003ELinks\u003C\u002Fh2\u003E\\n\u003Cul\u003E\\n\u003Cli\u003E\u003Cp\u003E\u003Ca href=\\\"http:\u002F\u002Fwww.nytimes.com\u002Fnewsgraphics\u002F2013\u002F10\u002F13\u002Frussia\u002F\\\"\u003EMike Bostock&#39;s visualization I liked in first place\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Cp\u003E\u003Ca href=\\\"http:\u002F\u002Fbl.ocks.org\u002Ftonyhschu\u002Faf64df46f7b5b760fc1db1260dd6ec6a\\\"\u003ETony Chu&#39;s block where I took the basic code from\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Cp\u003E\u003Ca href=\\\"http:\u002F\u002Fwww.r2d3.us\u002Fvisual-intro-to-machine-learning-part-1\u002F\\\"\u003EA nice multi-section scroller\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Cp\u003E\u003Ca href=\\\"http:\u002F\u002Fvallandingham.me\u002Fscroller.html\\\"\u003ESo You Want to Build A Scroller\u003C\u002Fa\u003E, another good tutorial by Jim Vallandingham\u003C\u002Fp\u003E\\n\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Cp\u003E\u003Ca href=\\\"http:\u002F\u002Fbl.ocks.org\u002Frveciana\u002F8463775\\\"\u003EHow to create the Hayan Typhoon map\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Cp\u003E\u003Ca href=\\\"http:\u002F\u002Fbl.ocks.org\u002Frveciana\u002F8464690\\\"\u003EHayan animated path original example\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Cp\u003E\u003Ca href=\\\"http:\u002F\u002Fbl.ocks.org\u002Frveciana\u002Feeaa71659adbc88dc4165eaf99dcb9be\\\"\u003EThe block for the first example\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Cp\u003E\u003Ca href=\\\"http:\u002F\u002Fwww.alolo.co\u002Fblog\u002F2013\u002F11\u002F14\u002Fprogressively-draw-svg-paths-with-d3js\\\"\u003EProgressively drawing SVG paths with D3.js\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Cp\u003EAnother animated paths example: \u003Ca href=\\\"http:\u002F\u002Fbl.ocks.org\u002Frveciana\u002F7664109\\\"\u003EAnimated arabic kufic calligraphy with D3\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\",\"tags\":[\"scroll\"],\"date\":\"2016-05-25T00:00:00.000Z\"}"}</script>
</div>
	</body>
</html>
