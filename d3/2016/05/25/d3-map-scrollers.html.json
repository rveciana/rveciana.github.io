{"title":"D3 map scrollers","contents":"<p>Scrollers are a cool way to show data visualizations in general, and maps where things happen in particular. I&#39;ve been wanting to do one since I watched <a href=\"http://www.nytimes.com/newsgraphics/2013/10/13/russia/\">this Mike Bostock example</a>, and now I&#39;ve finally learned how to do it.</p>\n<h2 id=\"the-simplest-example\">The simplest example</h2>\n<p>The example is taken from <a href=\"http://bl.ocks.org/tonyhschu/af64df46f7b5b760fc1db1260dd6ec6a\">this Tony Chu&#39;s block</a>. Scroll down to see how the Hayan typhoon track:</p>\n<iframe src=\"https://cdn.rawgit.com/rveciana/eeaa71659adbc88dc4165eaf99dcb9be/raw/4812ed4d7330335bed355a082742367b484b3048/index.html\" width=\"700\" height=\"400\" scrolling=\"yes\"></iframe>\n\n<p>The code is quite simple. Le&#39;ts see first the css part:</p>\n<p><pre><code>\n#container <span class=\"token punctuation\">{</span>\nposition<span class=\"token operator\">:</span> relative<span class=\"token punctuation\">;</span>\nz<span class=\"token operator\">-</span>index<span class=\"token operator\">:</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\nheight<span class=\"token operator\">:</span> <span class=\"token number\">100</span>vh<span class=\"token punctuation\">;</span>\noverflow<span class=\"token operator\">:</span> scroll<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n#sticky <span class=\"token punctuation\">{</span>\nposition<span class=\"token operator\">:</span> absolute<span class=\"token punctuation\">;</span>\ntop<span class=\"token operator\">:</span> <span class=\"token number\">5</span>vh<span class=\"token punctuation\">;</span>\nright<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\nwidth<span class=\"token operator\">:</span> <span class=\"token number\">48</span><span class=\"token operator\">%</span><span class=\"token punctuation\">;</span>\nz<span class=\"token operator\">-</span>index<span class=\"token operator\">:</span> <span class=\"token number\">50</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">.</span>panel <span class=\"token punctuation\">{</span>\nwidth<span class=\"token operator\">:</span> <span class=\"token number\">100</span><span class=\"token operator\">%</span><span class=\"token punctuation\">;</span>\npadding<span class=\"token operator\">-</span>left<span class=\"token operator\">:</span> <span class=\"token number\">20</span>px<span class=\"token punctuation\">;</span>\npadding<span class=\"token operator\">-</span>top<span class=\"token operator\">:</span> <span class=\"token number\">25</span>vh<span class=\"token punctuation\">;</span>\npadding<span class=\"token operator\">-</span>bottom<span class=\"token operator\">:</span> <span class=\"token number\">25</span>vh<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">.</span>panel p <span class=\"token punctuation\">{</span>padding<span class=\"token operator\">-</span>right<span class=\"token operator\">:</span> <span class=\"token number\">50</span><span class=\"token operator\">%</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">.</span>panel<span class=\"token operator\">:</span>first<span class=\"token operator\">-</span>child <span class=\"token punctuation\">{</span>padding<span class=\"token operator\">-</span>top<span class=\"token operator\">:</span> <span class=\"token number\">5</span>vh<span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">.</span>panel<span class=\"token operator\">:</span>last<span class=\"token operator\">-</span>child <span class=\"token punctuation\">{</span>padding<span class=\"token operator\">-</span>bottom<span class=\"token operator\">:</span> <span class=\"token number\">45</span>vh<span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span>\n</code></pre></p>\n<ul>\n<li><em>container</em> is will be the place where both the text will be placed. Note that we are using <a href=\"http://www.w3schools.com/cssref/css_units.asp\">vh units</a>, which are in % of the viewport</li>\n<li><em>sticky</em> is the place where the map will be placed. As its name indicates, it won&#39;t move. Note that is placed at the right part of the screen with the <em>right</em> tag.</li>\n<li>The <em>divs</em> with the class <em>panel</em> will have the content that scrolls. Note the <em>padding-top</em> and <em>padding-bottom</em> that are with vh units. This will be useful to maintain a separation when texts are short. Two secions with a single word would still make a nice visualization. The <em>padding-right</em> asserts that the content will be in two columns.</li>\n</ul>\n<p>The html would be like this, but including the text:\n<pre><code>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>sticky<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>container<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>content<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>panel<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      \nYour text here...\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n</code></pre>\n\n<ul>\n<li>Note the <em>content</em> node. It will be used to calculate the vertical length of all the sections (panel classed divs)</li>\n</ul>\n<p>Let&#39;s see now the relevant JavaScript parts:\n<pre><code>\n<span class=\"token keyword\">var</span> <span class=\"token constant\">WIDTH</span> <span class=\"token operator\">=</span> <span class=\"token number\">0.9</span> _ window<span class=\"token punctuation\">.</span>innerWidth <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> <span class=\"token constant\">HEIGHT</span> <span class=\"token operator\">=</span> <span class=\"token number\">0.9</span> _ window<span class=\"token punctuation\">.</span>innerHeight<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> svg <span class=\"token operator\">=</span> d3<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#sticky\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"svg\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>#<span class=\"token number\">39</span><span class=\"token punctuation\">;</span>width<span class=\"token operator\">&amp;</span>#<span class=\"token number\">39</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">WIDTH</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>#<span class=\"token number\">39</span><span class=\"token punctuation\">;</span>height<span class=\"token operator\">&amp;</span>#<span class=\"token number\">39</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">HEIGHT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> body <span class=\"token operator\">=</span> d3<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>#<span class=\"token number\">39</span><span class=\"token punctuation\">;</span>body<span class=\"token operator\">&amp;</span>#<span class=\"token number\">39</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">node</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> container <span class=\"token operator\">=</span> d3<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>#<span class=\"token number\">39</span><span class=\"token punctuation\">;</span>#container<span class=\"token operator\">&amp;</span>#<span class=\"token number\">39</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> content <span class=\"token operator\">=</span> d3<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>#<span class=\"token number\">39</span><span class=\"token punctuation\">;</span>#content<span class=\"token operator\">&amp;</span>#<span class=\"token number\">39</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> <span class=\"token constant\">SCROLL_LENGTH</span> <span class=\"token operator\">=</span> content<span class=\"token punctuation\">.</span><span class=\"token function\">node</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBoundingClientRect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>height <span class=\"token operator\">-</span> <span class=\"token constant\">HEIGHT</span><span class=\"token punctuation\">;</span>\n</code></pre></p>\n<ul>\n<li>The initial svg map width and height of the visible window are taken from the <em>window</em> object properties. The map will be half of the window width and all the height</li>\n<li><em>SCROLL_LENGTH</em> is the amount of pixels you can scroll down. Since some content is already shown, it has to be calculated as the whole content height minus the viewport height which is already visible</li>\n</ul>\n<p><pre><code>\n<span class=\"token keyword\">var</span> hayanPathScale <span class=\"token operator\">=</span> d3<span class=\"token punctuation\">.</span>scale<span class=\"token punctuation\">.</span><span class=\"token function\">linear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">domain</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">SCROLL_LENGTH</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">range</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> haiyanPath<span class=\"token punctuation\">.</span><span class=\"token function\">node</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTotalLength</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">clamp</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></p>\n<ul>\n<li>The map is created as in <a href=\"http://bl.ocks.org/rveciana/8464690\">this example</a>. The main change is that the animation won&#39;t be an interval but will be controlled by the scroller</li>\n<li>The scale relates which portion of the path must be drawn for each scrolled pixel. So the domain will be the scroll length (we can move from 0 to SCROLL_LENGTH pixels down the page), and the range is the path length (we can draw from 0 to all the path pixels)</li>\n</ul>\n<p><pre><code>\ncontainer\n<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"scroll.scroller\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\nnewScrollTop <span class=\"token operator\">=</span> container<span class=\"token punctuation\">.</span><span class=\"token function\">node</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>scrollTop\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> <span class=\"token function-variable function\">setDimensions</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">var</span> <span class=\"token function-variable function\">render</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>scrollTop <span class=\"token operator\">!==</span> newScrollTop<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\nscrollTop <span class=\"token operator\">=</span> newScrollTop\n<span class=\"token operator\">...</span><span class=\"token operator\">&lt;</span>br<span class=\"token operator\">></span><span class=\"token punctuation\">}</span>\n\nwindow<span class=\"token punctuation\">.</span><span class=\"token function\">requestAnimationFrame</span><span class=\"token punctuation\">(</span>render<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\nwindow<span class=\"token punctuation\">.</span><span class=\"token function\">requestAnimationFrame</span><span class=\"token punctuation\">(</span>render<span class=\"token punctuation\">)</span>\n\nwindow<span class=\"token punctuation\">.</span>onresize <span class=\"token operator\">=</span> setDimensions\n</code></pre></p>\n<p>Those are the functinos that controll the window resizing and scroll:</p>\n<ul>\n<li>When the <em>scroll.scroll</em> event happens in the <em>container</em> div, a new <em>newScrollTop</em> variable value is calculated</li>\n<li><em>setDimensions</em> holds all what has to be done when the window is resized. The map has to look the same, so the scale must be changed, the size of the svg too, etc.</li>\n<li><em>render</em> is the function that acts when the scroll is moved. The render is only done when <em>newScrollTop</em> changes, so we are not rendering the same all the time if the scroll doesn&#39;t change. Note that at the end of the function, the function is called again using <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame\">window.requestAnimationFrame(render)</a>. The function is called too when the script is first loaded.</li>\n<li><em>setDimensions</em> is fired with the <em>window.onresize</em> event</li>\n</ul>\n<p>With these functions we can control a simple scroller.</p>\n<p>How does the <em>render</em> function look like:\n<pre><code>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>scrollTop <span class=\"token operator\">!==</span> newScrollTop<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\nscrollTop <span class=\"token operator\">=</span> newScrollTop\n\nhaiyanPath\n<span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>#<span class=\"token number\">39</span><span class=\"token punctuation\">;</span>stroke<span class=\"token operator\">-</span>dashoffset<span class=\"token operator\">&amp;</span>#<span class=\"token number\">39</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">d</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">return</span> haiyanPath<span class=\"token punctuation\">.</span><span class=\"token function\">node</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTotalLength</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token function\">hayanPathScale</span><span class=\"token punctuation\">(</span>scrollTop<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token operator\">&amp;</span>#<span class=\"token number\">39</span><span class=\"token punctuation\">;</span>px<span class=\"token operator\">&amp;</span>#<span class=\"token number\">39</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span>\n\nwindow<span class=\"token punctuation\">.</span><span class=\"token function\">requestAnimationFrame</span><span class=\"token punctuation\">(</span>render<span class=\"token punctuation\">)</span>\n</code></pre></p>\n<ul>\n<li>After checking if the newScrollTop has changed, the only thing to change is the <em>stroke-dashoffset</em> attribute. Take a look at <a href=\"http://www.alolo.co/blog/2013/11/14/progressively-draw-svg-paths-with-d3js\">this web page</a> to see how does it work</li>\n</ul>\n<p>Now, let&#39;s see how the <em>setDimensions</em> function work:</p>\n<p><pre><code>\n<span class=\"token constant\">WIDTH</span> <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>innerWidth <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n<span class=\"token constant\">HEIGHT</span> <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>innerHeight<span class=\"token punctuation\">;</span>\n<span class=\"token constant\">SCROLL_LENGTH</span> <span class=\"token operator\">=</span> content<span class=\"token punctuation\">.</span><span class=\"token function\">node</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBoundingClientRect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>height <span class=\"token operator\">-</span> <span class=\"token constant\">HEIGHT</span><span class=\"token punctuation\">;</span>\n\nprojection<span class=\"token punctuation\">.</span><span class=\"token function\">scale</span><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token constant\">WIDTH</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span> <span class=\"token operator\">/</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">translate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token constant\">WIDTH</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">HEIGHT</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\npath<span class=\"token punctuation\">.</span><span class=\"token function\">projection</span><span class=\"token punctuation\">(</span>projection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nlandPath<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"d\"</span><span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncountriesPath<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"d\"</span><span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ngraticulePath<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"d\"</span><span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nhaiyanPath\n<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"d\"</span><span class=\"token punctuation\">,</span><span class=\"token function\">pathLine</span><span class=\"token punctuation\">(</span>track<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nhayanPathScale\n<span class=\"token punctuation\">.</span><span class=\"token function\">domain</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">SCROLL_LENGTH</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">range</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> haiyanPath<span class=\"token punctuation\">.</span><span class=\"token function\">node</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTotalLength</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nhaiyanPath\n<span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>#<span class=\"token number\">39</span><span class=\"token punctuation\">;</span>stroke<span class=\"token operator\">-</span>dasharray<span class=\"token operator\">&amp;</span>#<span class=\"token number\">39</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">d</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">var</span> l <span class=\"token operator\">=</span> d3<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">node</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTotalLength</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">return</span> l <span class=\"token operator\">+</span> <span class=\"token operator\">&amp;</span>#<span class=\"token number\">39</span><span class=\"token punctuation\">;</span>px<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>#<span class=\"token number\">39</span><span class=\"token punctuation\">;</span> <span class=\"token operator\">+</span> l <span class=\"token operator\">+</span> <span class=\"token operator\">&amp;</span>#<span class=\"token number\">39</span><span class=\"token punctuation\">;</span>px<span class=\"token operator\">&amp;</span>#<span class=\"token number\">39</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>#<span class=\"token number\">39</span><span class=\"token punctuation\">;</span>stroke<span class=\"token operator\">-</span>dashoffset<span class=\"token operator\">&amp;</span>#<span class=\"token number\">39</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">d</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">return</span> d3<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">node</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTotalLength</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token function\">hayanPathScale</span><span class=\"token punctuation\">(</span>scrollTop<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token operator\">&amp;</span>#<span class=\"token number\">39</span><span class=\"token punctuation\">;</span>px<span class=\"token operator\">&amp;</span>#<span class=\"token number\">39</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></p>\n<ul>\n<li>The new WIDTH, HEIGHT and SCROLL_LENGTH valeus are calculated</li>\n<li>The projection must be changed to adapt its scale to the new dimensions. Then the <em>path</em> function must have the new projection</li>\n<li>The map layers must be redrawn using the new path function, by changing the <em>d</em> attribute</li>\n<li>The Hayan path is a bit more tricky, since not all the changes can be done at once<ul>\n<li>First, the new path is set. This will make it with a changed length.</li>\n<li>The scale has to be changed, so it takes the new path length. Bothe the domain and range are affected, since the scroll size changed too</li>\n<li>Finally, the <em>stroke-dasharray</em> and <em>stroke-dashoffset</em> have to change too, with the new scroll and length values</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"links\">Links</h2>\n<ul>\n<li><p><a href=\"http://www.nytimes.com/newsgraphics/2013/10/13/russia/\">Mike Bostock&#39;s visualization I liked in first place</a></p>\n</li>\n<li><p><a href=\"http://bl.ocks.org/tonyhschu/af64df46f7b5b760fc1db1260dd6ec6a\">Tony Chu&#39;s block where I took the basic code from</a></p>\n</li>\n<li><p><a href=\"http://www.r2d3.us/visual-intro-to-machine-learning-part-1/\">A nice multi-section scroller</a></p>\n</li>\n<li><p><a href=\"http://vallandingham.me/scroller.html\">So You Want to Build A Scroller</a>, another good tutorial by Jim Vallandingham</p>\n</li>\n<li><p><a href=\"http://bl.ocks.org/rveciana/8463775\">How to create the Hayan Typhoon map</a></p>\n</li>\n<li><p><a href=\"http://bl.ocks.org/rveciana/8464690\">Hayan animated path original example</a></p>\n</li>\n<li><p><a href=\"http://bl.ocks.org/rveciana/eeaa71659adbc88dc4165eaf99dcb9be\">The block for the first example</a></p>\n</li>\n<li><p><a href=\"http://www.alolo.co/blog/2013/11/14/progressively-draw-svg-paths-with-d3js\">Progressively drawing SVG paths with D3.js</a></p>\n</li>\n<li><p>Another animated paths example: <a href=\"http://bl.ocks.org/rveciana/7664109\">Animated arabic kufic calligraphy with D3</a></p>\n</li>\n</ul>\n","tags":["scroll"],"date":"2016-05-25T00:00:00.000Z","thumbnail":"/images/d3/d3-scroller/twitter.png"}