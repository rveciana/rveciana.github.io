{"title":"Mapping EUROSTAT data with D3js","contents":"<p>Eurostat gives a lot of statistical data, most of the times georeferred. This makes easy to create nive maps telling stories about any topic you may be interested in.</p>\n<p>Unfortunately, I didn&#39;t find an easy way to do that using D3js, so I wrote <a href=\"http://geoexamples.blogspot.com.es/2013/10/using-eurostats-data-with-d3js.html\">a post some time ago on how to do it</a>. The idea worked, but I think that it can be done really easily, without python scripts, just by downloading Excel sheets and exporting to CSV. Also, with the new <a href=\"http://geoexamples.com/d3-composite-projections/\">d3-composite-projections</a> version, a convenient projection has been added to show the island and terrotories away from Europe, but that appear at the Eurostat data.</p>\n<p>The idea is creating the maps as <a href=\"http://ec.europa.eu/eurostat/statistics-explained/images/a/ae/Urban_rural_typology_for_NUTS3_new.png\">Eurostat does</a>:</p>\n<p><a href=\"http://ec.europa.eu/eurostat/statistics-explained/images/a/ae/Urban_rural_typology_for_NUTS3_new.png\"><img width=\"50%\" src=\"/images/d3/d3-nuts/example.png\"/></a></p>\n<p>You can see the <a href=\"http://bl.ocks.org/rveciana/e3c02fe71f8dc63041ea\">working example at bl.ocks.org</a>, and it looks like this:</p>\n<img width=\"50%\" src=\"/images/d3/d3-nuts/final-map.png\"/>\n\n<h2 id=\"downloading-some-sample-data\">Downloading some sample data</h2>\n<p>To create a map, you will need two data sources:</p>\n<ol>\n<li>The regions where the data belongs. The regions are coded in a system called NUTS (Nomenclature of territorial units for statistics)</li>\n<li>The data you want to represent at each region, such as <em>Greenhouse gas emisions</em>, <em>murders</em>, etc</li>\n</ol>\n<h3 id=\"nuts-regions\">NUTS regions</h3>\n<p>Getting the regions and using them in TopoJSON format is not very straigth forward, so I did it for you.</p>\n<p>The files are at [this gist][<a href=\"https://gist.github.com/rveciana/5919944%5D\">https://gist.github.com/rveciana/5919944]</a>, with the names nuts0.json, nuts1.json, etc. You can use <em>rawgit</em> to get the files without downloading them. To get the nuts3 topojson:</p>\nhttps://cdn.rawgit.com/rveciana/5919944/raw/19dc3e37a6ca5ebb05d3a2d96a1f499d6cc3411c/nuts3.json<p>If you want to know how to generate these TopoJSONs, you can check <a href=\"d3-EUROSTAT-topojson.html\">the next post</a></p>\n<h3 id=\"getting-the-information-data\">Getting the information data</h3>\n<p>To get the data, you have first to decide which data to use. In my case, I have chosen to map the amount of people at risk of poverty or social exclusion. To do it, <a href=\"http://ec.europa.eu/eurostat\">from the main page</a>, I have done:</p>\n<p>Population and Social conditions -&gt; Income and living conditions -&gt; Main Tables -&gt; People at risk of poverty or social exclusion by NUTS 2 regions.</p>\n<p>From there, choose <em>Tables, maps and graphs interface</em>:</p>\n<img src=\"/images/d3/d3-nuts/table.png\"/>\n\n<p>Choose the <em>More data in the source dataset</em> button:</p>\n<img src=\"/images/d3/d3-nuts/source-dataset.png\"/>\n\n<p>Then, the GEO <em>+ button</em>:</p>\n<img src=\"/images/d3/d3-nuts/geo.png\"/>\n\n<p>Once there, ask to get not just the region names, but the labels too, so the topoJSON codes can be used. Don&#39;t forget to click the <em>update</em> button:</p>\n<img src=\"/images/d3/d3-nuts/labels.png\"/>\n\n<p>Now you can click the <em>download</em> button and ask to have the labels in a separate column from the name (or doing it yourself will be a mess, believe me):</p>\n<img src=\"/images/d3/d3-nuts/download.png\"/>\n\n<p>Oce the excel file is generated, export it to CSV. In our case, two tables are generated. I have chosen the first one <em>percentage of total population</em>, and remove the other parts.</p>\n<p>Why not generating CSV files directly if there is an option? Because it will generate a row for each year and region, making things much more difficult.</p>\n<h2 id=\"creating-the-map\">Creating the map</h2>\n<p>To create the map, I&#39;ve done it as usual, but loading a the csv with the variable data. This way, just by changing the csv, creating new maps is very easy. The working example is at <a href=\"http://bl.ocks.org/rveciana/e3c02fe71f8dc63041ea\">bl.ocks.org</a>.</p>\n<p>Some things deserve a little explanation.</p>\n<h3 id=\"creating-the-color-scale\">Creating the color scale:</h3>\n<p><pre><code>\n<span class=\"token keyword\">var</span> scale <span class=\"token operator\">=</span> d3<span class=\"token punctuation\">.</span>scale<span class=\"token punctuation\">.</span><span class=\"token function\">quantize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">domain</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">60</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">range</span><span class=\"token punctuation\">(</span>colorbrewer<span class=\"token punctuation\">.</span>OrRd<span class=\"token punctuation\">[</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\nI have used the <em>colorbrewer2</em> library, which gives many color scales already made. You just have to choose how many colors to use (9 in the example) and the scale name (OrRd). Choosing one is really simple. Just go to the <a href=\"http://colorbrewer2.org/\">library page</a> and play with the examples until you have the codes.</p>\n<p>The domain indicates the maximum and minumum values for the scale. Since no country has values lower than 10 or higher than 60, I forced these limits.</p>\n<h3 id=\"choosing-the-color-to-paint-the-region\">Choosing the color to paint the region:</h3>\n<p><pre><code>\n<span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fill\"</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">d</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">var</span> value <span class=\"token operator\">=</span> data<span class=\"token punctuation\">[</span>d<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isNaN</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\nvalue <span class=\"token operator\">=</span> data<span class=\"token punctuation\">[</span>d<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isNaN</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">return</span> <span class=\"token string\">\"#fff\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">scale</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></p>\n<p>I took this data because it&#39;s not perfect. Some data is given by NUTS2 and other by NUTS1. This is, some is given by country and other by quite large regions.</p>\n<ul>\n<li><em>data</em> has all the csv data as a structure. When choosing the key <em>d.id</em>, the data for the current region should be used.</li>\n<li>The regions with NUTS1 data won&#39;t work, since the code is for the whole country, not for the region. Fortunately, the NUTS2 codes include the NUTS1 code. This is <em>UK12</em> belongs to <em>UK</em>. Thats why I used the conditional. If no value is found, we try with the first two characters, and the NUTS1 code may match then.</li>\n<li>In some cases, the region is not found, since it&#39;s not in the CSV file. A white color is then returned.</li>\n</ul>\n<p>To show a small tooltip, a similar solution is used.</p>\n<p>The whole code, running at <a href=\"http://bl.ocks.org/rveciana/e3c02fe71f8dc63041ea\">bl.ocks.org</a> is this one:</p>\n<p><pre><code>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">DOCTYPE</span> html<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>meta charset<span class=\"token operator\">=</span><span class=\"token string\">\"utf-8\"</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>style<span class=\"token operator\">></span>\n\n\n<span class=\"token punctuation\">.</span>border <span class=\"token punctuation\">{</span>\nstroke<span class=\"token operator\">:</span> #<span class=\"token number\">000</span><span class=\"token punctuation\">;</span>\nfill<span class=\"token operator\">:</span> none<span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">.</span>graticule <span class=\"token punctuation\">{</span>\nfill<span class=\"token operator\">:</span> none<span class=\"token punctuation\">;</span>\nstroke<span class=\"token operator\">:</span> #<span class=\"token number\">777</span><span class=\"token punctuation\">;</span>\nstroke<span class=\"token operator\">-</span>width<span class=\"token operator\">:</span> <span class=\"token number\">.5</span>px<span class=\"token punctuation\">;</span>\nstroke<span class=\"token operator\">-</span>opacity<span class=\"token operator\">:</span> <span class=\"token number\">.5</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\ndiv<span class=\"token punctuation\">.</span>tooltip <span class=\"token punctuation\">{</span>\nposition<span class=\"token operator\">:</span> absolute<span class=\"token punctuation\">;</span>\ntext<span class=\"token operator\">-</span>align<span class=\"token operator\">:</span> center<span class=\"token punctuation\">;</span>\nwidth<span class=\"token operator\">:</span> <span class=\"token number\">84</span>px<span class=\"token punctuation\">;</span>\nheight<span class=\"token operator\">:</span> <span class=\"token number\">64</span>px<span class=\"token punctuation\">;</span>\npadding<span class=\"token operator\">:</span> <span class=\"token number\">2</span>px<span class=\"token punctuation\">;</span>\nfont<span class=\"token operator\">:</span> <span class=\"token number\">12</span>px sans<span class=\"token operator\">-</span>serif<span class=\"token punctuation\">;</span>\nbackground<span class=\"token operator\">:</span> lightgrey<span class=\"token punctuation\">;</span>\nborder<span class=\"token operator\">:</span> <span class=\"token number\">0</span>px<span class=\"token punctuation\">;</span>\nborder<span class=\"token operator\">-</span>radius<span class=\"token operator\">:</span> <span class=\"token number\">8</span>px<span class=\"token punctuation\">;</span>\npointer<span class=\"token operator\">-</span>events<span class=\"token operator\">:</span> none<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>style<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>body<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>h1<span class=\"token operator\">></span>People at risk <span class=\"token keyword\">of</span> poverty or social exclusion by <span class=\"token constant\">NUTS</span> <span class=\"token number\">2</span> regions<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>script src<span class=\"token operator\">=</span><span class=\"token string\">\"http://d3js.org/d3.v3.min.js\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>script src<span class=\"token operator\">=</span><span class=\"token string\">\"http://d3js.org/topojson.v1.min.js\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>script src<span class=\"token operator\">=</span><span class=\"token string\">\"http://d3js.org/colorbrewer.v1.min.js\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>script src<span class=\"token operator\">=</span><span class=\"token string\">\"https://cdn.rawgit.com/rveciana/d3-composite-projections/v0.2.0/composite-projections.min.js\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>script<span class=\"token operator\">></span>\n\n\n<span class=\"token keyword\">var</span> div <span class=\"token operator\">=</span> d3<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"body\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"div\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"class\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"tooltip\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"opacity\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> width <span class=\"token operator\">=</span> <span class=\"token number\">600</span><span class=\"token punctuation\">,</span>\nheight <span class=\"token operator\">=</span> <span class=\"token number\">500</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> projection <span class=\"token operator\">=</span> d3<span class=\"token punctuation\">.</span>geo<span class=\"token punctuation\">.</span><span class=\"token function\">conicConformalEurope</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> graticule <span class=\"token operator\">=</span> d3<span class=\"token punctuation\">.</span>geo<span class=\"token punctuation\">.</span><span class=\"token function\">graticule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> path <span class=\"token operator\">=</span> d3<span class=\"token punctuation\">.</span>geo<span class=\"token punctuation\">.</span><span class=\"token function\">path</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">projection</span><span class=\"token punctuation\">(</span>projection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> scale <span class=\"token operator\">=</span> d3<span class=\"token punctuation\">.</span>scale<span class=\"token punctuation\">.</span><span class=\"token function\">quantize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">domain</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">60</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">range</span><span class=\"token punctuation\">(</span>colorbrewer<span class=\"token punctuation\">.</span>OrRd<span class=\"token punctuation\">[</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> svg <span class=\"token operator\">=</span> d3<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"body\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"svg\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"width\"</span><span class=\"token punctuation\">,</span> width<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"height\"</span><span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nsvg<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"path\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">datum</span><span class=\"token punctuation\">(</span>graticule<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"class\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"graticule\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"d\"</span><span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nd3<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&lt;a href=\"</span>https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>cdn<span class=\"token punctuation\">.</span>rawgit<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>rveciana<span class=\"token operator\">/</span><span class=\"token number\">5919944</span><span class=\"token operator\">/</span>raw<span class=\"token comment\">//nuts2.json\"\">https://cdn.rawgit.com/rveciana/5919944/raw//nuts2.json\"&lt;/a>, function(error, europe) {</span>\nd3<span class=\"token punctuation\">.</span><span class=\"token function\">csv</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"povertry_rate.csv\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error<span class=\"token punctuation\">,</span> povrate</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">var</span> land <span class=\"token operator\">=</span> topojson<span class=\"token punctuation\">.</span><span class=\"token function\">feature</span><span class=\"token punctuation\">(</span>europe<span class=\"token punctuation\">,</span> europe<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span>nuts2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ndata <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\npovrate<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">d</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  data<span class=\"token punctuation\">[</span>d<span class=\"token punctuation\">.</span><span class=\"token constant\">GEO</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> d<span class=\"token punctuation\">[</span><span class=\"token string\">'2013'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nsvg<span class=\"token punctuation\">.</span><span class=\"token function\">selectAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"path\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span>land<span class=\"token punctuation\">.</span>features<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">enter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"path\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"d\"</span><span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"stroke\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"#000\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"stroke-width\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\".5px\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fill\"</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">d</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> value <span class=\"token operator\">=</span> data<span class=\"token punctuation\">[</span>d<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isNaN</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n          value <span class=\"token operator\">=</span> data<span class=\"token punctuation\">[</span>d<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isNaN</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span> <span class=\"token string\">\"#fff\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token function\">scale</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mouseover\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">d<span class=\"token punctuation\">,</span>i</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> value <span class=\"token operator\">=</span> data<span class=\"token punctuation\">[</span>d<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isNaN</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n          value <span class=\"token operator\">=</span> data<span class=\"token punctuation\">[</span>d<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        div<span class=\"token punctuation\">.</span><span class=\"token function\">transition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">duration</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"opacity\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.9</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        div<span class=\"token punctuation\">.</span><span class=\"token function\">html</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&lt;b>\"</span><span class=\"token operator\">+</span>d<span class=\"token punctuation\">.</span>properties<span class=\"token punctuation\">.</span>name<span class=\"token operator\">+</span><span class=\"token string\">\"&lt;/b>&lt;br/>\"</span> <span class=\"token operator\">+</span> value <span class=\"token operator\">+</span> <span class=\"token string\">\"%\"</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"left\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>d3<span class=\"token punctuation\">.</span>event<span class=\"token punctuation\">.</span>pageX<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"px\"</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"top\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>d3<span class=\"token punctuation\">.</span>event<span class=\"token punctuation\">.</span>pageY <span class=\"token operator\">-</span> <span class=\"token number\">28</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"px\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mouseout\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">d<span class=\"token punctuation\">,</span>i</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      div<span class=\"token punctuation\">.</span><span class=\"token function\">transition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">duration</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"opacity\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    svg\n      <span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"path\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fill\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"none\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"stroke\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"#000\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"d\"</span><span class=\"token punctuation\">,</span> projection<span class=\"token punctuation\">.</span><span class=\"token function\">getCompositionBorders</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n</code></pre></p>\n","tags":["EUROSTAT","Open Data"],"date":"2015-09-25T00:00:00.000Z"}