{"title":"Migrating a Jekyll blog to Svelte-kit","contents":"<p>Five years ago I changed my <a href=\"http://geoexamples.blogspot.com/\">old blogger blog</a> to Jekyll. Now I&#39;ve changed to Svelte, and here you have the steps and issues I found. You can find <a href=\"https://github.com/rveciana/geoexamples-blog\">the blog code repo here</a>.</p>\n<h3 id=\"toc\">TOC</h3>\n<ul>\n<li><a href=\"#why\">Why?</a></li>\n<li><a href=\"#technologies-used\">Technologies used</a></li>\n<li><a href=\"#starting-the-project\">Starting the project</a></li>\n<li><a href=\"#packagejson\">package.json</a></li>\n<li><a href=\"#markdown-config-json\">markdown-config-json</a></li>\n<li><a href=\"#svelte-config\">Svelte config</a></li>\n<li><a href=\"#apphtml-and-layoutsvelte\">app.html and $layout.svelte</a></li>\n<li><a href=\"#endpoints\">Endpoints</a></li>\n<li><a href=\"#getting-the-data\">Getting the data</a></li>\n<li><a href=\"#components\">Components</a></li>\n<li><a href=\"#routes\">Routes</a></li>\n<li><a href=\"#deploying\">Deploying</a></li>\n<li><a href=\"#links\">Links</a></li>\n</ul>\n<h2 id=\"why\">Why?</h2>\n<p>There are many reasons to change an old Jekyll blog (but mine is, honestly, that I wanted to learn Svelte-Kit!).</p>\n<ul>\n<li>Jekyll is getting old, so the possibilities with more modern JavaScript tools is poor</li>\n<li>It&#39;s really slow when processing changes</li>\n<li>It&#39;s made in Ruby, which is fine, but not a language I know, so modifying it becomes hard for me</li>\n</ul>\n<p>You have more reasons and explanations in <a href=\"https://ghostinspector.com/blog/rebuilding-jekyll-website-next-js-theme-ui/\">this post</a>.</p>\n<p>I could use some of the react based solutions, but I like Svelte and I couldn&#39;t find docs for doing it, so I chose ir. Also, svelte-kit seems a really nice solution, although is still very new.</p>\n<h2 id=\"technologies-used\">Technologies used</h2>\n<ul>\n<li><a href=\"https://kit.svelte.dev/docs\">svelte-kit</a>: All the site functionality is done in svelte, and svelte-kit converts all the routes to static html pages that can be uploaded anywhere</li>\n<li><a href=\"https://github.com/klaytonfaria/markdown-json#readme\">markdown-json</a>: I&#39;ll keep all the entries written in markdown, so they have to be converted to html somehow. This library does it really well, although some files that Jekyll accepted are not correct for markdown-json</li>\n<li><a href=\"https://github.com/PrismJS/prism#readme\">prismjs</a>: The previous library doesn&#39;t transform the code into highlighted html. Prismjs is the library I used to do it. Configuring it it&#39;s not that easy because it doesn&#39;t include python highlighting by default</li>\n<li><a href=\"https://handlebarsjs.com/\">handlebars</a> to replace the Jekyll placeholders with values</li>\n<li><a href=\"https://sass-lang.com/\">Sass</a>: Svelte itself can use SaSS, which is very convenient since I was already using it in Jekyll, so I didn&#39;t change the styles at all</li>\n<li><a href=\"https://pages.github.com/\">GitHub pages</a>: There are better options now, but I didn&#39;t want to change the domain configuration, so the site is stored directly on GitHub. The generated html has to be in the master branch, while Jekyll was deployed directly by GitHub. It&#39;s a point against using this solution.</li>\n</ul>\n<h2 id=\"starting-the-project\">Starting the project</h2>\n<p>Starting the project is as easy as:</p>\n<p>npm init svelte@next my-blog</p>\n<ul>\n<li>We&#39;ll need to create a folder for the blog posts and Jekyll pages pages (I called it content)</li>\n<li>On src/static, I copied the <em>images</em> folder I already had on Jekyll, the favicon, the manifest file and the CNAME file that enables my domain on GitHub pages</li>\n</ul>\n<p>And that&#39;s it. Now, all the code has to be written so the blog renders the markdown entries</p>\n<h2 id=\"packagejson\">package.json</h2>\n<p><pre><code>\n<span class=\"token string\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n<span class=\"token string\">\"dev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"svelte-kit dev\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">\"build\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"npm run contentGen &amp;amp;&amp;amp; svelte-kit build\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">\"start\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"svelte-kit start\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">\"lint\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"prettier --check . &amp;amp;&amp;amp; eslint --ignore-path .gitignore .\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">\"format\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"prettier --write .\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">\"contentGen\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"markdown-json -c markdown-config.json\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">\"watch-md\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"nodemon -e md -x \"</span>npm run contentGen<span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">\"dev-md\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"concurrently \"</span>npm run dev<span class=\"token string\">\" \"</span>npm run watch<span class=\"token operator\">-</span>md<span class=\"token string\">\"\"</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></p>\n<ul>\n<li><em>npm run dev will</em> start the main svelte server, and reload the content when the Svelte files change. The result can be seen on <em>localhost:3000</em> by default</li>\n<li><em>npm run contentGen</em> will process the markdown files</li>\n<li><em>npm run watch-md</em> will rerun the previous script every time that a markdown file changes</li>\n<li><em>npm run dev-md</em> will run both the Svelte server ans the markdown generator. Stopping it doesn&#39;t work very well (tha console has to be closed to free the port), it&#39;s a point to improve</li>\n</ul>\n<h2 id=\"markdown-config-json\">markdown-config-json</h2>\n<p>This is where the markdown files are rendered into a JSON object with the html to show on the site. The important part is setting the <em>src</em> directory where the markdown lives and a <em>dist</em> pat where we will get all the data from</p>\n<p><pre><code>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"markdown-json\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"cwd\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"src\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"content/\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"filePattern\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;em>*/&lt;/em>.m*\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"ignore\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"dist\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"src/lib/data.json\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"metadata\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"server\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></p>\n<p>The result, for each entry, is something like this:</p>\n<p><pre><code>\n<span class=\"token punctuation\">{</span>\n      <span class=\"token string\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"An id that also matches the markdown path\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"contents\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"The rendered HTML\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"excerpt\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"The first part of the rendered HTML so it can be shown\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"layout\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"post\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Post or page title\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"date\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"categories\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"tags\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"teaser\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"d3-composite-projections.png\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"meta\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"relativePath\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"posts\\d3\\2015-05-12-d3-composite-projections.html\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"createdAt\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2021-04-11T18:28:06.923Z\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"lastModified\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2021-04-11T18:28:06.923Z\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"size\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2668</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"formattedSize\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2.6 KB\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n</code></pre></p>\n<p>The first three fields and the metadata will always appear, while the other fields will match the <a href=\"https://jekyllrb.com/docs/front-matter/\">front matter section</a> of your Jekyll file:</p>\n---\nproperty: value\ntags: [first, second, third]\n-npm--<p>Those properties are necessary to classify and sort the posts and pages.</p>\n<h2 id=\"svelte-config\">Svelte config</h2>\n<p>The svelte config I used is the following, prepared to generate the static site:</p>\n<p><pre><code>\n<span class=\"token keyword\">const</span> sveltePreprocess <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"svelte-preprocess\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> nodeStatic <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"@sveltejs/adapter-static\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> pkg <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"./package.json\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    preprocess<span class=\"token operator\">:</span> <span class=\"token function\">sveltePreprocess</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    kit<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        adapter<span class=\"token operator\">:</span> <span class=\"token function\">nodeStatic</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> pages<span class=\"token operator\">:</span> <span class=\"token string\">\"../build\"</span><span class=\"token punctuation\">,</span> assets<span class=\"token operator\">:</span> <span class=\"token string\">\"../build\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        appDir<span class=\"token operator\">:</span> <span class=\"token string\">\"staticApp\"</span><span class=\"token punctuation\">,</span>\n        target<span class=\"token operator\">:</span> <span class=\"token string\">\"#svelte\"</span><span class=\"token punctuation\">,</span>\n        vite<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            ssr<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                noExternal<span class=\"token operator\">:</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>pkg<span class=\"token punctuation\">.</span>dependencies <span class=\"token operator\">||</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></p>\n<ul>\n<li>appDir generates a static site</li>\n<li>adapter needs to set the build directory as specified. I needed using different repos for the build and the svelte app, so that&#39;s the way you can get a build in another directory</li>\n</ul>\n<h2 id=\"apphtml-and-layoutsvelte\">app.html and $layout.svelte</h2>\n<ul>\n<li><p>All svelte-kit projects have the app.html which is the place to import libraries (I didn&#39;t, better do it with an import inside the svelte files), add meta tags and so on. The meta tags can be added later, but the fixed ones can go here.</p>\n</li>\n<li><p>$layout.svelte is the base to our page, its where the header and footer are added. Let&#39;s see it, as it&#39;s similar to the other svelte files:\n<pre><code>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ts<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">context</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>module<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n  <span class=\"token keyword\">import</span> type <span class=\"token punctuation\">{</span> PageSummary <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'$lib/model'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">export</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> fetch <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> resultPages <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/summary_pages.json'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">const</span> pages <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">await</span> resultPages<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> PageSummary<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n          props<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> pages <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ts<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n  <span class=\"token keyword\">import</span> <span class=\"token string\">'../app.scss'</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">import</span> Footer <span class=\"token keyword\">from</span> <span class=\"token string\">'$lib/components/Footer.svelte'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">import</span> Header <span class=\"token keyword\">from</span> <span class=\"token string\">'$lib/components/Header.svelte'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">export</span> <span class=\"token keyword\">let</span> pages<span class=\"token operator\">:</span> PageSummary<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Header</span> <span class=\"token attr-name\">{pages}</span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>main</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>page-content<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>wrapper<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>slot</span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>main</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Footer</span> <span class=\"token punctuation\">/></span></span>\n</code></pre>\n</li>\n<li><p>We have to define all the scripts as typescript or we&#39;ll get errors</p>\n</li>\n<li><p>Note that there are two scripts:</p>\n<ul>\n<li>When adding <em>context=&quot;module&quot;</em>, will run before the component is rendered. In our case, we&#39;ll use it to call the async functions that call the endpoints.</li>\n<li>The other script imports the components and exports the variables that we want to use in the template part (the links to the pages in our case)</li>\n</ul>\n</li>\n<li><p>The <em>slot</em> tag is where the actual pages will put their content</p>\n</li>\n</ul>\n<h2 id=\"endpoints\">Endpoints</h2>\n<p>You can create as many endpoints as you want by adding *ts files to the routes. These files return json objects. It&#39;s a good practice to add the json to the name so they are called as json files in the path.</p>\n<p><em>data.json.ts</em> could be like:</p>\n<p><pre><code>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> body<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>value<span class=\"token operator\">:</span> <span class=\"token number\">42</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> status<span class=\"token operator\">:</span> <span class=\"token number\">200</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></p>\n<p>The get function sets the get HTTP method, and returns the body of the response and the status. Playing with this is possible to create a complete REST API easily</p>\n<h2 id=\"getting-the-data\">Getting the data</h2>\n<p>A real endpoint using the data created with <em>markdown-json</em> is using this function to do it (<em>get_contents.ts</em>):</p>\n<p><pre><code>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'$lib/data.json'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> type <span class=\"token punctuation\">{</span> PostSummary <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./model'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> getContents <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>num_posts<span class=\"token operator\">:</span> string <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> PostSummary<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=></span>\n    Object<span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">value</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> value<span class=\"token punctuation\">.</span>layout <span class=\"token operator\">===</span> <span class=\"token string\">\"post\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">sort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> num_posts <span class=\"token operator\">?</span> <span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>num_posts<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">post</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">const</span> postDate <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">const</span> htmlPath <span class=\"token operator\">=</span> post<span class=\"token punctuation\">.</span>meta<span class=\"token punctuation\">.</span>relativePath\n                <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token operator\">/</span>\\<span class=\"token operator\">/</span>g<span class=\"token punctuation\">,</span> <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">pop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n                title<span class=\"token operator\">:</span> post<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">,</span>\n                date<span class=\"token operator\">:</span> post<span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">,</span>\n                tags<span class=\"token operator\">:</span> post<span class=\"token punctuation\">.</span>tags<span class=\"token punctuation\">,</span>\n                categories<span class=\"token operator\">:</span> post<span class=\"token punctuation\">.</span>categories<span class=\"token punctuation\">,</span>\n                teaser<span class=\"token operator\">:</span> post<span class=\"token punctuation\">.</span>teaser<span class=\"token punctuation\">,</span>\n                slug<span class=\"token operator\">:</span> <span class=\"token operator\">&lt;</span>code<span class=\"token operator\">></span><span class=\"token operator\">/</span>$<span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">.</span>categories<span class=\"token punctuation\">}</span><span class=\"token operator\">/</span>$<span class=\"token punctuation\">{</span>postDate<span class=\"token punctuation\">.</span><span class=\"token function\">getFullYear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token operator\">/</span>$<span class=\"token punctuation\">{</span>postDate<span class=\"token punctuation\">.</span><span class=\"token function\">toLocaleDateString</span><span class=\"token punctuation\">(</span>\n                    <span class=\"token string\">\"en-US\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token punctuation\">{</span>\n                        month<span class=\"token operator\">:</span> <span class=\"token string\">\"2-digit\"</span>\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token operator\">/</span>$<span class=\"token punctuation\">{</span>postDate<span class=\"token punctuation\">.</span><span class=\"token function\">toLocaleDateString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"en-US\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> day<span class=\"token operator\">:</span> <span class=\"token string\">\"2-digit\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token operator\">/</span>$<span class=\"token punctuation\">{</span>htmlPath<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>code<span class=\"token operator\">></span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></p>\n<p>This is the function that converts the <em>data.json</em> file into the object we need. </p>\n<ul>\n<li>First, the data is filtered so we take only posts and not pages, sorted and ony the first <em>num_posts</em> are returned</li>\n<li>The rest of the function just converts the paths and other Jekyll information into the one we need to show the list of posts</li>\n</ul>\n<h2 id=\"components\">Components</h2>\n<p>Using svelte-kit, the routes can have most of the component, so as separate components I used only one for the header, another for the footer (copied more or less directly from Jekyll) and one for the main page, that renders the image, title and tag for each blog post.</p>\n<h2 id=\"routes\">Routes</h2>\n<p>Routing is one of the nice svelte-kit features. The only problem I found is that using a static build, query strings don&#39;t work, so all the requests must be only with the path.</p>\n<p>There are some routes that don&#39;t have variable, like <em>blog.svelte</em></p>\n<p><pre><code><span class=\"token operator\">&lt;</span>script lang<span class=\"token operator\">=</span><span class=\"token string\">\"ts\"</span> context<span class=\"token operator\">=</span><span class=\"token string\">\"module\"</span><span class=\"token operator\">></span>\n    <span class=\"token keyword\">export</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> fetch <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> resultPosts <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'blog.json'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> posts <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">await</span> resultPosts<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> PostSummary<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> resultTagsAndCategories <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'tags-and-categories.json'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> tagsAndCategories <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">await</span> resultTagsAndCategories<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> TagsAndCategories<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n            props<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> posts<span class=\"token punctuation\">,</span> tagsAndCategories <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>script lang<span class=\"token operator\">=</span><span class=\"token string\">\"ts\"</span><span class=\"token operator\">></span>\n    <span class=\"token keyword\">import</span> PostCard <span class=\"token keyword\">from</span> <span class=\"token string\">'$lib/components/PostCard.svelte'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">import</span> type <span class=\"token punctuation\">{</span> PostSummary<span class=\"token punctuation\">,</span> TagsAndCategories <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'$lib/model'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">export</span> <span class=\"token keyword\">let</span> posts<span class=\"token operator\">:</span> PostSummary<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">export</span> <span class=\"token keyword\">let</span> tagsAndCategories<span class=\"token operator\">:</span> TagsAndCategories <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> tags<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> categories<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>h1<span class=\"token operator\">></span>Categories<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n<span class=\"token punctuation\">{</span>#each tagsAndCategories<span class=\"token punctuation\">.</span>categories <span class=\"token keyword\">as</span> category<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span>a href<span class=\"token operator\">=</span><span class=\"token string\">\"/categories/{category}\"</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span>category<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>a<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">{</span>#<span class=\"token keyword\">if</span> i <span class=\"token operator\">&lt;</span> tagsAndCategories<span class=\"token punctuation\">.</span>categories<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">{</span><span class=\"token string\">' '</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">{</span><span class=\"token operator\">/</span><span class=\"token keyword\">if</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span><span class=\"token operator\">/</span>each<span class=\"token punctuation\">}</span>\n<span class=\"token operator\">&lt;</span>h1<span class=\"token operator\">></span>Tags<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>div <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"tagcloud\"</span><span class=\"token operator\">></span>\n    <span class=\"token punctuation\">{</span>#each tagsAndCategories<span class=\"token punctuation\">.</span>tags <span class=\"token keyword\">as</span> tag<span class=\"token punctuation\">}</span>\n        <span class=\"token operator\">&lt;</span>a\n            href<span class=\"token operator\">=</span><span class=\"token string\">\"/tags/{tag.label}\"</span>\n            style<span class=\"token operator\">=</span>\"font<span class=\"token operator\">-</span>size<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>\n                <span class=\"token number\">70</span> <span class=\"token operator\">+</span>\n                <span class=\"token number\">100</span> <span class=\"token operator\">*</span>\n                    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>tag<span class=\"token punctuation\">.</span>occurrences <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span>tagsAndCategories<span class=\"token punctuation\">.</span>tags<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">d</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> d<span class=\"token punctuation\">.</span>occurrences<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">%</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">}</span>\"<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>tag<span class=\"token punctuation\">.</span>label<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>a\n        <span class=\"token operator\">></span><span class=\"token punctuation\">{</span><span class=\"token string\">' '</span><span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">{</span><span class=\"token operator\">/</span>each<span class=\"token punctuation\">}</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>article <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"post-content\"</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>h1<span class=\"token operator\">></span>Posts<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>ul <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"post-list\"</span><span class=\"token operator\">></span>\n        <span class=\"token punctuation\">{</span>#each posts <span class=\"token keyword\">as</span> post<span class=\"token punctuation\">}</span>\n            <span class=\"token operator\">&lt;</span>li<span class=\"token operator\">></span>\n                <span class=\"token operator\">&lt;</span>PostCard <span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>li<span class=\"token operator\">></span>\n        <span class=\"token punctuation\">{</span><span class=\"token operator\">/</span>each<span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ul<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>article<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>p <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"rss-subscribe\"</span><span class=\"token operator\">></span>subscribe <span class=\"token operator\">&lt;</span>a href<span class=\"token operator\">=</span><span class=\"token string\">\"http://feeds.feedburner.com/Geoexamples\"</span><span class=\"token operator\">></span>via <span class=\"token constant\">RSS</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>a<span class=\"token operator\">></span>\n</code></pre>\n\n<p>Only 50 lines to show all entries and a tag cloud! Again, a <em>module</em> context script is run before the component is mounted and provides the data.</p>\n<p>The tags cloud could be in another component, but this was a migration and there were many things to change.</p>\n<p>Each blog entry takes from Jekyll a category and a date in the form:</p>\n<p>  [category]/[year]/[month]/[date]/[slug]</p>\n<p>The file, then, has to go into an identical path and can use the <em>page</em> variable in the <em>load</em> function:</p>\n<p><pre><code>\n<span class=\"token operator\">&lt;</span>script lang<span class=\"token operator\">=</span><span class=\"token string\">\"ts\"</span> context<span class=\"token operator\">=</span><span class=\"token string\">\"module\"</span><span class=\"token operator\">></span>\n    <span class=\"token keyword\">export</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> page<span class=\"token punctuation\">,</span> fetch <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> resultPosts <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>page<span class=\"token punctuation\">.</span>params<span class=\"token punctuation\">.</span>slug<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.json</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> post <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">await</span> resultPosts<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> Post<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n            props<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> post <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n\n</code></pre></p>\n<p>Using it gives us the value of the path. When generating the static web, each possible call will be rendered and we&#39;ll have the json and the html file.</p>\n<p>The endpoint will then have the same path but finished in <em>json.ts</em>. The important part is that the text stored in the data file has to be translated into the final html. This includes replacing the Jekyll placeholders and using <em>Prism</em> to translate the code:</p>\n<p><pre><code><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> configuration <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'$lib/config'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> Handlebars <span class=\"token keyword\">from</span> <span class=\"token string\">'handlebars'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> Prism <span class=\"token keyword\">from</span> <span class=\"token string\">'prismjs'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> md2html <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>mdContent<span class=\"token operator\">:</span> string<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token parameter\">string</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> template <span class=\"token operator\">=</span> Handlebars<span class=\"token punctuation\">.</span><span class=\"token function\">compile</span><span class=\"token punctuation\">(</span>mdContent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> text <span class=\"token operator\">=</span> <span class=\"token function\">template</span><span class=\"token punctuation\">(</span>configuration<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> codeMatches <span class=\"token operator\">=</span> text<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span><span class=\"token operator\">/</span><span class=\"token punctuation\">{</span><span class=\"token operator\">%</span> highlight <span class=\"token punctuation\">[</span>a<span class=\"token operator\">-</span>z<span class=\"token punctuation\">]</span><span class=\"token operator\">*</span> <span class=\"token operator\">%</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token operator\">|</span>\\n<span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token operator\">?</span></code></pre>/g);\n\nconst formattedCode = codeMatches?.map((d) =&gt; {\n    const lang = d\n        .match(/{% highlight [a-z]* %}/g)[0]\n        .replace(/{% highlight /g, &#39;&#39;)\n        .replace(/ %}/g, &#39;&#39;);\n    const code = d\n        .replace(/&lt;p&gt;/g, &#39;\\n&#39;)\n        .replace(/&lt;\\/p&gt;/g, &#39;&#39;)\n        .replace(/&amp;quot;/gi, `&quot;`)\n        .replace(/&amp;lt;/gi, &#39;&lt;&#39;)\n        .replace(/&amp;gt;/gi, &#39;&gt;&#39;)\n        .replace(/{% highlight [a-z]* %}/g, &#39;&#39;)\n        .replace(/{% endhighlight %}/g, &#39;&#39;);\n\n    switch (lang) {\n        case &#39;js&#39;:\n            return `&lt;pre&gt;&lt;code&gt;${Prism.highlight(code, Prism.languages.javascript)}&lt;/code&gt;&lt;/pre&gt;`;\n        case &#39;json&#39;:\n            return `&lt;pre&gt;&lt;code&gt;${Prism.highlight(code, Prism.languages.javascript)}&lt;/code&gt;&lt;/pre&gt;`;\n        case &#39;html&#39;:\n            return `&lt;pre&gt;&lt;code&gt;${Prism.highlight(code, Prism.languages.html)}&lt;/code&gt;&lt;/pre&gt;`;\n        case &#39;python&#39;:\n            return `&lt;pre&gt;&lt;code&gt;${Prism.highlight(code, Prism.languages.js)}&lt;/code&gt;&lt;/pre&gt;`;\n        default:\n            return `&lt;pre&gt;&lt;code&gt;${Prism.highlight(code, Prism.languages.js)}&lt;/code&gt;&lt;/pre&gt;`;\n    }\n});\n\nreturn codeMatches?.reduce((acc, curr, i) =&gt; acc.replace(curr, formattedCode[i]), text) ?? text;<p>};\n{% endhighlight %}</p>\n<ul>\n<li>The placeholders from Jekyll are replaced using handlebars. For instance  would be changed to the name in the configuration.</li>\n<li>Prism has to detect the language. The problem is that by default it doesn&#39;t include Python and I didn&#39;t find the way to do it in Svelte (instructions are for babel). Using the Javascript hightlighting for python doesn&#39;t give a bad result.</li>\n<li>HTML entities give some problems, so I had to replace them. Maybe there&#39;s a better way...</li>\n</ul>\n<h2 id=\"deploying\">Deploying</h2>\n<p>To make things faster I didn&#39;t want to change my GitHub hosting with gh-pages. To upload a site there, a repo with the name <em>username.github.io</em> has to be created. With Jekyll is cool because you can upload your Jekyll code directly there and GitHub creates the static site directly. In this case, we have the html and this is what has to go there, while the site code can go either in another branch or another repo (my option).</p>\n<p>To make the custom domain work, a file called <em>CNAME</em> with the domain as the content must be in the <em>static</em> folder.</p>\n<h2 id=\"links\">Links</h2>\n<ul>\n<li><a href=\"https://github.com/rveciana/geoexamples-blog\">Blog code repo</a></li>\n<li><a href=\"http://geoexamples.blogspot.com/\">Blogspot blog</a></li>\n<li><a href=\"https://ghostinspector.com/blog/rebuilding-jekyll-website-next-js-theme-ui/\">Migrating from Jekyll to Nextjs</a></li>\n<li><a href=\"https://kit.svelte.dev/docs\">svelte-kit</a></li>\n<li><a href=\"https://github.com/klaytonfaria/markdown-json#readme\">markdown-json</a></li>\n<li><a href=\"https://github.com/PrismJS/prism#readme\">prismjs</a></li>\n<li><a href=\"https://handlebarsjs.com/\">handlebars</a></li>\n<li><a href=\"https://sass-lang.com/\">Sass</a></li>\n<li><a href=\"https://pages.github.com/\">GitHub pages</a></li>\n<li><a href=\"https://jekyllrb.com/docs/front-matter/\">Front Matter</a></li>\n</ul>\n","tags":["jekyll","svelte-kit","markdown"],"date":"2021-04-21T18:40:53.000Z"}