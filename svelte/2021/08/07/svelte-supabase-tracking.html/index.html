<!DOCTYPE html>
<html lang="en">
	<head>
		<!-- Global site tag (gtag.js) - Google Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=G-BD6G9PF6NH"></script>
		<script>
			window.dataLayer = window.dataLayer || [];
			function gtag() {
				dataLayer.push(arguments);
			}
			gtag('js', new Date());

			gtag('config', 'G-BD6G9PF6NH');
		</script>

		<meta charset="utf-8" />
		<link rel="icon" href="/favicon.ico" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="manifest" href="/manifest.json" />
		<meta name="theme-color" content="#cdffcd" />
		<!-- HTML Meta Tags -->
		<meta
			name="description"
			content="I am a software developer and meteorologist who likes mapping. I put here the things I learn on my free time."
		/>
		<!-- Google / Search Engine Tags -->
		<meta itemprop="name" content=">GeoExamples - Roger Veciana" />
		<meta
			itemprop="description"
			content="I am a software developer and meteorologist who likes mapping. I put here the things I learn on my free time."
		/>
		<meta itemprop="image" content="https://geoexamples.com/siteImage.png" />

		<title>GeoExamples - A tracking tool with Supabase and Svelte</title><meta name="twitter:card" content="summary" data-svelte="svelte-w2s84v"><meta name="twitter:title" content="GeoExamples - A tracking tool with Supabase and Svelte" data-svelte="svelte-w2s84v"><meta name="twitter:description" content="&lt;p&gt;In the &lt;a href=&quot;h" data-svelte="svelte-w2s84v"><meta name="twitter:image" content="https://geoexamples.com/images/svelte/svelte-supabase-track/twitter.png" data-svelte="svelte-w2s84v"><meta property="og:url" content="https://geoexamples.com" data-svelte="svelte-w2s84v"><meta property="og:type" content="website" data-svelte="svelte-w2s84v"><meta property="og:title" content="GeoExamples - A tracking tool with Supabase and Svelte" data-svelte="svelte-w2s84v"><meta property="og:description" content="I am a software developer and meteorologist who likes mapping. I put here the things I learn on my free time." data-svelte="svelte-w2s84v"><meta property="og:image" content="https://geoexamples.com/images/svelte/svelte-supabase-track/twitter.png" data-svelte="svelte-w2s84v">

		

		<link rel="modulepreload" href="/app/start-98c290b0.js">
		<link rel="modulepreload" href="/app/chunks/vendor-f4f84e30.js">
		<link rel="modulepreload" href="/app/pages/__layout.svelte-b5745e7e.js">
		<link rel="modulepreload" href="/app/chunks/config-b3bde751.js">
		<link rel="modulepreload" href="/app/pages/[category]/[year]/[month]/[date]/[slug].svelte-dcec41b3.js">
		<link rel="stylesheet" href="/app/assets/start-a8cd1609.css">
		<link rel="stylesheet" href="/app/assets/pages/__layout.svelte-294fb61c.css">

		<script type="module">
			import { start } from "/app/start-98c290b0.js";
			start({
				target: document.querySelector("#svelte"),
				paths: {"base":"","assets":""},
				session: {},
				host: location.host,
				route: true,
				spa: false,
				trailing_slash: "never",
				hydrate: {
					status: 200,
					error: null,
					nodes: [
						import("/app/pages/__layout.svelte-b5745e7e.js"),
						import("/app/pages/[category]/[year]/[month]/[date]/[slug].svelte-dcec41b3.js")
					],
					page: {
						host: location.host, // TODO this is redundant
						path: "/svelte/2021/08/07/svelte-supabase-tracking.html",
						query: new URLSearchParams(""),
						params: {"category":"svelte","year":"2021","month":"08","date":"07","slug":"svelte-supabase-tracking.html"}
					}
				}
			});
		</script>
	</head>
	<body>
		<div id="svelte">


<header class="site-header"><div class="wrapper"><a class="site-title" href="/">GeoExamples - Roger Veciana</a>

<nav class="site-nav"><div href="#" class="menu-icon"><svg viewBox="0 0 18 15"><path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"></path><path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"></path><path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"></path></svg></div>

	<div class="trigger"><a class="page-link" href="/about">About</a><a class="page-link" href="/blog">Blog</a><a class="page-link" href="/projects">Projects</a></div></nav></div></header>

<main class="page-content"><div class="wrapper">
<div class="post"><header class="post-header"><h1 class="post-title">A tracking tool with Supabase and Svelte</h1>
<p class="post-meta">Aug 7, 2021</p></header>

	<article class="post-content"><!-- HTML_TAG_START --><p>In the <a href="https://geoexamples.com/svelte/2021/07/18/svelte-supabase-maps.html">previous post</a> I explained a fast way to use <a href="https://supabase.io/">Supabase</a> with Svelte to store and show geographical data. Supabase offers a really cool way to use websockets so the page updates when some data in the database changes. They call it <em>subscription</em> and it&#39;s adding <em>subscribe()</em> function on a <em>select</em>.</p>
<p>So I created this new example. On a mobile phone (allowing geolocation), we write the location into the database, and on another device you can follow the position in real-time. Everything without having to install any library except for Supabase! You can <a href="https://github.com/rveciana/supabase-svelte">get the source code</a> and see the <a href="https://geoexamples.com/supabase-svelte/">demo page</a>. When using on a mobile device, always use https or the geolocation will be deactivated.</p>
<h1 id="the-app">The app</h1>
<p>The first screen asks if you want to create a track or follow one:</p>
<img src="/images/svelte/svelte-supabase-track/initial.png" />

<p>When selecting <em>Start a new track</em>, a random name will be assigned to it so it&#39;s possible to use it with the option <em>Follow track</em> from any other device.</p>
<p>In both cases, you will see the map with the track:</p>
<img src="/images/svelte/svelte-supabase-track/map.png" />


<h1 id="supabase">Supabase</h1>
<p>To run this project, we&#39;ll use a single table. The table looks like this:</p>
<img src="/images/svelte/svelte-supabase-track/table.png" />

<ul>
<li><p>The <em>name</em> field will be used to follow a single track. Only who has created it knows the name, so you can follow only your tracks</p>
</li>
<li><p><em>geometry</em> has the track, which is a <em>linestring</em>. Ideally, it could be a <em>multilinestring</em> and divide the track in sections if the GPS stops or something, but this is out of the scope for a simple demo</p>
</li>
<li><p>The geometry column is created running:</p>
<p>  SELECT AddGeometryColumn (&#39;&#39;,&#39;tracks&#39;,&#39;geom&#39;,4326,&#39;LINESTRING&#39;,2);</p>
</li>
</ul>
<p>So it&#39;s that easy! Now, the function to add a new point:</p>
<p><pre><code>create or replace <span class="token keyword">function</span> <span class="token function">addTrackPoint</span> <span class="token punctuation">(</span><span class="token parameter">track_name varchar<span class="token punctuation">,</span> lon float<span class="token punctuation">,</span> lat float</span><span class="token punctuation">)</span>
returns <span class="token constant">SETOF</span> tracks <span class="token keyword">as</span>
$
declare
return_record tracks<span class="token operator">%</span>rowtype<span class="token punctuation">;</span>
begin

  update tracks <span class="token keyword">set</span> geom <span class="token operator">=</span> <span class="token function">ST_AddPoint</span><span class="token punctuation">(</span>geom<span class="token punctuation">,</span>
      <span class="token function">ST_SetSRID</span><span class="token punctuation">(</span>
      <span class="token function">ST_MakePoint</span><span class="token punctuation">(</span>lon<span class="token punctuation">,</span> lat<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token number">4326</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
      <span class="token operator">-</span><span class="token number">1</span>
  <span class="token punctuation">)</span>
   where name <span class="token operator">=</span> track_name
  returning <span class="token operator">*</span>
    into return_record<span class="token punctuation">;</span>
  <span class="token keyword">if</span> found then
    <span class="token keyword">return</span> next return_record<span class="token punctuation">;</span>
  <span class="token keyword">else</span> 
    insert into  <span class="token function">tracks</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> geom<span class="token punctuation">)</span> <span class="token function">values</span> <span class="token punctuation">(</span>track_name<span class="token punctuation">,</span> <span class="token function">ST_MakeLine</span><span class="token punctuation">(</span>
          <span class="token constant">ARRAY</span><span class="token punctuation">[</span><span class="token function">ST_SetSRID</span><span class="token punctuation">(</span>
      <span class="token function">ST_MakePoint</span><span class="token punctuation">(</span>lon<span class="token punctuation">,</span> lat<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token number">4326</span><span class="token punctuation">)</span>
      <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    returning <span class="token operator">*</span>
    into return_record<span class="token punctuation">;</span>
    <span class="token keyword">return</span> next return_record<span class="token punctuation">;</span>

  end <span class="token keyword">if</span><span class="token punctuation">;</span>

end<span class="token punctuation">;</span>
$
language plpgsql<span class="token punctuation">;</span>
</code></pre></p>
<p>So, since we don&#39;t have a real backend, only SQL calls, the logic has to go in the database itself, which is good to remember the SQL you forgot!</p>
<p>The idea is sending a longitude and latitude so the geometry updates adding the new point and returns the data with the new <em>linestring</em> back to the user.</p>
<ul>
<li>We want to get the result of the insert, so we declare the type as the table row type and use the <em>returning</em> clause so we can get the updated linestring directly after inserting a new point</li>
<li>PostGIS has many functions to manipulate geometries. For the update, we use <em>ST_AddPoint</em> and <em>ST_MakeLine</em> for the insert</li>
<li>We are actually using an <em>upsert</em> which means inserting when the record doesn&#39;t exist and updating it otherwise.  The <em>if found then</em> part is the one that checks the update result and runs the insert if nothing was updated.</li>
<li>A new point can be added now from the Supabase library:</li>
</ul>
<p><pre><code><span class="token keyword">await</span> supabase
            <span class="token punctuation">.</span><span class="token function">rpc</span><span class="token punctuation">(</span><span class="token string">'addtrackpoint'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>track_name<span class="token operator">:</span> trackName<span class="token punctuation">,</span> lon<span class="token operator">:</span> lng<span class="token punctuation">,</span> lat<span class="token operator">:</span>lat<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></p>
<p>Or using SQL, with:</p>
SELECT addtrackpoint(&#39;track_name&#39;, lon, lat)<h1 id="svelte-code">Svelte Code</h1>
<p>You can <a href="https://github.com/rveciana/supabase-svelte">check the code on GitHub</a>, I&#39;ll comment on the basic points only:</p>
<ul>
<li><a href="https://geoexamples.com/svelte/2021/07/18/svelte-supabase-maps.html">Check the last post</a> to see how I created the basic project</li>
<li>I created two stores in at stores.ts</li>
</ul>
<p><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> writable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'svelte/store'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> track <span class="token operator">=</span> <span class="token function">writable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">"LineString"</span><span class="token punctuation">,</span> 
    coordinates<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token punctuation">[</span>number<span class="token punctuation">,</span> number<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> mapCenter <span class="token operator">=</span> <span class="token function">writable</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></p>
<p>Doing it like this, we don&#39;t re-render all the map if we have to pass the <em>linestring</em> as a <em>prop</em>, since only the track component will listen to the store. The store can be updated on the root component. <em>mapCenter</em> is used to set the center of the map when opening or creating a track.</p>
<ul>
<li>The <em>Map</em> Component uses <a href="https://ngyewch.github.io/svelte-leaflet/">svelte-leaflet</a> to create the map. This allows using <em>leaflet</em> as components. Check its docs to see how it&#39;s installed (or take a look at the <em>rollup.config.js</em> file in the project)</li>
</ul>
<p><pre><code><span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span>LeafletMap<span class="token punctuation">,</span> TileLayer<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'svelte-leafletjs'</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> MapTrack <span class="token keyword">from</span> <span class="token string">'./MapTrack.svelte'</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span> mapCenter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./store.js'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> mapCenterValue<span class="token punctuation">;</span>

<span class="token keyword">const</span> unsubscribe <span class="token operator">=</span> mapCenter<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    mapCenterValue <span class="token operator">=</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> mapOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
    center<span class="token operator">:</span> <span class="token punctuation">[</span>mapCenterValue<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> mapCenterValue<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    zoom<span class="token operator">:</span> <span class="token number">15</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> tileUrl <span class="token operator">=</span> <span class="token string">"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> tileLayerOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
    minZoom<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    maxZoom<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
    maxNativeZoom<span class="token operator">:</span> <span class="token number">19</span><span class="token punctuation">,</span>
    attribution<span class="token operator">:</span> <span class="token string">"© OpenStreetMap contributors"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> leafletMap<span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span>LeafletMap bind<span class="token operator">:</span><span class="token keyword">this</span><span class="token operator">=</span><span class="token punctuation">{</span>leafletMap<span class="token punctuation">}</span> options<span class="token operator">=</span><span class="token punctuation">{</span>mapOptions<span class="token punctuation">}</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>TileLayer url<span class="token operator">=</span><span class="token punctuation">{</span>tileUrl<span class="token punctuation">}</span> options<span class="token operator">=</span><span class="token punctuation">{</span>tileLayerOptions<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>MapTrack<span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>LeafletMap<span class="token operator">></span>
</code></pre></p>
<p>The store is used to get the center of the map and a <em>MapTrack</em> component is added to show the track. This way, when the track updates, only this layer is re-rendered, which is much more efficient.</p>
<ul>
<li>The <em>MapTrack</em> component looks like this:</li>
</ul>
<p><pre><code><span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span>Tooltip<span class="token punctuation">,</span> Polyline<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'svelte-leafletjs'</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span> track <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./store.js'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> trackValue<span class="token punctuation">;</span>

<span class="token keyword">const</span> unsubscribe <span class="token operator">=</span> track<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    trackValue <span class="token operator">=</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>

<span class="token operator">&lt;</span>Polyline latLngs<span class="token operator">=</span><span class="token punctuation">{</span>trackValue<span class="token punctuation">.</span>coordinates<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token operator">=></span><span class="token punctuation">[</span>d<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>d<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span> color<span class="token operator">=</span><span class="token string">"#000000"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>Tooltip<span class="token operator">></span>Resorts World Sentosa to Vivo City<span class="token operator">&lt;</span><span class="token operator">/</span>Tooltip<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Polyline<span class="token operator">></span>
</code></pre></p>
<p>Using the store makes it so easy!</p>
<ul>
<li>The <em>App.svelte</em> file is the one that does most of the job:</li>
</ul>
<p><pre><code><span class="token operator">&lt;</span>script lang<span class="token operator">=</span><span class="token string">"ts"</span><span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span> supabase <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./supabaseClient"</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> type <span class="token punctuation">{</span> RealtimeSubscription <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@supabase/supabase-js'</span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span> onMount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'svelte'</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span> uniqueNamesGenerator<span class="token punctuation">,</span> adjectives<span class="token punctuation">,</span> colors<span class="token punctuation">,</span> animals <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'unique-names-generator'</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> Map <span class="token keyword">from</span> <span class="token string">'./Map.svelte'</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span> convertWkb <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./read-wkb'</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span> track<span class="token punctuation">,</span> mapCenter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./store.js'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> lng <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> lat <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> mode<span class="token operator">:</span><span class="token string">"read"</span><span class="token operator">|</span><span class="token string">"write"</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> trackName<span class="token operator">:</span> string<span class="token punctuation">;</span>
<span class="token keyword">let</span> mySubscription<span class="token operator">:</span>RealtimeSubscription

<span class="token function">onMount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>geolocation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            navigator<span class="token punctuation">.</span>geolocation<span class="token punctuation">.</span><span class="token function">watchPosition</span><span class="token punctuation">(</span>displayLocationInfo<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"ERROR"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> enableHighAccuracy<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> timeout<span class="token operator">:</span><span class="token number">60000</span><span class="token punctuation">,</span> maximumAge<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"NO GEOLOCATION"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">displayLocationInfo</span> <span class="token operator">=</span> <span class="token keyword">async</span>  <span class="token punctuation">(</span><span class="token parameter">position<span class="token operator">:</span> GeolocationPosition</span><span class="token punctuation">)</span> <span class="token operator">=></span><span class="token punctuation">{</span>
    lng <span class="token operator">=</span> position<span class="token punctuation">.</span>coords<span class="token punctuation">.</span>longitude<span class="token punctuation">;</span>
    lat <span class="token operator">=</span> position<span class="token punctuation">.</span>coords<span class="token punctuation">.</span>latitude<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>mode <span class="token operator">===</span> <span class="token string">"write"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token keyword">const</span> <span class="token punctuation">{</span>data<span class="token punctuation">}</span><span class="token operator">=</span> <span class="token keyword">await</span> supabase
            <span class="token punctuation">.</span><span class="token function">rpc</span><span class="token punctuation">(</span><span class="token string">'addtrackpoint'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>track_name<span class="token operator">:</span> trackName<span class="token punctuation">,</span> lon<span class="token operator">:</span> lng<span class="token punctuation">,</span> lat<span class="token operator">:</span>lat<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        data<span class="token punctuation">.</span>length<span class="token operator">></span><span class="token number">0</span> <span class="token operator">&amp;</span>amp<span class="token punctuation">;</span><span class="token operator">&amp;</span>amp<span class="token punctuation">;</span> track<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>geom<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"New position"</span><span class="token punctuation">,</span> lng<span class="token punctuation">,</span> lat<span class="token punctuation">,</span> <span class="token string">"-->"</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>geom<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">startWrite</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    trackName <span class="token operator">=</span> <span class="token function">uniqueNamesGenerator</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          dictionaries<span class="token operator">:</span> <span class="token punctuation">[</span>adjectives<span class="token punctuation">,</span> colors<span class="token punctuation">,</span> animals<span class="token punctuation">]</span><span class="token punctuation">,</span>
        separator<span class="token operator">:</span> <span class="token string">"-"</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> supabase
        <span class="token punctuation">.</span><span class="token function">rpc</span><span class="token punctuation">(</span><span class="token string">'addtrackpoint'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>track_name<span class="token operator">:</span> trackName<span class="token punctuation">,</span> lon<span class="token operator">:</span> lng<span class="token punctuation">,</span> lat<span class="token operator">:</span>lat<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    mode <span class="token operator">=</span> <span class="token string">"write"</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Writes"</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mapCenter<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span>lng<span class="token punctuation">,</span> lat<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    data<span class="token punctuation">.</span>length<span class="token operator">></span><span class="token number">0</span> <span class="token operator">&amp;</span>amp<span class="token punctuation">;</span><span class="token operator">&amp;</span>amp<span class="token punctuation">;</span> track<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>geom<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">startRead</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>

    <span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> error <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> supabase
            <span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'tracks'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'eq'</span><span class="token punctuation">,</span> trackName<span class="token punctuation">)</span><span class="token punctuation">;</span>

    data<span class="token punctuation">.</span>length<span class="token operator">></span><span class="token number">0</span> <span class="token operator">&amp;</span>amp<span class="token punctuation">;</span><span class="token operator">&amp;</span>amp<span class="token punctuation">;</span> track<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>geom<span class="token punctuation">)</span><span class="token punctuation">;</span>
    data<span class="token punctuation">.</span>length<span class="token operator">></span><span class="token number">0</span> <span class="token operator">&amp;</span>amp<span class="token punctuation">;</span><span class="token operator">&amp;</span>amp<span class="token punctuation">;</span> mapCenter<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>geom<span class="token punctuation">.</span>coordinates<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mode <span class="token operator">=</span> <span class="token string">"read"</span><span class="token punctuation">;</span>
    mySubscription <span class="token operator">=</span> supabase
        <span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">tracks:name=eq.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>trackName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">,</span> <span class="token parameter">payload</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> newTrack <span class="token operator">=</span> <span class="token function">convertWkb</span><span class="token punctuation">(</span>payload<span class="token punctuation">.</span>new<span class="token punctuation">.</span>geom<span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Change received!'</span><span class="token punctuation">,</span> newTrack<span class="token punctuation">)</span><span class="token punctuation">;</span>
            track<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>newTrack<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"container"</span> style<span class="token operator">=</span><span class="token string">"width: 100%; height: 100%;"</span><span class="token operator">></span>
    <span class="token punctuation">{</span>#<span class="token keyword">if</span> mode<span class="token operator">===</span><span class="token string">"read"</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token constant">READ</span> <span class="token punctuation">{</span>trackName<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&lt;</span>Map<span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">{</span><span class="token operator">:</span><span class="token keyword">else</span> <span class="token keyword">if</span> mode<span class="token operator">===</span><span class="token string">"write"</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token constant">WRITE</span> <span class="token punctuation">{</span>trackName<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&lt;</span>Map<span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">{</span><span class="token operator">:</span><span class="token keyword">else</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span>div<span class="token operator">></span>
            <span class="token operator">&lt;</span>input placeholder<span class="token operator">=</span><span class="token string">"track name"</span> bind<span class="token operator">:</span>value<span class="token operator">=</span><span class="token punctuation">{</span>trackName<span class="token punctuation">}</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>button on<span class="token operator">:</span>click<span class="token operator">|</span>once<span class="token operator">=</span><span class="token punctuation">{</span>startRead<span class="token punctuation">}</span><span class="token operator">></span>Follow a track<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token operator">&lt;</span>div<span class="token operator">></span>
            <span class="token operator">&lt;</span>button on<span class="token operator">:</span>click<span class="token operator">|</span>once<span class="token operator">=</span><span class="token punctuation">{</span>startWrite<span class="token punctuation">}</span><span class="token operator">></span>Start a <span class="token keyword">new</span> <span class="token class-name">track</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">{</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
</code></pre>

<p>Let&#39;s see the most important parts:</p>
<ul>
<li><em>mode</em> can be <em>read</em>, <em>write</em>, or <em>undefined</em>, which are the three states that the app can have. Undefined allows the user to choose if he wants to create a track or follow it. The form calls either <em>startRead</em> or <em>startWrite</em> that changes this <em>mode</em> variable.</li>
<li>On mounting the component, the geolocation is started. This way, the <em>lon</em> and <em>lat</em> variables will be filled and ready if we want to start a new track<ul>
<li><em>displayLocationInfo</em> is the function that gets the position and calls the function in the database to store a new point if we are in the <em>write</em> mode</li>
</ul>
</li>
<li><em>startWrite</em> creates a random name using the <em>unique-names-generator</em> library. It will be always an adjective-color-animal sequence. Then, uses the same function to add the first point and sets the map center.</li>
<li><em>startRead</em> is quite similar but starts a new subscription. Notice that subscriptions don&#39;t use filters as in the other cases, but changes the <em>from</em> function to <em>table:name=operator:value</em><ul>
<li>See the next point to see why do we call the <em>convertWkb</em> function</li>
</ul>
</li>
</ul>
<h1 id="wkb">WKB</h1>
<p>When using the real-time feature, the result is given in WKB format because Supabase doesn&#39;t run any conversion function as it does the select function (strange). WKB is a hex representation of a binary string with geometries. You can see a nice <a href="https://en.wikipedia.org/wiki/Well-known_text_representation_of_geometry#Well-known_binary">explanation at Wikipedia</a>. If you have this string you can insert the data into the database without functions (and using Supabase, with the <em>insert()</em> function). The problem is that I wasn&#39;t able to find a library that makes the conversion in Javascript. There&#39;s <a href="https://github.com/cschwarz/wkx">wkx.js</a>, but I wasn&#39;t able to use it in a ES6 style (import wkb from &#39;wkt&#39;). If somebody knows how to do it, please tell me, it&#39;s the main piece to work with all these tools properly.</p>
<p>So I created this small function that decodes a <em>linestring</em> from WKB to GeoJSON</p>
<p><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span>from<span class="token punctuation">,</span> readDoubleBE<span class="token punctuation">,</span> readDoubleLE<span class="token punctuation">,</span> readUInt32LE<span class="token punctuation">,</span> readUInt32BE<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'bops'</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">convertWkb</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">wkb<span class="token operator">:</span>string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> buffer <span class="token operator">=</span> <span class="token function">from</span><span class="token punctuation">(</span>wkb<span class="token punctuation">,</span> <span class="token string">"hex"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> isBigEndian <span class="token operator">=</span> wkb<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'00'</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> epsg <span class="token operator">=</span> isBigEndian <span class="token operator">?</span> <span class="token function">readUInt32BE</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">readUInt32LE</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> numberOfPoints <span class="token operator">=</span> <span class="token punctuation">(</span>wkb<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">26</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">32</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> coordinates <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>


<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> numberOfPoints<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    coordinates<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">readDoubleLE</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">13</span> <span class="token operator">+</span> i <span class="token operator">*</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">readDoubleLE</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">13</span> <span class="token operator">+</span> <span class="token number">8</span> <span class="token operator">+</span> i <span class="token operator">*</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> geoJSON <span class="token operator">=</span>  <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">"LineString"</span><span class="token punctuation">,</span> 
    coordinates<span class="token operator">:</span> coordinates
<span class="token punctuation">}</span>

<span class="token keyword">return</span> geoJSON<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></p>
<ul>
<li><a href="https://github.com/chrisdickinson/bops">bops</a> library is used as a replacement for the nodejs buffer function. It will convert from hex to the types we need</li>
<li>I play with some numbers to get the proper position of the bytes for each point. I know that is a simple linestring so I can iterate only once</li>
<li>The format is actually EWKT, that adds the projection code (SRID, which is 4326, so WGS84 in our case)</li>
</ul>
<h1 id="links">Links</h1>
<ul>
<li><a href="https://github.com/rveciana/supabase-svelte">Example source code</a></li>
<li><a href="https://geoexamples.com/supabase-svelte/">Working example</a></li>
<li><a href="https://geoexamples.com/svelte/2021/07/18/svelte-supabase-maps.html">Previous Post</a></li>
<li><a href="https://supabase.io/">Supabase</a></li>
<li><a href="https://en.wikipedia.org/wiki/Well-known_text_representation_of_geometry#Well-known_binary">WKB</a></li>
<li><a href="https://github.com/cschwarz/wkx">wkx.js</a></li>
<li><a href="https://github.com/chrisdickinson/bops">bops</a></li>
<li><a href="https://ngyewch.github.io/svelte-leaflet/">Svelte Leaflet</a></li>
</ul>
<!-- HTML_TAG_END --></article></div></div></main>
<footer class="site-footer"><div class="wrapper"><div class="footer-col-wrapper"><div class="footer-col  footer-col-1"><ul class="contact-list"><li>GeoExamples - Roger Veciana</li></ul></div>

	<div class="footer-col  footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/rveciana"><span class="icon  icon--github"><svg viewBox="0 0 16 16"><path fill="#89b889" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"></path></svg></span>

						<span class="username">rveciana</span></a></li>

			<li><a href="https://twitter.com/rveciana"><span class="icon  icon--twitter"><svg viewBox="0 0 16 16"><path fill="#89b889" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                    c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"></path></svg></span>

						<span class="username">rveciana</span></a></li>
			<li><a href="https://www.linkedin.com/in/rogerveciana"><span class="icon  icon--twitter"><svg width="16" height="15.28958"><path d="M 0,1.77606 Q 0,1.00386 0.54054,0.50193 1.08108,0 1.94595,0 2.79537,0 3.32047,0.49421 3.86101,1.00386 3.86101,1.8224 q 0,0.74131 -0.5251,1.23552 -0.54054,0.50965 -1.42085,0.50965 l -0.0154,0 q -0.84942,0 -1.37452,-0.50965 Q 4e-5,2.54827 4e-5,1.77606 Z m 0.20078,13.51352 0,-10.3166 3.42857,0 0,10.3166 -3.42857,0 z m 5.32818,0 3.42857,0 0,-5.76062 q 0,-0.54054 0.12355,-0.83398 0.21622,-0.52509 0.65638,-0.88803 0.44015,-0.36293 1.10424,-0.36293 1.72973,0 1.72973,2.33205 l 0,5.51351 3.42857,0 0,-5.91506 Q 16,7.08881 14.91892,5.90734 13.83784,4.72587 12.06178,4.72587 q -1.99228,0 -3.10425,1.71429 l 0,0.0309 -0.0154,0 0.0154,-0.0309 0,-1.46718 -3.42857,0 q 0.0309,0.49421 0.0309,3.07336 0,2.57915 -0.0309,7.24324 z"></path></svg></span>

						<span class="username">rogerveciana</span></a></li></ul></div>

	<div class="footer-col  footer-col-3"><p class="text">I am a software developer and meteorologist who likes mapping. I put here the things I learn on my free time.</p>
		<p class="text">Roger Veciana i Rovira</p></div></div></div></footer>



	<script type="application/json" data-type="svelte-data" data-url="/summary_pages.json">{"status":200,"statusText":"","headers":{"content-type":"application/json; charset=utf-8"},"body":"[{\"title\":\"About\",\"permalink\":\"\u002Fabout\",\"excerpt\":\"\u003Cp\u003E{{ site.author.name }}\u003C\u002Fp\u003E\"},{\"title\":\"CV\",\"permalink\":\"\u002Fcv\",\"excerpt\":\"\u003Ch2 id=\\\"jobs\\\"\u003EJobs\u003C\u002Fh2\u003E\",\"avoidMainMenu\":true},{\"title\":\"Projects\",\"permalink\":\"\u002Fprojects\",\"excerpt\":\"\u003Cp\u003ESome of my personal projects:\u003C\u002Fp\u003E\"}]"}</script>

	<script type="application/json" data-type="svelte-data" data-url="svelte-supabase-tracking.html.json">{"status":200,"statusText":"","headers":{"content-type":"application/json; charset=utf-8"},"body":"{\"title\":\"A tracking tool with Supabase and Svelte\",\"contents\":\"\u003Cp\u003EIn the \u003Ca href=\\\"https:\u002F\u002Fgeoexamples.com\u002Fsvelte\u002F2021\u002F07\u002F18\u002Fsvelte-supabase-maps.html\\\"\u003Eprevious post\u003C\u002Fa\u003E I explained a fast way to use \u003Ca href=\\\"https:\u002F\u002Fsupabase.io\u002F\\\"\u003ESupabase\u003C\u002Fa\u003E with Svelte to store and show geographical data. Supabase offers a really cool way to use websockets so the page updates when some data in the database changes. They call it \u003Cem\u003Esubscription\u003C\u002Fem\u003E and it&#39;s adding \u003Cem\u003Esubscribe()\u003C\u002Fem\u003E function on a \u003Cem\u003Eselect\u003C\u002Fem\u003E.\u003C\u002Fp\u003E\\n\u003Cp\u003ESo I created this new example. On a mobile phone (allowing geolocation), we write the location into the database, and on another device you can follow the position in real-time. Everything without having to install any library except for Supabase! You can \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Frveciana\u002Fsupabase-svelte\\\"\u003Eget the source code\u003C\u002Fa\u003E and see the \u003Ca href=\\\"https:\u002F\u002Fgeoexamples.com\u002Fsupabase-svelte\u002F\\\"\u003Edemo page\u003C\u002Fa\u003E. When using on a mobile device, always use https or the geolocation will be deactivated.\u003C\u002Fp\u003E\\n\u003Ch1 id=\\\"the-app\\\"\u003EThe app\u003C\u002Fh1\u003E\\n\u003Cp\u003EThe first screen asks if you want to create a track or follow one:\u003C\u002Fp\u003E\\n\u003Cimg src=\\\"\u002Fimages\u002Fsvelte\u002Fsvelte-supabase-track\u002Finitial.png\\\" \u002F\u003E\\n\\n\u003Cp\u003EWhen selecting \u003Cem\u003EStart a new track\u003C\u002Fem\u003E, a random name will be assigned to it so it&#39;s possible to use it with the option \u003Cem\u003EFollow track\u003C\u002Fem\u003E from any other device.\u003C\u002Fp\u003E\\n\u003Cp\u003EIn both cases, you will see the map with the track:\u003C\u002Fp\u003E\\n\u003Cimg src=\\\"\u002Fimages\u002Fsvelte\u002Fsvelte-supabase-track\u002Fmap.png\\\" \u002F\u003E\\n\\n\\n\u003Ch1 id=\\\"supabase\\\"\u003ESupabase\u003C\u002Fh1\u003E\\n\u003Cp\u003ETo run this project, we&#39;ll use a single table. The table looks like this:\u003C\u002Fp\u003E\\n\u003Cimg src=\\\"\u002Fimages\u002Fsvelte\u002Fsvelte-supabase-track\u002Ftable.png\\\" \u002F\u003E\\n\\n\u003Cul\u003E\\n\u003Cli\u003E\u003Cp\u003EThe \u003Cem\u003Ename\u003C\u002Fem\u003E field will be used to follow a single track. Only who has created it knows the name, so you can follow only your tracks\u003C\u002Fp\u003E\\n\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Cp\u003E\u003Cem\u003Egeometry\u003C\u002Fem\u003E has the track, which is a \u003Cem\u003Elinestring\u003C\u002Fem\u003E. Ideally, it could be a \u003Cem\u003Emultilinestring\u003C\u002Fem\u003E and divide the track in sections if the GPS stops or something, but this is out of the scope for a simple demo\u003C\u002Fp\u003E\\n\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Cp\u003EThe geometry column is created running:\u003C\u002Fp\u003E\\n\u003Cp\u003E  SELECT AddGeometryColumn (&#39;&#39;,&#39;tracks&#39;,&#39;geom&#39;,4326,&#39;LINESTRING&#39;,2);\u003C\u002Fp\u003E\\n\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Cp\u003ESo it&#39;s that easy! Now, the function to add a new point:\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cpre\u003E\u003Ccode\u003Ecreate or replace \u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003EaddTrackPoint\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003Etrack_name varchar\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E lon float\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E lat float\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\nreturns \u003Cspan class=\\\"token constant\\\"\u003ESETOF\u003C\u002Fspan\u003E tracks \u003Cspan class=\\\"token keyword\\\"\u003Eas\u003C\u002Fspan\u003E\\n$\\ndeclare\\nreturn_record tracks\u003Cspan class=\\\"token operator\\\"\u003E%\u003C\u002Fspan\u003Erowtype\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\nbegin\\n\\n  update tracks \u003Cspan class=\\\"token keyword\\\"\u003Eset\u003C\u002Fspan\u003E geom \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003EST_AddPoint\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Egeom\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n      \u003Cspan class=\\\"token function\\\"\u003EST_SetSRID\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\\n      \u003Cspan class=\\\"token function\\\"\u003EST_MakePoint\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Elon\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E lat\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n      \u003Cspan class=\\\"token number\\\"\u003E4326\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \\n      \u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E1\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n   where name \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E track_name\\n  returning \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E\\n    into return_record\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Eif\u003C\u002Fspan\u003E found then\\n    \u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E next return_record\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Eelse\u003C\u002Fspan\u003E \\n    insert into  \u003Cspan class=\\\"token function\\\"\u003Etracks\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ename\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E geom\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Evalues\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Etrack_name\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003EST_MakeLine\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\\n          \u003Cspan class=\\\"token constant\\\"\u003EARRAY\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003EST_SetSRID\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\\n      \u003Cspan class=\\\"token function\\\"\u003EST_MakePoint\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Elon\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E lat\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n      \u003Cspan class=\\\"token number\\\"\u003E4326\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n      \u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n    returning \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E\\n    into return_record\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E next return_record\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n  end \u003Cspan class=\\\"token keyword\\\"\u003Eif\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\nend\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n$\\nlanguage plpgsql\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003ESo, since we don&#39;t have a real backend, only SQL calls, the logic has to go in the database itself, which is good to remember the SQL you forgot!\u003C\u002Fp\u003E\\n\u003Cp\u003EThe idea is sending a longitude and latitude so the geometry updates adding the new point and returns the data with the new \u003Cem\u003Elinestring\u003C\u002Fem\u003E back to the user.\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003EWe want to get the result of the insert, so we declare the type as the table row type and use the \u003Cem\u003Ereturning\u003C\u002Fem\u003E clause so we can get the updated linestring directly after inserting a new point\u003C\u002Fli\u003E\\n\u003Cli\u003EPostGIS has many functions to manipulate geometries. For the update, we use \u003Cem\u003EST_AddPoint\u003C\u002Fem\u003E and \u003Cem\u003EST_MakeLine\u003C\u002Fem\u003E for the insert\u003C\u002Fli\u003E\\n\u003Cli\u003EWe are actually using an \u003Cem\u003Eupsert\u003C\u002Fem\u003E which means inserting when the record doesn&#39;t exist and updating it otherwise.  The \u003Cem\u003Eif found then\u003C\u002Fem\u003E part is the one that checks the update result and runs the insert if nothing was updated.\u003C\u002Fli\u003E\\n\u003Cli\u003EA new point can be added now from the Supabase library:\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Cp\u003E\u003Cpre\u003E\u003Ccode\u003E\u003Cspan class=\\\"token keyword\\\"\u003Eawait\u003C\u002Fspan\u003E supabase\\n            \u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Erpc\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E'addtrackpoint'\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003Etrack_name\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E trackName\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E lon\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E lng\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E lat\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Elat\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EOr using SQL, with:\u003C\u002Fp\u003E\\nSELECT addtrackpoint(&#39;track_name&#39;, lon, lat)\u003Ch1 id=\\\"svelte-code\\\"\u003ESvelte Code\u003C\u002Fh1\u003E\\n\u003Cp\u003EYou can \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Frveciana\u002Fsupabase-svelte\\\"\u003Echeck the code on GitHub\u003C\u002Fa\u003E, I&#39;ll comment on the basic points only:\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fgeoexamples.com\u002Fsvelte\u002F2021\u002F07\u002F18\u002Fsvelte-supabase-maps.html\\\"\u003ECheck the last post\u003C\u002Fa\u003E to see how I created the basic project\u003C\u002Fli\u003E\\n\u003Cli\u003EI created two stores in at stores.ts\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Cp\u003E\u003Cpre\u003E\u003Ccode\u003E\u003Cspan class=\\\"token keyword\\\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E writable \u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E'svelte\u002Fstore'\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E track \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ewritable\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E\\n    type\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E\\\"LineString\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \\n    coordinates\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003Enumber\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E number\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E mapCenter \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ewritable\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EDoing it like this, we don&#39;t re-render all the map if we have to pass the \u003Cem\u003Elinestring\u003C\u002Fem\u003E as a \u003Cem\u003Eprop\u003C\u002Fem\u003E, since only the track component will listen to the store. The store can be updated on the root component. \u003Cem\u003EmapCenter\u003C\u002Fem\u003E is used to set the center of the map when opening or creating a track.\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003EThe \u003Cem\u003EMap\u003C\u002Fem\u003E Component uses \u003Ca href=\\\"https:\u002F\u002Fngyewch.github.io\u002Fsvelte-leaflet\u002F\\\"\u003Esvelte-leaflet\u003C\u002Fa\u003E to create the map. This allows using \u003Cem\u003Eleaflet\u003C\u002Fem\u003E as components. Check its docs to see how it&#39;s installed (or take a look at the \u003Cem\u003Erollup.config.js\u003C\u002Fem\u003E file in the project)\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Cp\u003E\u003Cpre\u003E\u003Ccode\u003E\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003Escript\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003ELeafletMap\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E TileLayer\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E'svelte-leafletjs'\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Eimport\u003C\u002Fspan\u003E MapTrack \u003Cspan class=\\\"token keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E'.\u002FMapTrack.svelte'\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E mapCenter \u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E'.\u002Fstore.js'\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E mapCenterValue\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E unsubscribe \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E mapCenter\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Esubscribe\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003Evalue\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003E\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E\\n    mapCenterValue \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E value\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E mapOptions \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E\\n    center\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003EmapCenterValue\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E mapCenterValue\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n    zoom\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E15\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E tileUrl \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E\\\"https:\u002F\u002F{s}.tile.openstreetmap.org\u002F{z}\u002F{x}\u002F{y}.png\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E tileLayerOptions \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E\\n    minZoom\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n    maxZoom\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E20\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n    maxNativeZoom\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E19\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n    attribution\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E\\\"© OpenStreetMap contributors\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E leafletMap\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Escript\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003ELeafletMap bind\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003EleafletMap\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E options\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003EmapOptions\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003ETileLayer url\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003EtileUrl\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E options\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003EtileLayerOptions\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003EMapTrack\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003ELeafletMap\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EThe store is used to get the center of the map and a \u003Cem\u003EMapTrack\u003C\u002Fem\u003E component is added to show the track. This way, when the track updates, only this layer is re-rendered, which is much more efficient.\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003EThe \u003Cem\u003EMapTrack\u003C\u002Fem\u003E component looks like this:\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Cp\u003E\u003Cpre\u003E\u003Ccode\u003E\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003Escript\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003ETooltip\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E Polyline\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E'svelte-leafletjs'\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E track \u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E'.\u002Fstore.js'\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E trackValue\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E unsubscribe \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E track\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Esubscribe\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003Evalue\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003E\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E\\n    trackValue \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E value\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Escript\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003EPolyline latLngs\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003EtrackValue\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ecoordinates\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Emap\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003Ed\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E=\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003Ed\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003Ed\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E color\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E\\\"#000000\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003ETooltip\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003EResorts World Sentosa to Vivo City\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003ETooltip\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003EPolyline\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EUsing the store makes it so easy!\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003EThe \u003Cem\u003EApp.svelte\u003C\u002Fem\u003E file is the one that does most of the job:\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Cp\u003E\u003Cpre\u003E\u003Ccode\u003E\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003Escript lang\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E\\\"ts\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E supabase \u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E\\\".\u002FsupabaseClient\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Eimport\u003C\u002Fspan\u003E type \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E RealtimeSubscription \u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E'@supabase\u002Fsupabase-js'\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E onMount \u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E'svelte'\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E uniqueNamesGenerator\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E adjectives\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E colors\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E animals \u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E'unique-names-generator'\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Eimport\u003C\u002Fspan\u003E Map \u003Cspan class=\\\"token keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E'.\u002FMap.svelte'\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E convertWkb \u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E'.\u002Fread-wkb'\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E track\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E mapCenter \u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E'.\u002Fstore.js'\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E lng \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E lat \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E mode\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E\\\"read\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E|\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E\\\"write\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E trackName\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E string\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E mySubscription\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003ERealtimeSubscription\\n\\n\u003Cspan class=\\\"token function\\\"\u003EonMount\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003E\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Enavigator\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Egeolocation\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E\\n            navigator\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Egeolocation\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003EwatchPosition\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003EdisplayLocationInfo\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E=\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003Econsole\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Elog\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E\\\"ERROR\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E enableHighAccuracy\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token boolean\\\"\u003Efalse\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E timeout\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E60000\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E maximumAge\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eelse\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E\\n        \u003Cspan class=\\\"token function\\\"\u003Ealert\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E\\\"NO GEOLOCATION\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function-variable function\\\"\u003EdisplayLocationInfo\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Easync\u003C\u002Fspan\u003E  \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003Eposition\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E GeolocationPosition\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E\\n    lng \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E position\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ecoords\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Elongitude\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    lat \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E position\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ecoords\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Elatitude\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Eif\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Emode \u003Cspan class=\\\"token operator\\\"\u003E===\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E\\\"write\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E\\n\\n        \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003Edata\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eawait\u003C\u002Fspan\u003E supabase\\n            \u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Erpc\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E'addtrackpoint'\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003Etrack_name\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E trackName\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E lon\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E lng\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E lat\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Elat\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n        data\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Elength\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E&amp;\u003C\u002Fspan\u003Eamp\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&amp;\u003C\u002Fspan\u003Eamp\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E track\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eset\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Edata\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Egeom\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n        console\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Elog\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E\\\"New position\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E lng\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E lat\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E\\\"--\u003E\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E data\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Egeom\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function-variable function\\\"\u003EstartWrite\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Easync\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003E\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E\\n    trackName \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003EuniqueNamesGenerator\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E\\n          dictionaries\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003Eadjectives\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E colors\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E animals\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n        separator\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E\\\"-\\\"\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\\n    \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E data \u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eawait\u003C\u002Fspan\u003E supabase\\n        \u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Erpc\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E'addtrackpoint'\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003Etrack_name\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E trackName\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E lon\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E lng\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E lat\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Elat\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n    mode \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E\\\"write\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    console\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Elog\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E\\\"Writes\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E data\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    mapCenter\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eset\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003Elng\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E lat\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    data\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Elength\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E&amp;\u003C\u002Fspan\u003Eamp\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&amp;\u003C\u002Fspan\u003Eamp\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E track\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eset\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Edata\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Egeom\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function-variable function\\\"\u003EstartRead\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Easync\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003E\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E\\n\\n    \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E data\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E error \u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eawait\u003C\u002Fspan\u003E supabase\\n            \u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Efrom\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E'tracks'\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n            \u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eselect\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n            \u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Efilter\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E'name'\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E'eq'\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E trackName\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n    data\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Elength\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E&amp;\u003C\u002Fspan\u003Eamp\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&amp;\u003C\u002Fspan\u003Eamp\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E track\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eset\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Edata\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Egeom\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    data\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Elength\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E&amp;\u003C\u002Fspan\u003Eamp\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&amp;\u003C\u002Fspan\u003Eamp\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E mapCenter\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eset\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Edata\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Egeom\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ecoordinates\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    mode \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E\\\"read\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    mySubscription \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E supabase\\n        \u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Efrom\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token template-string\\\"\u003E\u003Cspan class=\\\"token template-punctuation string\\\"\u003E`\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003Etracks:name=eq.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token interpolation\\\"\u003E\u003Cspan class=\\\"token interpolation-punctuation punctuation\\\"\u003E${\u003C\u002Fspan\u003EtrackName\u003Cspan class=\\\"token interpolation-punctuation punctuation\\\"\u003E}\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token template-punctuation string\\\"\u003E`\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n        \u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eon\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E'*'\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token parameter\\\"\u003Epayload\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003E\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E\\n            \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E newTrack \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003EconvertWkb\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Epayload\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Enew\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Egeom\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n            console\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Elog\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E'Change received!'\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E newTrack\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n            track\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eset\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003EnewTrack\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n        \u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n        \u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Esubscribe\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Escript\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003Ediv \u003Cspan class=\\\"token keyword\\\"\u003Eclass\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E\\\"container\\\"\u003C\u002Fspan\u003E style\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E\\\"width: 100%; height: 100%;\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E#\u003Cspan class=\\\"token keyword\\\"\u003Eif\u003C\u002Fspan\u003E mode\u003Cspan class=\\\"token operator\\\"\u003E===\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E\\\"read\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003Ediv\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EREAD\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003EtrackName\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Ediv\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003EMap\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Eelse\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eif\u003C\u002Fspan\u003E mode\u003Cspan class=\\\"token operator\\\"\u003E===\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E\\\"write\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003Ediv\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EWRITE\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003EtrackName\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Ediv\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003EMap\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Eelse\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\\n        \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003Ediv\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\\n            \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003Einput placeholder\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E\\\"track name\\\"\u003C\u002Fspan\u003E bind\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Evalue\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003EtrackName\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\\n            \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003Ebutton on\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Eclick\u003Cspan class=\\\"token operator\\\"\u003E|\u003C\u002Fspan\u003Eonce\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003EstartRead\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003EFollow a track\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Ebutton\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\\n        \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Ediv\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\\n        \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003Ediv\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\\n            \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003Ebutton on\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Eclick\u003Cspan class=\\\"token operator\\\"\u003E|\u003C\u002Fspan\u003Eonce\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003EstartWrite\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003EStart a \u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003Etrack\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Ebutton\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\\n        \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Ediv\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Eif\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003Ediv\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\\n\u003Cp\u003ELet&#39;s see the most important parts:\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003E\u003Cem\u003Emode\u003C\u002Fem\u003E can be \u003Cem\u003Eread\u003C\u002Fem\u003E, \u003Cem\u003Ewrite\u003C\u002Fem\u003E, or \u003Cem\u003Eundefined\u003C\u002Fem\u003E, which are the three states that the app can have. Undefined allows the user to choose if he wants to create a track or follow it. The form calls either \u003Cem\u003EstartRead\u003C\u002Fem\u003E or \u003Cem\u003EstartWrite\u003C\u002Fem\u003E that changes this \u003Cem\u003Emode\u003C\u002Fem\u003E variable.\u003C\u002Fli\u003E\\n\u003Cli\u003EOn mounting the component, the geolocation is started. This way, the \u003Cem\u003Elon\u003C\u002Fem\u003E and \u003Cem\u003Elat\u003C\u002Fem\u003E variables will be filled and ready if we want to start a new track\u003Cul\u003E\\n\u003Cli\u003E\u003Cem\u003EdisplayLocationInfo\u003C\u002Fem\u003E is the function that gets the position and calls the function in the database to store a new point if we are in the \u003Cem\u003Ewrite\u003C\u002Fem\u003E mode\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Cem\u003EstartWrite\u003C\u002Fem\u003E creates a random name using the \u003Cem\u003Eunique-names-generator\u003C\u002Fem\u003E library. It will be always an adjective-color-animal sequence. Then, uses the same function to add the first point and sets the map center.\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Cem\u003EstartRead\u003C\u002Fem\u003E is quite similar but starts a new subscription. Notice that subscriptions don&#39;t use filters as in the other cases, but changes the \u003Cem\u003Efrom\u003C\u002Fem\u003E function to \u003Cem\u003Etable:name=operator:value\u003C\u002Fem\u003E\u003Cul\u003E\\n\u003Cli\u003ESee the next point to see why do we call the \u003Cem\u003EconvertWkb\u003C\u002Fem\u003E function\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Ch1 id=\\\"wkb\\\"\u003EWKB\u003C\u002Fh1\u003E\\n\u003Cp\u003EWhen using the real-time feature, the result is given in WKB format because Supabase doesn&#39;t run any conversion function as it does the select function (strange). WKB is a hex representation of a binary string with geometries. You can see a nice \u003Ca href=\\\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FWell-known_text_representation_of_geometry#Well-known_binary\\\"\u003Eexplanation at Wikipedia\u003C\u002Fa\u003E. If you have this string you can insert the data into the database without functions (and using Supabase, with the \u003Cem\u003Einsert()\u003C\u002Fem\u003E function). The problem is that I wasn&#39;t able to find a library that makes the conversion in Javascript. There&#39;s \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Fcschwarz\u002Fwkx\\\"\u003Ewkx.js\u003C\u002Fa\u003E, but I wasn&#39;t able to use it in a ES6 style (import wkb from &#39;wkt&#39;). If somebody knows how to do it, please tell me, it&#39;s the main piece to work with all these tools properly.\u003C\u002Fp\u003E\\n\u003Cp\u003ESo I created this small function that decodes a \u003Cem\u003Elinestring\u003C\u002Fem\u003E from WKB to GeoJSON\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cpre\u003E\u003Ccode\u003E\u003Cspan class=\\\"token keyword\\\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003Efrom\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E readDoubleBE\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E readDoubleLE\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E readUInt32LE\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E readUInt32BE\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E'bops'\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function-variable function\\\"\u003EconvertWkb\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003Ewkb\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003E\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E buffer \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Efrom\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ewkb\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E\\\"hex\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E isBigEndian \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E wkb\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Esubstring\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E===\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E'00'\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E epsg \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E isBigEndian \u003Cspan class=\\\"token operator\\\"\u003E?\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003EreadUInt32BE\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ebuffer\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E5\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003EreadUInt32LE\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ebuffer\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E5\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E numberOfPoints \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ewkb\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Elength \u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E26\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E coordinates \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E i \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E i \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E numberOfPoints\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E i\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E\\n    coordinates\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Epush\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003EreadDoubleLE\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ebuffer\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E13\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E i \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E16\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003EreadDoubleLE\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ebuffer\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E13\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E8\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E i \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E16\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E geoJSON \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E  \u003Cspan class=\\\"token punctuation\\\"\u003E{\u003C\u002Fspan\u003E\\n    type\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E\\\"LineString\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \\n    coordinates\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E coordinates\\n\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E geoJSON\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E}\u003C\u002Fspan\u003E\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Fchrisdickinson\u002Fbops\\\"\u003Ebops\u003C\u002Fa\u003E library is used as a replacement for the nodejs buffer function. It will convert from hex to the types we need\u003C\u002Fli\u003E\\n\u003Cli\u003EI play with some numbers to get the proper position of the bytes for each point. I know that is a simple linestring so I can iterate only once\u003C\u002Fli\u003E\\n\u003Cli\u003EThe format is actually EWKT, that adds the projection code (SRID, which is 4326, so WGS84 in our case)\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Ch1 id=\\\"links\\\"\u003ELinks\u003C\u002Fh1\u003E\\n\u003Cul\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Frveciana\u002Fsupabase-svelte\\\"\u003EExample source code\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fgeoexamples.com\u002Fsupabase-svelte\u002F\\\"\u003EWorking example\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fgeoexamples.com\u002Fsvelte\u002F2021\u002F07\u002F18\u002Fsvelte-supabase-maps.html\\\"\u003EPrevious Post\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fsupabase.io\u002F\\\"\u003ESupabase\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FWell-known_text_representation_of_geometry#Well-known_binary\\\"\u003EWKB\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Fcschwarz\u002Fwkx\\\"\u003Ewkx.js\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Fchrisdickinson\u002Fbops\\\"\u003Ebops\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fngyewch.github.io\u002Fsvelte-leaflet\u002F\\\"\u003ESvelte Leaflet\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\",\"tags\":[\"supabase\",\"postgis\"],\"date\":\"2021-08-07T18:40:53.000Z\",\"thumbnail\":\"\u002Fimages\u002Fsvelte\u002Fsvelte-supabase-track\u002Ftwitter.png\"}"}</script>
</div>
	</body>
</html>
